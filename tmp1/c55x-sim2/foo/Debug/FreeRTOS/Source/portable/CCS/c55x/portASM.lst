TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE    1

    1978              ; Temporary Registers Used: None
       1              ; .cdecls C, LIST, "FreeRTOSConfig.h"
       2              ;  .include "FreeRTOSConfig.h"
       3              ; 32-bit stack slow mode
       4                      .mmregs
       5                       .C54CM_off
       6              ;     .CPL_off
       7                    .ARMS_off
       8                       .align 4
       9              ;       .c28_amode
      10              
      11                           .global _usCriticalNesting
      12                           .global _save_xsp
      13                           .global _Ssave_xssp
      14                           .global _Ssave_xsp
      15                           .global _save_xssp
      16                           .global _restore_xsp
      17                           .global _restore_xssp
      18                           .global _first_save_xsp
      19                           .global _first_save_xssp
      20                           .global _first_flag
      21                           .global _save_xar7
      22                           .global _tZero
      23                           .global _save_xar6
      24                                .global _save_xar1
      25                        .global _save_xar2
      26                        .global _save_xar3
      27                        .global _save_xar4
      28                         .global _save_xar5
      29                        .global _root_xsp
      30                        .global _root_xssp
      31                        .global _yield_xsp
      32                        .global _yield_xssp
      33                        .global _tick_xsp
      34                        .global _tick_xssp
      35              
      36                           .global _pxCurrentTCB                              ;; our currently exectuting TCB
      37                           .global _xTaskIncrementTick
      38                           .ref    _xTaskIncrementTick
      39                           .global _vTaskSwitchContext
      40                           .global _prvSetupTimerInterrupt
      41                           .global _tickIRQctr                                ;; debug - to be disabled during normal run/r
      42                           .global _save_new_pxcode                           ;; updated program counter that task suspende
      43                           .global _save_new_pxlcode                          ;; sysstack contents plus loop counter conten
      44                           .global _xCompareTCB                               ;; task Control Block for comparison
      45                                        .global _save_ac0
      46                                        .global _save_ac1
      47              ;                         .ref configUSE_TICK_CTR
      48              ;                         .ref configUSE_PREEMPTION
      49                                    .global _context_switch_counter
      50                           .def _vPortYield
      51                           .def _xPortStartScheduler
      52                           .def _vTickISR
      53              ;            .def _portSAVE_CONTEXT_CALL
      54              ;            .global _portSAVE_CONTEXT_CALL
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE    2

      55                           .global _vPortYield
      56                           .global _xPortStartScheduler
      57                           .global _vTickISR
      58                           .global _INT14_ISR
      59                           .global _portFLAGS_INT_ENABLED
      60                           .global _portFLAGS_INT_ENABLED_POPPED
      61                           .global _DBSTAT_SAVE
      62                           .global _DBSTAT_RESTORE
      63                           .global _LOOP_BITS
      64                           .global _STATUS0_LOW
      65                           .global _STATUS0_HIGH
      66                           .global _STATUS1_LOW
      67                           .global _STATUS1_HIGH
      68                           .global _STATUS2_LOW
      69                           .global _STATUS2_HIGH
      70                           .global _PC_REG_HIGH_SAVE
      71                           .global _PC_REG_LOW_SAVE
      72                           .global _PC_REG_HIGH_RESTORE
      73                           .global _PC_REG_LOW_RESTORE
      74              ;            .cdecls C,NOLIST,"portmacro.h"
      75              ;            .cdecls C,LIST,"FreeRTOSConfig.h"
      76              ;                       CLRC AMODE
      77              ;       System Stack
      78 000000               .text
      79              ;_portSAVE_CONTEXT_CALL:
      80              portSAVE_CONTEXT .macro 
      81              ;                       ;CONTEXT_SAVE
      82              ;                       ASP  ; Align Stack Pointer
      83              ;                       CLRC       OVM,PAGE0
      84              ;                       CLRC       AMODE
      85              ;                       EALLOW
      86                              bclr C54CM      ; temp - until we figure out what is setting this
      87              ;;;             bset INTM               ; disable interrupts - already done
      88              ;                       aadd #1, sp
      89                                      nop
      90                                      nop
      91                                      nop
      92              
      93              ;;                      mov xsp,  dbl (*(#_Ssave_xsp))                  ; save xsp
      94              ;;                      mov xssp, dbl (*(#_Ssave_xssp))                 ; save xssp
      95              ;;;                     mov dbl (*(#_save_xsp)), xsp                    ; restore xsp***
      96              ;;;                     mov dbl (*(#_save_xssp)), xssp                  ; restore xssp***
      97              
      98              ;                       pshboth xar7
      99              ;                       pshboth xar6
     100              ;                       pshboth xar5
     101              
     102              ;;;;                    mov xar7, dbl (*(#_save_xar7))                  ; save xar7 (already saved)
     103              ;                       .if configUSE_CONTEXT_DEBUG == 1
     104              ;;;;                    mov xar6, dbl (*(#_save_xar6))                  ; saved in vTick ISR already
     105              ;                       .endif
     106                                      aadd #1, sp
     107              ;;                  mov xsp,  dbl (*(#_Ssave_xsp))                      ; save xsp
     108              ;;                      mov xssp, dbl (*(#_Ssave_xssp))
     109              
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE    3

     110                                      mov sp,  *(#_Ssave_xsp)                 ; save xsp
     111                                      mov ssp, *(#_Ssave_xssp)
     112              
     113              ; +++===+++
     114              
     115                                      .if 1                                                           ; need to figure out 
     116                                      mov xar1, dbl (*(#_save_xar1))
     117                                      mov xar2, dbl (*(#_save_xar2))
     118                                      mov xar3, dbl (*(#_save_xar3))
     119                                      mov xar4, dbl (*(#_save_xar4))
     120                                      mov xar5, dbl (*(#_save_xar5))
     121                                      amov #0x000000, xar5
     122                                      amov #0x000000, xar6
     123                                      mov xsp, xar5
     124                                      mov xssp, xar6
     125              
     126                                      amov #0x000000, xar2
     127                                      amov #0x000000, xar1
     128                                      amov #0x000000, xar3
     129                                      amov #0x000000, xar4
     130                                      mov dbl (*(#_pxCurrentTCB)), xar7
     131              
     132                                      mov dbl (*ar7), xar4                            ; xsp contains our TCB now
     133                                      mov dbl (*ar7(#2)), xar3
     134                                      add #0x0064, ar4
     135                                      add #0x0002, ar3
     136              
     137                                      mov *ar5(#0), ar2                               ; current xsp contents
     138                                      mov *ar6(#0), ar1                               ; current xssp contents
     139              ;                       mov ar4, *ar6                           ; stack pointers fixed up
     140                                      mov ar2, *ar4                           ; saves our new PC - but, does this work in e
     141                                      mov ar1, *ar3
     142              
     143                                      .endif
     144              ;;                      aadd #1, sp
     145                                      .if 0
     146                          amov #0x000000, xar7
     147                                      mov dbl (*(#_pxCurrentTCB)), xar7
     148                                      mov dbl (*ar7), xsp                             ; xsp contains our TCB now
     149                                      mov dbl (*ar7(#2)), xssp
     150                          amov #0x000000, xar7
     151                                      amov #0x000000, xar6
     152                          mov *(#_save_new_pxcode), ar7
     153                          mov ar7, *sp(#0)
     154                          amov #0x000000, xar7
     155                          mov ssp, ar6
     156                          mov *(#_save_new_pxlcode), ar7
     157              ;            mov ar7, *ssp(#0)
     158                          mov ar7, *ar6(#0)
     159                              .endif
     160              
     161              ;                       mov ssp, ar7
     162              ;                       mov *ar7(#1), ar6                               ; this is (one)two away now
     163              ;                       mov ar6, *(#_DBSTAT_SAVE)                       ; save DBSTAT
     164              ;                       .endif
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE    4

     165              ;                       mov xar7, dbl (*(#_save_xar7))                  ; save xar7
     166              ;            mov xar6, dbl (*(#_save_xar6))                  ; save x
     167                                      .if 0
     168                                      amov #0x000000, xar7
     169                                      amov #0x000000, xar6
     170                          mov *sp(#0), ar7                                            ;; sp+3
     171                          mov ar7, *(#_save_new_pxcode)
     172                          mov ssp, ar6
     173                          mov *ar6(#1), ar7                                                       ;; ssp+3
     174                          mov ar7, *(#_save_new_pxlcode)       ;  ==> now we have our new return address, and if a task, it
     175                                   ;   nop
     176                          mov dbl (*(#_pxCurrentTCB)), xar7
     177                          mov xar7, dbl(*(#_xCompareTCB))
     178                          .endif
     179              ; +++===+++
     180              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
     181              ;
     182              
     183              
     184              ; +++===+++
     185                                      .if 0
     186              ;                       mov dbl (*(_xCompareTCB)), xar6                 ; need to save our return address
     187              ;                       mov xar7, ac0
     188              ;               mov xar6, ac1
     189              ;                       CMPU AC1 != AC0, TC1
     190              ;                               BCC $5,TC1
     191                                      amov #0x000000, xar7
     192                                          amov #0x000000, xar6
     193                                          mov  *(#_save_new_pxcode), ar7
     194                                          mov ar7, *sp(#0)
     195                              mov *(#_save_new_pxlcode) , ar7
     196                              mov ssp, ar6
     197                              mov ar7, *ar6(#0)
     198                              mov dbl (*(#_save_xar6)), xar6
     199                                         .endif
     200              ; +++===+++
     201              $5:
     202                                              
     203              ; +++===+++
     204              ;; what about xssp here?
     205              ;;                              mov xsp, dbl (*(#_save_xsp))                    ; save xsp
     206              ;;                          mov xssp, dbl (*(#_save_xssp))                      ; save xssp
     207                                 .if configUSE_CONTEXT_DEBUG == 1
     208              ;; save current PC (and possible loop bits values)
     209              ;; for debug - to see if this is being corrupted
     210                                      mov dbl(*ar7), xar6
     211                                      mov dbl(*ar6), xar7
     212                                      mov xar7, dbl (*(#_PC_REG_LOW_SAVE))            ; save off the PC
     213                                      mov xssp, xar7
     214                                      mov dbl(*ar7), xar6
     215                                      mov dbl(*ar6), xar7
     216                                      mov xar7, dbl (*(#_PC_REG_HIGH_SAVE))           ; save off the PC
     217                                      mov xssp, xar7
     218                                      add #-2, ar7
     219                                      mov dbl(*ar7), xar6
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE    5

     220                                      mov xar6,  dbl (*(_DBSTAT_SAVE))
     221                          mov dbl (*(#_save_xar6)), xar6
     222              
     223              ;            mov (*ar7), (*(#_PC_REG_LOW_SAVE))
     224              ;            mov dbl(*xssp),(*(#_PC_REG_HIGH_SAVE))
     225              ;                       mov (*ssp(#-2)), (*(#_DBSTAT_SAVE))
     226                                      .endif
     227              ; +++===+++
     228                                      ; save context in our stack(s) frame
     229              
     230              ;;;;                    mov dbl (*(#_pxCurrentTCB)), xar7
     231              ;;;                     mov dbl (*ar7), xsp                             ; xsp contains our TCB now
     232              ;;;                     mov dbl (*ar7(#2)), xssp
     233              ; +++===+++
     234              ;                   mov dbl (*(#_pxCurrentTCB)), xar7
     235                                  ; add #0x0064, ar7
     236              ;                       mov dbl (*ar7), xsp                                     ; xsp contains our TCB now
     237              ;                       mov dbl (*ar7(#2)), xssp
     238              ;           add #0x0064, ar4
     239              ;                       add #0x0064, ar3
     240              ;                       mov dbl (*ar5), xar4                            ; xsp contains our TCB now
     241              ;                       mov dbl (*ar5(#2)), xar3                        ; xssp
     242              ;                       add #0x0064, ar4
     243              ;                       add #0x0064, ar3
     244                              amov #0x000000, xar7
     245                                      amov #0x000000, xar6
     246                                  mov dbl (*(#_pxCurrentTCB)), xar7
     247                                      mov dbl (*ar7), xar6                            ; xsp normal position
     248                                      add #0x0064, ar6
     249                                      mov xar6, xsp                                           ; actual xsp
     250                                      amov #0x000000, xar6
     251                                      mov dbl (*ar7(#2)), xar6                        ; xssp
     252                                      add #0x0002, ar6
     253                                      mov xar6, xssp
     254              
     255                          mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
     256                          mov dbl (*(#_save_xar6)), xar6
     257                          mov dbl (*(#_save_xar1)), xar1                  ; restore xar7
     258                          mov dbl (*(#_save_xar2)), xar2
     259                          mov dbl (*(#_save_xar3)), xar3                  ; restore xar7
     260                          mov dbl (*(#_save_xar4)), xar4
     261                         mov dbl (*(#_save_xar5)), xar5
     262                                        ; restore xar6
     263              ;;; begin context save:
     264              
     265                                      mov xar7, dbl(*sp(#8))                          ; save xar7
     266                                      mov ar7, *sp(#7)
     267              
     268                                      mov xar6, dbl(*sp(#10))
     269                                      mov ar6, *sp(#9)
     270              
     271                                      mov xar5, dbl(*sp(#12))
     272                                      mov ar5, *sp(#11)
     273              
     274                                      mov xar4, dbl(*sp(#14))
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE    6

     275                                      mov ar4, *sp(#13)
     276              
     277                                      mov xar3, dbl(*sp(#16))
     278                                      mov ar3, *sp(#15)
     279              
     280                                      mov xar2, dbl(*sp(#18))
     281                                      mov ar2, *sp(#17)
     282              
     283                                      mov xar1, dbl(*sp(#20))
     284                                      mov ar1, *sp(#19)
     285              
     286                                      mov xar0, dbl(*sp(#22))
     287                                      mov ar0, *sp(#21)
     288              
     289                          mov  ac0, dbl(*sp(#24))
     290                          mov ac0, *sp(#23)
     291              
     292                                      mov t3, *sp(#25)
     293                                      mov t2, *sp(#26)
     294                                      mov t1, *sp(#27)
     295                                      mov t0, *sp(#28)
     296              
     297              ;;                      mov xsp,  dbl (*(#_Ssave_xsp))                  ; save xsp
     298              ;;                      mov xssp, dbl (*(#_Ssave_xssp))
     299                                      .if 1
     300                                      amov #0x000000, xar7                                    ; save where we are in our IR
     301              ;                   mov dbl (*(#_Ssave_xsp)), xar7
     302                                   mov *(#_Ssave_xsp), ar7
     303              ;                   mov xar7, dbl(*sp(#29))
     304                          mov ar7, *sp(#30)
     305                          amov #0x000000, xar7
     306              ;                   mov dbl (*(#_Ssave_xssp)), xar7
     307                                  mov *(#_Ssave_xssp), ar7
     308              ;                   mov xar7, dbl(*sp(#31))
     309                          mov ar7, *sp(#32)
     310                                      .endif
     311              
     312                          mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
     313              
     314              ; +++===+++
     315              ;;                      mov mmap(ST0_55), t0
     316              ; - this is ok - we are not pushing - it's a relative stack frame
     317              ;                       mov t0, *sp(#25)
     318              ;;                      mov t0, *sp(#23)
     319              ;;                      mov mmap(ST1_55), t1
     320              ;                       mov t1, *sp(#26)                ; stomping on own mem
     321              ;;                      mov t1, *sp(#21)                ; stomping on own mem
     322              ;;                      mov mmap(ST2_55), t2
     323              ;;                      mov t2, *sp(#22)
     324              ;                       mov t2, *sp(#27)
     325              ;;                      mov mmap(ST2_55), t3
     326              ;                       mov t3, *sp(#28)
     327              ;;                      mov t3, *sp(#24)
     328              
     329              ;                       PSH dbl(AR0) ; 32-bit
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE    7

     330              ;                       PSH dbl(AR1) 
     331              ;                       PSH dbl(AR2) ; 32-bit
     332              ;                       PUSH XAR3 ; 32-bit
     333              ;                       PUSH XAR4 ; 32-bit
     334                              ;-- Comment these to save cycles --------
     335              ;                       PUSH XAR5 ; 32-bit
     336              ;                       PUSH XAR6 ; 32-bit
     337              ;                       PUSH XAR7 ; 32-bit
     338                              ;----------------------------------------
     339              
     340              ;                       PUSH XT   ; 32-bit
     341              
     342              ;                       movl xar6, @_portFLAGS_INT_ENABLED
     343              ;                       push xar6 ; portFLAGS_INT_ENABLED
     344              ; +++===+++
     345              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
     346              ;                       mov dbl (*ar7), xsp                                     ; xsp contains our TCB now
     347              ;                       mov dbl (*ar7(#2)), xssp
     348              
     349                                      mov dbl (*(#_portFLAGS_INT_ENABLED)), xar6
     350                                      mov xar6, dbl(*sp(#6))
     351              
     352              ;                       movl xar7, @_usCriticalNesting
     353              ;                       push xar7
     354                                      mov dbl (*(#_usCriticalNesting)), xar7
     355                                      mov xar7, dbl(*sp(#4))
     356              
     357                                      amov #0x000000, xar7
     358                                      amov #0x000000, xar6
     359              
     360                                      mov mmap(ST1_55), ar7
     361                                      mov ar7, *sp(#1)
     362                                      mov  mmap(ST2_55), ar7
     363                                      mov ar7, *sp(#2)
     364              
     365                                      mov ssp, ar7
     366              ;                       mov *(#_LOOP_BITS), ar6                 ; save LOOP_BITS (CFCT)
     367              ;                       and #0xFF00, ar6
     368              ;                       mov ar6, *ar7(#1)
     369              
     370                                      mov mmap(ST0_55), ar6
     371                                      mov ar6, *ar7(#2)
     372                                      
     373                                      mov *(#_DBSTAT_SAVE), ar6               ; save DBSTAT
     374                                      mov ar6, *ar7(#1)
     375              ; +++===+++
     376              ;                       mov dbl (*(#_save_xsp)), xsp                    ; restore xsp*
     377              ;                       mov dbl (*(#_save_xssp)), xssp          
     378              ;;;                     mov  dbl (*(_DBSTAT_SAVE)), *xar7(#2)   ; needs to be DBSTAT - don't overwrite DBSTAT
     379              ;;;                     mov ar6, *ar7(#2)
     380              ;                       mov ar7, mmap(ST0_55)
     381              ;                       mov *ssp(#2), ar7
     382              ; fix up
     383              ;                       aadd #20, sp
     384              ;                       mov sp, t0
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE    8

     385              ;                       sub #1, t0
     386              ;                       mov t0, ssp
     387              
     388                                      ; move contents of SP into address of current TCB
     389              ;                       mov xsp, dbl (*(#_pxCurrentTCB))                ; xsp contains our TCB now
     390              
     391              ;                       mov xar7, dbl (*(#_save_xar7))                  ; save xar7 
     392              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
     393              ;                       mov dbl (*ar7), xsp                             ; xsp contains our TCB now
     394              ;                       mov dbl (*ar7), xsp                             ; xsp contains our TCB now
     395              ;                       mov dbl (*ar7+), xssp
     396              
     397              ;                       mov sp, t0              ; we've already saved t0
     398              ;                       add #1, t0
     399              ;                       mov t0, ssp
     400              ; ??
     401              ;                       mov xsp, dbl (*(#_pxCurrentTCB))
     402              
     403              ;                       movl xar6, @_pxCurrentTCB ; XAR6 contains current TCB addr
     404              ;                       mov al, @sp
     405              ;                       movl  *xar6, acc        
     406              ;;                      mov  ar0, @sp
     407              ;;                      mov  @ar6, alxd
     408              ;;                      mov  ar0, @sp
     409              ;;                      movl 0(xar6), sp
     410              ;                       EDIS
     411              ;                       NASP
     412              ;; ;;                   mov dbl (*(#_save_xsp)), xsp    ; restore xsp           
     413              ;                       NOP
     414              ;                       .if configSTACK_PTR_DEBUG == 1
     415              ;                       mov xsp, dbl(*(#_Ssave_xsp))
     416              ;            mov xssp, dbl(*(#_Ssave_xssp))
     417              ;            .endif
     418                              .if 0
     419                                      mov  xar7, dbl (*(#_save_xar7))                 ; restore xar7
     420                          mov  xar6, dbl (*(#_save_xar6))
     421              
     422                              amov #0x000000, xar7
     423                                      amov #0x000000, xar6
     424                                  mov dbl (*(#_pxCurrentTCB)), xar7
     425                                      mov dbl (*ar7), xar6                            ; xsp normal position
     426                                      add #0x0064, ar6
     427                                      mov xar6, xsp                                           ; actual xsp
     428                                      mov dbl (*ar7(#2)), xar6                        ; xssp
     429                                      add #0x0002, ar6
     430                                      mov xar6, xssp
     431              
     432                          mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
     433                          mov dbl (*(#_save_xar6)), xar6
     434                        .endif
     435              
     436              ;;;;                    mov dbl (*(#_save_xsp)), xsp                    ; restore xsp*
     437              ;;;;                    mov dbl (*(#_save_xssp)), xssp
     438              
     439              ;                       mov dbl (*(#_Ssave_xsp)), xsp                   ; restore xsp*
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE    9

     440              ;                       mov dbl (*(#_Ssave_xssp)), xssp                 ; restore xssp
     441                          mov *(#_Ssave_xsp), sp                      ; restore xsp*
     442                                      mov *(#_Ssave_xssp), ssp
     443                                      nop
     444                                      aadd #-1, sp
     445                                      nop
     446              
     447                                      nop
     448                                                                                      ; ?
     449                                      .endm
     450              
     451              portRESTORE_CONTEXT .macro
     452                                      .C54CM_off
     453              ;                       .CPL_off
     454                                      .ARMS_off
     455                                      .align 4
     456              
     457              ; Restore context & return - here we need to know what context we're in
     458                                      ;CONTEXT_RESTORE
     459              ;                       ASP
     460              ;                       EALLOW
     461              ;                       nop
     462              ;                       nop
     463              ;                       nop
     464              ;                       nop
     465                              bclr C54CM
     466                              nop
     467                              nop
     468                              nop
     469                              nop
     470                              nop
     471                              nop
     472              ;               xssp = dbl(*(#_pxCurrentTCB))
     473              ;               xsp  = dbl(*(#_pxCurrentTCB))
     474                                      mov xar7, dbl (*(#_save_xar7))  
     475                                      mov xar6, dbl (*(#_save_xar6))
     476              
     477              ;;;;                     aadd #-3, sp                           ;;;;
     478              ;            aadd #-3, xsp
     479              ;            CMP *(#_first_flag) == #1, TC1 ; |216|
     480              ;            BCC $1,TC1 ; |216|
     481              ;;                      mov dbl (*(#_save_xsp)), xsp                    ; restore xsp***
     482              ;;                      mov dbl (*(#_save_xssp)), xssp                  ; restore xssp***
     483              ;            B $4
     484              ;;              aadd #-1, sp
     485                                      mov xsp, dbl (*(#_restore_xsp))                 ; save xsp
     486                                      mov xssp, dbl (*(#_restore_xssp))                       ; save xssp
     487               ;                      aadd #3, xsp
     488              ;;;             aadd #-3, sp
     489              
     490              ;;;;            mov dbl(*(#_root_xsp)), xsp
     491              ;;;;                    mov dbl(*(#_root_xssp)), xssp
     492              ;;;                     aadd #3, sp
     493              
     494              ;$1
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   10

     495              ;                       mov dbl (*(#_first_save_xsp)), xsp                      ; restore xsp
     496              ;                       mov dbl (*(#_first_save_xssp)), xssp                    ; restore xssp
     497              ;$4
     498                                      .if 1
     499              ;;                      aadd #-1, sp
     500              
     501                                      .if 0
     502                                      amov #0x000000, xar7                                    ; save where we are in our IR
     503                                  mov dbl (*(#_Ssave_xsp)), xar7
     504              ;                   mov xar7, dbl(*sp(#29))
     505              
     506                          amov #0x000000, xar7
     507                                  mov dbl (*(#_Ssave_xssp)), xar7
     508              ;                   mov xar7, dbl(*sp(#31))
     509                          mov ar7, *sp(#32)
     510                                      .endif
     511              
     512              
     513              ;;                      mov xsp, xar7
     514              ;;                      mov xssp, xar6
     515              
     516                                      amov #0x000000, xar2
     517                                      amov #0x000000, xar1
     518              
     519                                      mov dbl (*(#_pxCurrentTCB)), xar5
     520                                                                                               ;; points to our variables n
     521                                      mov dbl (*ar5), xar4                            ; xsp contains our TCB now
     522                                      mov dbl (*ar5(#2)), xar3
     523              
     524              ;;                      mov xar4, xar7
     525              ;;                      mov xar3, xar6
     526              ;;                      mov xar7, xsp
     527              ;;                      mov xar6, xssp
     528              
     529                                      add #0x0064, ar4
     530                                      add #0x0002, ar3
     531                                      
     532                                      mov xar4, xsp
     533                                      mov xar3, xssp
     534              
     535                                      amov #0x000000, xar7
     536                                      amov #0x000000, xar6
     537                              mov *sp(#30), ar7                       ; saved IRQ xsp
     538                              mov *sp(#32), ar6                       ; saved IRQ xssp
     539              
     540                                      mov xar7, xsp
     541                                      mov xar6, xssp
     542              
     543                                      mov *ar4, ar2
     544                                      mov *ar3, ar1                           ; maybe not on a yield here
     545              ;                       mov ar4, *ar6                           ; stack pointers fixed up
     546                                      mov ar2, *ar7
     547                                      mov ar1, *ar6
     548              
     549                                      mov xsp, dbl (*(#_restore_xsp))                 ; save xsp
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   11

     550                                      mov xssp, dbl (*(#_restore_xssp))
     551              
     552                                      mov mmap(ST1_55), ar7
     553                                      and #0xf7ff, ar7                        ; <here>#0800h
     554                                      mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
     555                                      mov ar7, *ar4(#1)                       ; save in TCB
     556                                      mov mmap(ST2_55), ar7
     557                                      mov ar7, *sp(#2)
     558                                      mov ar7, *ar4(#2)
     559              
     560                                      mov ssp, ar7
     561                                      mov mmap(ST0_55), ar6
     562                                      mov ar6, *ar7(#2)
     563                                      mov ar6, *ar3(#2)
     564                                      mov *(#_DBSTAT_SAVE), ar6               ; have to restore this
     565              ;;                      mov ar6, *ar7(#1)
     566                                      mov ar6, *ar3(#1)
     567                                      .endif
     568              
     569              ;                       mov #0, ssp     
     570              ;                       mov xar7, dbl (*(#_save_xar7))                  ; save xar7 
     571              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
     572                                      ; 32-bit mode - will act on SP and SSP:
     573              ;                       'fix-up' current SP and SSP - is this dangerous????
     574              ;                       aadd #-3, sp
     575              ;;                      mov *ar7, *sp
     576              ;                       mov dbl (*ar7), ar6
     577              ;                       mov ar6, *sp                            ; xsp contains our TCB now
     578              ;                       mov *ar7(#2), *ssp                      
     579              ;                       POP mmap(ST3_55)
     580              ;                       pshboth xar7                            ; should increment both
     581                                      .if 0
     582                                      mov mmap(ST1_55), ar7
     583                                      and #0xf7ff, ar7                        ; <here>#0800h
     584                                      mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
     585                                      mov mmap(ST2_55), ar7
     586                                      mov ar7, *sp(#2)
     587              
     588                                      mov ssp, ar7
     589                                      mov mmap(ST0_55), ar6
     590                                      mov ar6, *ar7(#2)
     591              ;;                      mov mmap(ST0_55), ar6   ; needs to be DBSTAT
     592              ;;                      mov ar6, *ar7(#1)
     593                                      .endif
     594              ; +++===+++
     595                                      .if 0
     596                                      mov dbl (*(#_pxCurrentTCB)), xar7
     597                                      mov dbl (*ar7), xsp                             ; xsp contains our TCB now
     598                                      mov dbl (*ar7(#2)), xssp        
     599                                      .endif
     600              ; +++===+++
     601                                      .if 0
     602                                      mov dbl (*(_xCompareTCB)), xar6
     603              ; need to restore our return address
     604                                      mov xar7, ac0
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   12

     605                                          mov xar6, ac1
     606                                          CMPU AC1 != AC0, TC1 ; |1393|
     607                                          BCC $6,TC1 ; |1393|
     608                                          amov #0x000000, xar7
     609                                          amov #0x000000, xar6
     610                                          mov  *(#_save_new_pxcode), ar7
     611                                          mov ar7, *sp(#0)
     612                                          mov *(#_save_new_pxlcode) , ar7
     613                                          mov ssp, ar6
     614                                          mov ar7, *ar6(#0)
     615              
     616                                          mov dbl (*(#_save_xar6)), xar6
     617                                                              .endif
     618              ; +++===+++
     619              $6:
     620              ;;                mov xsp, dbl (*(#_save_xsp))                  ; save xsp
     621              ;;                          mov xssp, dbl (*(#_save_xssp))                      ; save xssp
     622                                      .if configUSE_CONTEXT_RESTORE_DEBUG == 1
     623                                      mov xar7, dbl (*(#_save_xar7))                  ; save xar7
     624                                      mov xar6, dbl (*(#_save_xar6))
     625              
     626              ;; this is for debug
     627                                      mov dbl(*ar7), xar6
     628                                      mov dbl(*ar6), xar7
     629                                      mov xar7, dbl (*(#_PC_REG_LOW_RESTORE))         ; save off the PC
     630                                      mov xssp, xar7
     631                                      mov dbl(*ar7), xar6
     632                                      mov dbl(*ar6), xar7
     633                                      mov xar7, dbl (*(#_PC_REG_HIGH_RESTORE))                ; save off the PC
     634                                      mov xssp, xar7
     635                                      add #-2, ar7
     636                                      mov dbl(*ar7), xar6
     637                                      mov xar6,  dbl (*(_DBSTAT_RESTORE))
     638                                      mov dbl (*(#_save_xar6)), xar6
     639                                      
     640                                      mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
     641                                      .endif
     642              ; +++===+++
     643              ;                       mov mmap(ST0_55), *ssp(#1)
     644              ;                       mov mmap(STO_55), *ssp(#2)
     645              ;                       mov mmap(ST1_55), *sp(#1)
     646              ;                       mov mmap(ST2_55), *sp(#2)               ; needs to be DBSTAT                    
     647              ;                       mov *ar7, t0
     648              ;                       mov t0, *sp(#0)                         ; xsp contains our TCB now
     649              ;                       mov *ar7(#2), t0
     650              ;                       mov t0, *ssp(#0)                        
     651              
     652              ;                       mov  (*ar7), sp                                 ; xsp contains our TCB now
     653              ; what about xssp?
     654              ;                       mov xar6, xsp
     655              ;                       mov xssp, xar7
     656              ;                       add #1, ar7
     657              ;                       mov xar7, xsp
     658              ;                       mov sp, t0
     659              ;                       mov ssp, t1
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   13

     660              ;                       mov dbl(*(#_pxCurrentTCB)), xsp
     661              ;                       ar0 = *ar6
     662              ;                       xssp = xar0
     663              ;                       mov *xar6, xar0
     664              ;                       mov xar0, xssp  ; stack now points to our TCB
     665              ;;                      mov sp, *ar6
     666              ;;                      mov sp, ar0
     667              ;;                      mov sp, *_pxCurrentTCB
     668              ;;                      clr ar0
     669              ;;                      mov ar0, @xar6
     670              ;;                      mov sp, AR0
     671              ;;                      add sp, xar6
     672              
     673              ;;                      pshboth xar7
     674              ;;                      pshboth xar6
     675              ;;                      pshboth xar5
     676              
     677              ;;                      popboth xar5
     678              ;;                      popboth xar6
     679              ;;                      popboth xar7
     680              
     681              ;;;                     mov *sp(#1), ar7 
     682              ;                       mov dbl(*sp(#1)), ar7
     683              ;;;                     mov  ar7, mmap(ST1_55)
     684              ; +++===+++
     685              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
     686              ;                       add #0x0064, ar7
     687              ;                       mov dbl (*ar7), xsp                             ; xsp contains our TCB now
     688              ;                       mov *ar7(#2)
     689              ;                       mov dbl (*ar7(#2)), xssp
     690              ; ===+++===
     691                 .if 1
     692                              amov #0x000000, xar7
     693                                      amov #0x000000, xar6
     694                                  mov dbl (*(#_pxCurrentTCB)), xar7
     695                                      mov dbl (*ar7), xar6                            ; xsp normal position
     696                                      add #0x0064, ar6
     697                                      mov xar6, xsp                                           ; actual xsp
     698                                      mov dbl (*ar7(#2)), xar6                        ; xssp
     699                                      add #0x0002, ar6
     700                                      mov xar6, xssp
     701                 .endif
     702              ; ===+++===
     703              ;                       add #0x0064, xssp
     704              ; +++===+++
     705                                      .if 0
     706                                      mov *sp(#2), ar7
     707                                      mov ar7, mmap(ST2_55)
     708                                      mov ssp, ar7
     709                                      mov *ar7(#2), ar6
     710                                      mov ar6, mmap(ST0_55)
     711                                      .endif
     712              ;                       mov *ar7(#2), ar6
     713              ;                       mov ar6, *ssp(#2)
     714              ;                       mov *ssp(#2), ar7
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   14

     715              ;                       mov ar6, mmap(ST0_55)   ; needs to be DBSTAT
     716              ;
     717              ; restore context
     718              
     719                                      amov #0x000000, xar2
     720                                      amov #0x000000, xar1
     721              
     722                                      .if 0
     723                                      mov mmap(ST1_55), ar7
     724                                      and #0xf7ff, ar7                        ; <here>#0800h
     725                                      mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
     726                                      mov ar7, mmap(ST1_55)
     727              ;                       mov ar7, *ar4(#1)                       ; save in TCB
     728                                      mov mmap(ST2_55), ar7
     729                                      mov ar7, *sp(#2)
     730              ;                       mov ar7, *ar4(#2)
     731              
     732                                      mov ssp, ar7
     733                                      mov mmap(ST0_55), ar6
     734                                      mov ar6, *ar7(#2)
     735              ;                       mov ar6, *ar3(#2)
     736                                      mov *(#_DBSTAT_SAVE), ar6               ; have to restore this
     737                                      mov ar6, *ar7(#1)
     738              ;                       mov ar6, *ar3(#2)
     739                                      .endif
     740              ;;                      mov *(#_LOOP_BITS), ar6         ; have to restore this
     741              ;;                      and #0xFF00, ar6
     742              ;;                      mov ar6, *ar7(#1)
     743              
     744                                      mov dbl(*sp(#4)), xar7
     745              ;                       mov *sp(#1), ar7
     746                                      mov xar7, dbl(*(#_usCriticalNesting))   
     747              
     748                                      mov dbl(*sp(#6)), xar6
     749              ;                       mov *sp(#3), ar6
     750              ;                       popboth xar6 ; portFLAGS_INT_ENABLED
     751                                      mov xar6, dbl(*(#_portFLAGS_INT_ENABLED))       
     752              ;                       POP XT
     753                              ;-- Comment these to save cycles ---
     754                                      mov dbl(*sp(#8)), xar7
     755                                      mov *sp(#7), ar7
     756              ;                       mov *sp(#5), ar7
     757              ;                       mov dbl(*sp(#0)), hi(ar7)
     758              ;                       mov (*sp(#0)), lo(ar7)
     759                                      mov dbl(*sp(#10)), xar6
     760                                      mov *sp(#9), ar6
     761                                      mov dbl(*sp(#12)), xar5
     762                                      mov *sp(#11), ar5
     763              ;; pvPararmeters currently here - needs to be verified --- jcw
     764                                      mov dbl(*sp(#14)), xar4
     765                                      mov *sp(#13), ar4
     766                                      mov dbl(*sp(#16)), xar3
     767                                      mov *sp(#15), ar3
     768                                      mov dbl(*sp(#18)), xar2
     769                                      mov *sp(#17), ar2
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   15

     770                                      mov dbl(*sp(#20)), xar1
     771                                      mov *sp(#19), ar1
     772                                      mov dbl(*sp(#22)), xar0
     773                                      mov *sp(#21), ar0
     774                                  mov dbl(*sp(#24)), ac0
     775                          mov *sp(#23), ac0
     776              
     777                                      mov *sp(#25), t3
     778                                      mov *sp(#26), t2
     779                                      mov *sp(#27), t1
     780                                      mov *sp(#28), t0
     781              
     782              ;                       mov dbl(*sp(#21)), *xssp(#0)
     783              ;                       mov *sp(#21), *ssp
     784              ;                       mov *sp(#21), RETA
     785              ; need to move 23-16 to XSSP contents
     786              ;                       mov xar0, dbl (*(#_save_xar7))
     787              ;                       mov ssp, ar0
     788              ;                       mov #0, ssp 
     789              ;                       mov xssp, xar0
     790              ;                       mov dbl (*(#_save_xsp)), xar0                   ; save xsp
     791              ;                       aadd #20, sp            ; this is ok - ssp also incremented
     792                      ;               add #1, xssp            ; 32-bit return address pointer
     793                      ;               amar *xssp+
     794              ;                       mov sp, t0
     795              ;                       add #1, t0
     796              ;                       mov t0, ssp
     797              ;                       incr ssp
     798              ;                       asub #20, ar0
     799              ;                       mov xar0, xssp
     800              ;                       mov ar0, ssp
     801              ;                       mov ar0, 
     802              ;;                      mov *sp(#1), t0
     803              ;;                      mov *sp(#3), t3         ; ST0
     804              ;;                      mov *sp(#4), t2         ; DBSTAT
     805              ;;                      mov t3, *ar0(#2)
     806                      ;;              mov t2, *ar0(#1)
     807              ;;                      mov t0, *ar0(#0)
     808              
     809              ;;                      mov *sp(#5), t0
     810              ;;                      mov *sp(#6), t1
     811              ;;                      mov *sp(#7), t2
     812                      ;;              mov *sp(#8), t3
     813              
     814              ; restore ar0
     815              ;                       mov dbl(*sp(#-2)), xar0
     816              ;                       mov #-1, ar0
     817              ;;                      mov dbl (*(#_save_xar7)), xar0
     818              ;;
     819              ;;                      mov sp, t0
     820              ;;                      add #1, t0
     821              ;;                      mov t0, ssp
     822              
     823              ;                       mov *sp(#3), *(#00004ch+#1)
     824              
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   16

     825              ;                       mov t3, *ssp(#1) 
     826              ;                       mov t2, *ssp(#2)
     827              
     828              ;;                      mov *sp(#1), dbl(*(#_save_xsp)) 
     829              ;;                      mov t3, *(ssp(#0))
     830              ;                       mov t3, *ssp
     831              ;                       mov *sp(#3), t3 ; 
     832              ;                       mov t3, *ssp(#1)
     833              ;;                      mov *sp(#21), PC        
     834              
     835              ;; ;;                   mov dbl (*(#_save_xsp)), xsp    ; restore xsp           
     836              ;                       mov dbl(xsp), dbl(lcrpc)
     837              ;                       popboth XAR7
     838              ;                       add #1, sp
     839              ;                       add #1, ssp
     840              ;                       add #2, t0
     841              ;                       add #2, t1
     842              ;                       mov t0, sp
     843              ;                       mov t1, ssp
     844              ;                       popboth XAR6
     845              ;                       add #2, t0
     846              ;                       add #2, t1
     847              ;                       mov t0, sp
     848              ;                       mov t1, ssp
     849              ;                       popboth XAR5
     850              ;                       add #2, t0
     851              ;                       add #2, t1
     852              ;                       mov t0, sp
     853              ;                       mov t1, ssp
     854                              ;-----------------------------------
     855              ;                       popboth XAR4
     856              ;                       add #2, t0
     857              ;                       add #2, t1
     858              ;                       mov t0, sp
     859              ;                       mov t1, ssp
     860              ;                       popboth XAR3
     861              ;                       add #2, t0
     862              ;                       add #2, t1
     863              ;                       mov t0, sp
     864              ;                       mov t1, ssp
     865              ;                       popboth XAR2
     866              ;                       add #2, t0
     867              ;                       add #2, t1
     868              ;                       mov t0, sp
     869              ;                       mov t1, ssp
     870              ;                       popboth XAR1
     871              ;                       add #2, t0
     872              ;                       add #2, t1
     873              ;                       mov t0, sp
     874              ;                       mov t1, ssp
     875              ;                       popboth XAR0
     876              ;                       add #2, t0
     877              ;                       add #2, t1
     878              ;                       mov t0, sp
     879              ;                       mov t1, ssp
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   17

     880              ;                       EDIS
     881              ;                       NASP    ; Un-align stack pointer
     882              ;;                      pop mmap(ST3_55)
     883              ;            CMP *(#_first_flag) == #1, TC1 ; |216|
     884              ;            BCC $2,TC1 ; |216|
     885                                      .if 0
     886                                      mov dbl (*(#_pxCurrentTCB)), xar7
     887              
     888                                      mov dbl (*ar7), xsp                             ; xsp contains our TCB now
     889                                      mov dbl (*ar7(#2)), xssp                
     890                                      .endif
     891              
     892              ;;;              mov dbl(*(#_restore_xsp)), xsp
     893                           mov dbl(*(#_restore_xssp)), xssp
     894                           mov dbl(*(#_restore_xsp)), xsp
     895              
     896              ;;             aadd #-3, sp
     897              
     898              ;;;;                    mov dbl(*(#_root_xssp)), xssp
     899              ;;;                     aadd #3, sp
     900              ;;;;;;                  mov dbl (*(#_save_xsp)), xsp                    ; restore xsp***
     901              ;;;;;;                  mov dbl (*(#_save_xssp)), xssp                  ; restore xssp***
     902              
     903              
     904                                      .if 0
     905                                      mov dbl (*(_xCompareTCB)), xar6
     906              ; need to restore our return address
     907                                      mov xar7, ac0
     908                          mov xar6, ac1
     909                              CMPU AC1 != AC0, TC1 ; |1393|
     910                          BCC $6,TC1 ; |1393|
     911                          amov #0x000000, xar7
     912                                      amov #0x000000, xar6
     913                          mov  *(#_save_new_pxcode), ar7
     914                                      mov ar7, *sp(#0)
     915                          mov *(#_save_new_pxlcode) , ar7
     916                          mov ssp, ar6
     917                          mov ar7, *ar6(#0)
     918              
     919                          mov dbl (*(#_save_xar6)), xar6
     920                                      .endif
     921              
     922              ;;                      mov dbl (*(#_save_xar7)), xar7
     923              
     924              ;               .if configSTACK_PTR_DEBUG == 1
     925              ;;                      mov dbl(*(#_restore_xsp)), xsp
     926              ;;            mov dbl(*(#_restore_xssp)), xssp
     927              ;;            .endif
     928              
     929              ;                       B $3
     930              ;$2
     931              ;           MOV #0, *(#_first_flag) ; |217|
     932              ;               mov dbl (*(#_first_save_xsp)), xsp                      ; restore xsp
     933              ;                       mov dbl (*(#_first_save_xssp)), xssp
     934              ;$3
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   18

     935                                      .if 0
     936                              amov #0x000000, xar7
     937                                      amov #0x000000, xar6
     938                                  mov dbl (*(#_pxCurrentTCB)), xar7
     939                                      mov dbl (*ar7), xar6                            ; xsp normal position
     940                                      add #0x0064, ar6
     941                                      mov xar6, xsp                                           ; actual xsp
     942                                      mov dbl (*ar7(#2)), xar6                        ; xssp
     943                                      add #0x0002, ar6
     944                                      mov xar6, xssp
     945                                      .endif
     946              
     947              ;;;;                    aadd #-1, sp                    ; on yield, need to do this
     948                                      bclr INTM               ; enable interrupts
     949                                      nop
     950                                      nop
     951                                      nop
     952                                      nop
     953                                      nop
     954                                      nop
     955              
     956              ;                       aadd #1, sp
     957                                      RETI
     958              ;                       mov #1860h, ssp
     959                                      nop
     960                                      nop
     961              ;                       nop
     962                                      .endm
     963              
     964              
     965              portRESTORE_FIRST_CONTEXT .macro
     966                                      .C54CM_off
     967              ;                       .CPL_off
     968                                      .ARMS_off
     969                                      .align 4
     970              
     971              ; Restore context & return - here we restore into 'root' context
     972                                      ;CONTEXT_RESTORE
     973              ;                       ASP
     974              ;                       EALLOW
     975              ;                       nop
     976              ;                       nop
     977              ;                       nop
     978              ;                       nop
     979                              bclr C54CM
     980                              nop
     981                              nop
     982                              nop
     983              
     984              ;               xssp = dbl(*(#_pxCurrentTCB))
     985              ;               xsp  = dbl(*(#_pxCurrentTCB))
     986                                      mov xar7, dbl (*(#_save_xar7))  
     987              
     988              ; ****************************************************************************
     989              ; * Init Stack Pointer. Remember stack grows from high to low address *
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   19

     990              ; ****************************************************************************
     991              ;                       stm #_stack, sp ; set to begging of stack memory
     992              ;                       addm #(_STACK_SIZE  1), *(SP) ; add size to get to the top
     993              ;                       andm #0FFFEh, *(SP) ; make sure it is an even address
     994              
     995              ;;;                     aadd #-1, sp
     996              ;            aadd #-3, xsp
     997              ;            CMP *(#_first_flag) == #1, TC1 ; |216|
     998              ;            BCC $1,TC1 ; |216|
     999              ;                       mov dbl (*(#_save_xsp)), xsp                    ; restore xsp***
    1000              ;                       mov dbl (*(#_save_xssp)), xssp                  ; restore xssp***
    1001              ;            B $4
    1002              
    1003              ;;                      mov xsp, dbl (*(#_save_xsp))                    ; save xsp
    1004              ;;                      mov xssp, dbl (*(#_save_xssp))                  ; save xssp
    1005              
    1006              ;                       aadd #-3, sp
    1007              ;$1
    1008                                      mov dbl (*(#_first_save_xsp)), xsp                      ; restore xsp
    1009                                      mov dbl (*(#_first_save_xssp)), xssp                    ; restore xssp
    1010              ;$4
    1011               ;;;              mov dbl(*(#_root_xsp)), xsp
    1012               ;;;                      mov dbl(*(#_root_xssp)), xssp
    1013              
    1014                                      .if 1
    1015              ;;                      mov xsp, xar7
    1016              ;;                      mov xssp, xar6
    1017                                      mov  xsp, dbl (*(#_first_save_xsp))                     ; save xsp
    1018                                      mov  xssp, dbl (*(#_first_save_xssp))
    1019                                      amov #0x000000, xar2
    1020                                      amov #0x000000, xar1
    1021                                      amov #0x000000, xar3
    1022                                      amov #0x000000, xar4
    1023              
    1024                                      mov dbl (*(#_pxCurrentTCB)), xar5                               
    1025                                                                                              ;; everything from here is re
    1026                                      mov dbl (*ar5), xar4                            ; xsp contains our TCB now
    1027                                      mov dbl (*ar5(#2)), xar3                        ; xssp          
    1028              
    1029                                      mov xar4, xar7
    1030                                      mov xar3, xar6
    1031                                      mov xar7, xsp
    1032                                      mov xar6, xssp
    1033              
    1034                          add #0x0064, ar4
    1035                                      add #0x0002, ar3
    1036              
    1037                                      mov *ar4, ar2
    1038                                      mov *ar3, ar1
    1039              ;                       mov ar4, *ar6                           ; stack pointers fixed up
    1040                                      mov ar2, *ar7
    1041                                      mov ar1, *ar6
    1042                                      mov  xsp, dbl (*(#_first_save_xsp))                     ; save xsp
    1043                                      mov  xssp, dbl (*(#_first_save_xssp))
    1044                                      .endif;
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   20

    1045              ;                       amov #0x000000, xar7
    1046              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1047              
    1048              ;                       mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1049              ;                       mov dbl (*ar7(#2)), xssp
    1050                                      .if 1
    1051                          amov #0x000000, xar7
    1052                                  mov mmap(ST1_55), ar7
    1053                                      and #0xf7ff, ar7                        ; <here>#0800h
    1054                                      mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
    1055                                      mov ar7, *ar4(#1)                       ; save in TCB
    1056                                      mov mmap(ST2_55), ar7
    1057                                      mov ar7, *sp(#2)
    1058                                      mov ar7, *ar4(#2)
    1059                          amov #0x000000, xar6
    1060                                      amov #0x000000, xar7
    1061              
    1062                                      mov ssp, ar7
    1063                                      mov mmap(ST0_55), ar6
    1064                                      mov ar6, *ar7(#2)
    1065                                      mov ar6, *ar3(#2)
    1066                                      
    1067                                      mov *(#_DBSTAT_SAVE), ar6               ; have to restore this
    1068                                      mov ar6, *ar7(#1)
    1069                                      mov ar6, *ar3(#1)
    1070              
    1071                                      .endif
    1072              ;                       mov #0, ssp     
    1073              ;                       mov xar7, dbl (*(#_save_xar7))                  ; save xar7 
    1074              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1075                                      ; 32-bit mode - will act on SP and SSP:
    1076              ;                       'fix-up' current SP and SSP - is this dangerous????
    1077              ;                       aadd #-3, sp
    1078              ;;                      mov *ar7, *sp
    1079              ;                       mov dbl (*ar7), ar6
    1080              ;                       mov ar6, *sp                            ; xsp contains our TCB now
    1081              ;                       mov *ar7(#2), *ssp                      
    1082              ;                       POP mmap(ST3_55)
    1083              ;                       pshboth xar7                            ; should increment both
    1084                                      .if 0
    1085                                      mov mmap(ST1_55), ar7
    1086                                      and #0xf7ff, ar7                        ; <here>#0800h
    1087                                      mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
    1088                                      mov mmap(ST2_55), ar7
    1089                                      mov ar7, *sp(#2)
    1090              
    1091                                      mov ssp, ar7
    1092                                      mov mmap(ST0_55), ar6
    1093                                      mov ar6, *ar7(#2)
    1094                                      .endif
    1095              ;;                      mov mmap(ST0_55), ar6   ; needs to be DBSTAT
    1096              ;;                      mov ar6, *ar7(#1)
    1097              
    1098                                      .if 0
    1099                                      mov dbl (*(#_pxCurrentTCB)), xar7
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   21

    1100              
    1101                                      mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1102                                      mov dbl (*ar7(#2)), xssp        
    1103                                      .endif
    1104              
    1105                                      .if 0                                           ; first task - no pxcode update
    1106                                          mov dbl (*(_xCompareTCB)), xar6
    1107              ; need to restore our return address
    1108                                          mov xar7, ac0
    1109                                          mov xar6, ac1
    1110                                          CMPU AC1 != AC0, TC1 ; |1393|
    1111                                          BCC $7,TC1 ; |1393|
    1112                                          amov #0x000000, xar7
    1113                                          amov #0x000000, xar6
    1114                                          mov  *(#_save_new_pxcode), ar7
    1115                                          mov ar7, *sp(#0)
    1116                                          mov *(#_save_new_pxlcode) , ar7
    1117                                          mov ssp, ar6
    1118                                          mov ar7, *ar6(#0)
    1119              
    1120                                          mov dbl (*(#_save_xar6)), xar6
    1121                                          .endif
    1122              $7:
    1123              
    1124              ;;                mov xsp, dbl (*(#_save_xsp))                  ; save xsp
    1125              ;;                          mov xssp, dbl (*(#_save_xssp))                      ; save xssp
    1126                                      .if configUSE_CONTEXT_RESTORE_DEBUG == 1
    1127                                      mov xar7, dbl (*(#_save_xar7))                  ; save xar7
    1128                                      mov xar6, dbl (*(#_save_xar6))
    1129              
    1130              ;; this is for debug
    1131                                      mov dbl(*ar7), xar6
    1132                                      mov dbl(*ar6), xar7
    1133                                      mov xar7, dbl (*(#_PC_REG_LOW_RESTORE))         ; save off the PC
    1134                                      mov xssp, xar7
    1135                                      mov dbl(*ar7), xar6
    1136                                      mov dbl(*ar6), xar7
    1137                                      mov xar7, dbl (*(#_PC_REG_HIGH_RESTORE))                ; save off the PC
    1138                                      mov xssp, xar7
    1139                                      add #-2, ar7
    1140                                      mov dbl(*ar7), xar6
    1141                                      mov xar6,  dbl (*(_DBSTAT_RESTORE))
    1142                                      mov dbl (*(#_save_xar6)), xar6
    1143                                      
    1144                                      mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
    1145                                      .endif
    1146              
    1147              ;                       mov mmap(ST0_55), *ssp(#1)
    1148              ;                       mov mmap(STO_55), *ssp(#2)
    1149              ;                       mov mmap(ST1_55), *sp(#1)
    1150              ;                       mov mmap(ST2_55), *sp(#2)               ; needs to be DBSTAT                    
    1151              ;                       mov *ar7, t0
    1152              ;                       mov t0, *sp(#0)                         ; xsp contains our TCB now
    1153              ;                       mov *ar7(#2), t0
    1154              ;                       mov t0, *ssp(#0)                        
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   22

    1155              
    1156              ;                       mov  (*ar7), sp                                 ; xsp contains our TCB now
    1157              ; what about xssp?
    1158              ;                       mov xar6, xsp
    1159              ;                       mov xssp, xar7
    1160              ;                       add #1, ar7
    1161              ;                       mov xar7, xsp
    1162              ;                       mov sp, t0
    1163              ;                       mov ssp, t1
    1164              ;                       mov dbl(*(#_pxCurrentTCB)), xsp
    1165              ;                       ar0 = *ar6
    1166              ;                       xssp = xar0
    1167              ;                       mov *xar6, xar0
    1168              ;                       mov xar0, xssp  ; stack now points to our TCB
    1169              ;;                      mov sp, *ar6
    1170              ;;                      mov sp, ar0
    1171              ;;                      mov sp, *_pxCurrentTCB
    1172              ;;                      clr ar0
    1173              ;;                      mov ar0, @xar6
    1174              ;;                      mov sp, AR0
    1175              ;;                      add sp, xar6
    1176              
    1177              ;;                      pshboth xar7
    1178              ;;                      pshboth xar6
    1179              ;;                      pshboth xar5
    1180              
    1181              ;;                      popboth xar5
    1182              ;;                      popboth xar6
    1183              ;;                      popboth xar7
    1184              
    1185              ;;;                     mov *sp(#1), ar7 
    1186              ;                       mov dbl(*sp(#1)), ar7
    1187              ;;;                     mov  ar7, mmap(ST1_55)
    1188                      .if 1
    1189                                      amov #0x000000, xar7
    1190                                      amov #0x000000, xar6
    1191                                  mov dbl (*(#_pxCurrentTCB)), xar7
    1192                                      mov dbl (*ar7), xar6                            ; xsp normal position
    1193                                      add #0x0064, ar6
    1194                                      mov xar6, xsp                                           ; actual xsp
    1195                                      mov dbl (*ar7(#2)), xar6                        ; xssp
    1196                                      add #0x0002, ar6
    1197                                      mov xar6, xssp
    1198                  .endif
    1199                                      .if 0
    1200                                      mov *sp(#2), ar7
    1201                                      mov ar7, mmap(ST2_55)
    1202                                      mov ssp, ar7
    1203                                      mov *ar7(#2), ar6
    1204                                      mov ar6, mmap(ST0_55)
    1205                                      .endif
    1206              ;                       mov *ar7(#2), ar6
    1207              ;                       mov ar6, *ssp(#2)
    1208              ;                       mov *ssp(#2), ar7
    1209              ;                       mov ar6, mmap(ST0_55)   ; needs to be DBSTAT
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   23

    1210              
    1211                          amov #0x000000, xar7
    1212                                      amov #0x000000, xar6
    1213                                      .if 0
    1214                                      mov mmap(ST1_55), ar7
    1215                                      and #0xf7ff, ar7                        ; <here>#0800h
    1216                                      mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
    1217                                      mov ar7, *ar4(#1)                       ; save in TCB
    1218                          amov #0x000000, xar7
    1219                                      mov mmap(ST2_55), ar7
    1220                                      mov ar7, *sp(#2)
    1221                                      mov ar7, *ar4(#2)
    1222                          amov #0x000000, xar7
    1223                          amov #0x000000, xar6
    1224                                      mov ssp, ar7
    1225                                      mov mmap(ST0_55), ar6
    1226                                      mov ar6, *ar7(#2)
    1227                                      mov ar6, *ar3(#2)
    1228                                      mov *(#_DBSTAT_SAVE), ar6               ; have to restore this
    1229                                      mov ar6, *ar7(#1)
    1230              ;                       mov ar6, *ar3(#2)
    1231                                      .endif
    1232              ;                       mov *(#_LOOP_BITS), ar6         ; have to restore this
    1233              ;                       and #0xFF00, ar6
    1234              ;                       mov ar6, *ar7(#2)
    1235              
    1236                          amov #0x000000, xar7
    1237                                      mov dbl(*sp(#4)), xar7
    1238              ;                       mov *sp(#1), ar7
    1239                                      mov xar7, dbl(*(#_usCriticalNesting))   
    1240                          amov #0x000000, xar6
    1241                                      mov dbl(*sp(#6)), xar6
    1242              ;                       mov *sp(#3), ar6
    1243              ;                       popboth xar6 ; portFLAGS_INT_ENABLED
    1244                                      mov xar6, dbl(*(#_portFLAGS_INT_ENABLED))       
    1245              
    1246              ;                       POP XT
    1247                              ;-- Comment these to save cycles ---
    1248                                      mov dbl(*sp(#8)), xar7
    1249                                      mov *sp(#7), ar7
    1250              ;                       mov *sp(#5), ar7
    1251              ;                       mov dbl(*sp(#0)), hi(ar7)
    1252              ;                       mov (*sp(#0)), lo(ar7)
    1253                                      mov dbl(*sp(#10)), xar6
    1254                                      mov *sp(#9), ar6
    1255                                      mov dbl(*sp(#12)), xar5
    1256                                      mov *sp(#11), ar5
    1257              ;; pvPararmeters currently here - needs to be verified --- jcw
    1258                                      mov dbl(*sp(#14)), xar4
    1259                                      mov *sp(#13), ar4
    1260                                      mov dbl(*sp(#16)), xar3
    1261                                      mov *sp(#15), ar3
    1262                                      mov dbl(*sp(#18)), xar2
    1263                                      mov *sp(#17), ar2
    1264                                      mov dbl(*sp(#20)), xar1
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   24

    1265                                      mov *sp(#19), ar1
    1266                                      mov dbl(*sp(#22)), xar0
    1267                                      mov *sp(#21), ar0
    1268                          mov dbl(*sp(#24)), ac0
    1269                          mov *sp(#23), ac0
    1270              
    1271                                      mov *sp(#25), t3
    1272                                      mov *sp(#26), t2
    1273                                      mov *sp(#27), t1
    1274                                      mov *sp(#28), t0
    1275              
    1276                              .if 0
    1277              
    1278                              mov  xsp, dbl (*(#_first_save_xsp))                     ; save xsp
    1279                              mov  xssp, dbl (*(#_first_save_xssp))
    1280              
    1281                                      amov #0x000000, xar7
    1282                                  mov dbl (*(#_Ssave_xsp)), xar7
    1283                                  mov xar7, dbl(*sp(#30))
    1284                          mov ar7, *sp(#29)
    1285                          amov #0x000000, xar7
    1286                                  mov dbl (*(#_Ssave_xssp)), xar7
    1287                                  mov xar7, dbl(*sp(#32))
    1288                          mov ar7, *sp(#31)
    1289              
    1290                          mov dbl (*(#_save_xar7)), xar7
    1291              
    1292                              .endif
    1293              
    1294              ;                       mov dbl(*sp(#21)), *xssp(#0)
    1295              ;                       mov *sp(#21), *ssp
    1296              ;                       mov *sp(#21), RETA
    1297              ; need to move 23-16 to XSSP contents
    1298              ;                       mov xar0, dbl (*(#_save_xar7))
    1299              ;                       mov ssp, ar0
    1300              ;                       mov #0, ssp 
    1301              ;                       mov xssp, xar0
    1302              ;                       mov dbl (*(#_save_xsp)), xar0                   ; save xsp
    1303              ;                       aadd #20, sp            ; this is ok - ssp also incremented
    1304                      ;               add #1, xssp            ; 32-bit return address pointer
    1305                      ;               amar *xssp+
    1306              ;                       mov sp, t0
    1307              ;                       add #1, t0
    1308              ;                       mov t0, ssp
    1309              ;                       incr ssp
    1310              ;                       asub #20, ar0
    1311              ;                       mov xar0, xssp
    1312              ;                       mov ar0, ssp
    1313              ;                       mov ar0, 
    1314              ;;                      mov *sp(#1), t0
    1315              ;;                      mov *sp(#3), t3         ; ST0
    1316              ;;                      mov *sp(#4), t2         ; DBSTAT
    1317              ;;                      mov t3, *ar0(#2)
    1318                      ;;              mov t2, *ar0(#1)
    1319              ;;                      mov t0, *ar0(#0)
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   25

    1320              
    1321              ;;                      mov *sp(#5), t0
    1322              ;;                      mov *sp(#6), t1
    1323              ;;                      mov *sp(#7), t2
    1324                      ;;              mov *sp(#8), t3
    1325              
    1326              ; restore ar0
    1327              ;                       mov dbl(*sp(#-2)), xar0
    1328              ;                       mov #-1, ar0
    1329              ;;                      mov dbl (*(#_save_xar7)), xar0
    1330              ;;
    1331              ;;                      mov sp, t0
    1332              ;;                      add #1, t0
    1333              ;;                      mov t0, ssp
    1334              
    1335              ;                       mov *sp(#3), *(#00004ch+#1)
    1336              
    1337              ;                       mov t3, *ssp(#1) 
    1338              ;                       mov t2, *ssp(#2)
    1339              
    1340              ;;                      mov *sp(#1), dbl(*(#_save_xsp)) 
    1341              ;;                      mov t3, *(ssp(#0))
    1342              ;                       mov t3, *ssp
    1343              ;                       mov *sp(#3), t3 ; 
    1344              ;                       mov t3, *ssp(#1)
    1345              ;;                      mov *sp(#21), PC        
    1346              
    1347              ;; ;;                   mov dbl (*(#_save_xsp)), xsp    ; restore xsp           
    1348              ;                       mov dbl(xsp), dbl(lcrpc)
    1349              ;                       popboth XAR7
    1350              ;                       add #1, sp
    1351              ;                       add #1, ssp
    1352              ;                       add #2, t0
    1353              ;                       add #2, t1
    1354              ;                       mov t0, sp
    1355              ;                       mov t1, ssp
    1356              ;                       popboth XAR6
    1357              ;                       add #2, t0
    1358              ;                       add #2, t1
    1359              ;                       mov t0, sp
    1360              ;                       mov t1, ssp
    1361              ;                       popboth XAR5
    1362              ;                       add #2, t0
    1363              ;                       add #2, t1
    1364              ;                       mov t0, sp
    1365              ;                       mov t1, ssp
    1366                              ;-----------------------------------
    1367              ;                       popboth XAR4
    1368              ;                       add #2, t0
    1369              ;                       add #2, t1
    1370              ;                       mov t0, sp
    1371              ;                       mov t1, ssp
    1372              ;                       popboth XAR3
    1373              ;                       add #2, t0
    1374              ;                       add #2, t1
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   26

    1375              ;                       mov t0, sp
    1376              ;                       mov t1, ssp
    1377              ;                       popboth XAR2
    1378              ;                       add #2, t0
    1379              ;                       add #2, t1
    1380              ;                       mov t0, sp
    1381              ;                       mov t1, ssp
    1382              ;                       popboth XAR1
    1383              ;                       add #2, t0
    1384              ;                       add #2, t1
    1385              ;                       mov t0, sp
    1386              ;                       mov t1, ssp
    1387              ;                       popboth XAR0
    1388              ;                       add #2, t0
    1389              ;                       add #2, t1
    1390              ;                       mov t0, sp
    1391              ;                       mov t1, ssp
    1392              ;                       EDIS
    1393              ;                       NASP    ; Un-align stack pointer
    1394              ;;                      pop mmap(ST3_55)
    1395              ;            CMP *(#_first_flag) == #1, TC1 ; |216|
    1396              ;            BCC $2,TC1 ; |216|
    1397                                      .if 0
    1398                                      mov xar7, dbl (*(#_save_xar7))
    1399                                      amov #0x000000, xar7
    1400                                      mov dbl (*(#_pxCurrentTCB)), xar7
    1401              
    1402                                      mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1403                                      mov dbl (*ar7(#2)), xssp
    1404              
    1405              
    1406              
    1407              
    1408                                      .endif
    1409              
    1410              ;;                      mov dbl (*(#_save_xsp)), xsp                    ; restore xsp***
    1411              ;;                      mov dbl (*(#_save_xssp)), xssp                  ; restore xssp***
    1412              
    1413                                      .if 0
    1414                                      mov dbl (*(_xCompareTCB)), xar6
    1415              ; need to restore our return address
    1416                                      mov xar7, ac0
    1417                          mov xar6, ac1
    1418                              CMPU AC1 != AC0, TC1 ; |1393|
    1419                          BCC $6,TC1 ; |1393|
    1420                          amov #0x000000, xar7
    1421                                      amov #0x000000, xar6
    1422                          mov  *(#_save_new_pxcode), ar7
    1423                                      mov ar7, *sp(#0)
    1424                          mov *(#_save_new_pxlcode) , ar7
    1425                          mov ssp, ar6
    1426                          mov ar7, *ar6(#0)
    1427              
    1428                          mov dbl (*(#_save_xar6)), xar6
    1429                                      .endif
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   27

    1430              
    1431              ;;                      mov dbl (*(#_save_xar7)), xar7
    1432               ;           .if configSTACK_PTR_DEBUG == 1
    1433              ;                       mov xsp, dbl(*(#_restore_xsp))
    1434              ;            mov xssp, dbl(*(#_restore_xssp))
    1435              ;            .endif
    1436              ;                       B $3
    1437              ;$2
    1438              ;            MOV #0, *(#_first_flag) ; |217|
    1439              ;                       mov dbl (*(#_first_save_xsp)), xsp                      ; restore xsp
    1440              ;                       mov dbl (*(#_first_save_xssp)), xssp
    1441              ;$3
    1442              ;;                      mov xsp, dbl (*(#_save_xsp))                    ; save xsp
    1443              ;;                      mov xssp, dbl (*(#_save_xssp))                  ; save xssp
    1444              
    1445              ;;                      aadd #-3, sp
    1446              ;;                      mov dbl (*(#_first_save_xsp)), xsp                      ; restore xsp
    1447              ;;                      mov dbl (*(#_first_save_xssp)), xssp                    ; restore xssp
    1448              ;$4
    1449              ;;            mov dbl(*(#_root_xsp)), xsp
    1450              ;;                      mov dbl(*(#_root_xssp)), xssp
    1451              
    1452                          mov  dbl (*(#_first_save_xsp)), xsp                         ; save xsp
    1453                                      mov  dbl (*(#_first_save_xssp)), xssp
    1454              
    1455              ;                       aadd #-3, sp
    1456              ;                       aadd #1, sp
    1457                                      bclr INTM               ; enable interrupts
    1458                                      nop
    1459                                      nop
    1460                                      nop
    1461                                      nop
    1462                                      nop
    1463                                      nop
    1464              ;                       aadd #1, sp
    1465                                      RETI
    1466              ;                       mov #1860h, ssp
    1467                                      nop
    1468                                      nop
    1469              ;                       nop
    1470                                      .endm
    1471              ; /*-----------------------------------------------------------*/
    1472              
    1473              
    1474              
    1475              ; /*-----------------------------------------------------------*/
    1476              
    1477              ; /*
    1478              ; * The RTOS tick ISR.
    1479              ; *
    1480              ; * If the cooperative scheduler is in use this simply increments the tick
    1481              ; * count.
    1482              ; *
    1483              ; * If the preemptive scheduler is in use a context switch can also occur.
    1484              ; */
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   28

    1485              
    1486              
    1487 000000       _xPortStartScheduler:
    1488              
    1489              ;                /* Setup the hardware to generate the tick.  Interrupts are disabled
    1490              ;                when this function is called. */
    1491              
    1492 000000 EB31              mov xsp, dbl(*(#_root_xsp))
         000002 4500 
         000004 0000!
    1493 000006 EB31                          mov xssp, dbl(*(#_root_xssp))
         000008 5500 
         00000a 0000!
    1494              
    1495 00000c 4EFF                 aadd #-1, sp
    1496 00000e 6C00             call    #_prvSetupTimerInterrupt
         000010 0000!
    1497              
    1498              ;                /* Restore the context of the first task that is going to run. */
    1499              
    1500              ;;              INTR INT14      ; force interrupt - just for debug purposes.
    1501              
    1502              ;;            psh mmap(ST3_55)
    1503 000012 EB31                          mov xar7, dbl (*(#_save_xar7))                  ; save xar7
         000014 F500 
         000016 0000!
    1504 000018 EB31                          mov xar6, dbl (*(#_save_xar6))                  ; save xar6
         00001a E500 
         00001c 0000!
    1505              
    1506 00001e EC31                          amov #0x000000, xar7
         000020 FE00 
         000022 0000 
    1507 000024 EC31                          amov #0x000000, xar6
         000026 EE00 
         000028 0000 
    1508              
    1509 00002a ED31                          mov dbl (*(#_pxCurrentTCB)), xar7
         00002c FF00 
         00002e 0000!
    1510              ;                       add #0x0064, ar7
    1511              ; does this *always* work?
    1512 000030 EDED                          mov dbl (*ar7(#0)), xar6
         000032 EF00 
         000034 00   
    1513 000035 7B00                          add #0x0064, ar6
         000037 64EE 
    1514              
    1515              ;                       mov xsp, dbl (*(#_save_xsp))
    1516 000039 90E4                          mov xar6, xsp
    1517 00003b EB31                          mov xar6, dbl (*(#_save_xsp))
         00003d E500 
         00003f 0000!
    1518 000041 EB31                          mov xar6, dbl (*(#_first_save_xsp))     ; (init) xsp contains our TCB now
         000043 E500 
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   29

         000045 0000!
    1519                                                                              ; (init) xsp contains our TCB now
    1520 000047 EDED                          mov dbl (*ar7(#2)), xar6
         000049 EF00 
         00004b 02   
    1521 00004c 402E                          add #0x0002, ar6
    1522 00004e 90E5                          mov xar6, xssp
    1523              ;                       mov xar6, dbl (*(#_save_xsp))
    1524 000050 EB31                          mov xar6, dbl (*(#_save_xssp))
         000052 E500 
         000054 0000!
    1525 000056 EB31                          mov xar6, dbl (*(#_first_save_xssp))
         000058 E500 
         00005a 0000!
    1526              
    1527              ;                       mov #1, *(#_first_flag)
    1528                                      .if 0
    1529                                      amov #0x000000, xar7
    1530                                      amov #0x000000, xar6
    1531                                      mov ssp, ar7
    1532                                      mov *ar7(#2), ar6                               ; this is two away now
    1533                                      mov ar6, *(#_DBSTAT_SAVE)                       ; save DBSTAT
    1534                                      .endif
    1535              ; what about xssp here?
    1536 00005c ED31                          mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
         00005e FF00 
         000060 0000!
    1537 000062 ED31                          mov dbl (*(#_save_xar6)), xar6                  ; restore xar6
         000064 EF00 
         000066 0000!
    1538 000068 4E01                          aadd #1, sp
    1539              
    1540                          .if configSTACK_PTR_DEBUG == 1
    1541                                      mov xsp, dbl(*(#_restore_xsp))
    1542                          mov xssp, dbl(*(#_restore_xssp))
    1543                          .endif
    1544              
    1545              
    1546              
    1547 ****** MACRO                         portRESTORE_FIRST_CONTEXT
    1547                                      .C54CM_off
    1547              ;                       .CPL_off
    1547                                      .ARMS_off
    1547                                      .align 4
    1547              
    1547              ; Restore context & return - here we restore into 'root' context
    1547                                      ;CONTEXT_RESTORE
    1547              ;                       ASP
    1547              ;                       EALLOW
    1547              ;                       nop
    1547              ;                       nop
    1547              ;                       nop
    1547              ;                       nop
    1547 00006c 4652                  bclr C54CM
    1547 00006e 20                    nop
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   30

    1547 00006f 20                    nop
    1547 000070 20                    nop
    1547              
    1547              ;               xssp = dbl(*(#_pxCurrentTCB))
    1547              ;               xsp  = dbl(*(#_pxCurrentTCB))
    1547 000071 EB31                          mov xar7, dbl (*(#_save_xar7))  
         000073 F500 
         000075 0000!
    1547              
    1547              ; ****************************************************************************
    1547              ; * Init Stack Pointer. Remember stack grows from high to low address *
    1547              ; ****************************************************************************
    1547              ;                       stm #_stack, sp ; set to begging of stack memory
    1547              ;                       addm #(_STACK_SIZE  1), *(SP) ; add size to get to the top
    1547              ;                       andm #0FFFEh, *(SP) ; make sure it is an even address
    1547              
    1547              ;;;                     aadd #-1, sp
    1547              ;            aadd #-3, xsp
    1547              ;            CMP *(#_first_flag) == #1, TC1 ; |216|
    1547              ;            BCC $1,TC1 ; |216|
    1547              ;                       mov dbl (*(#_save_xsp)), xsp                    ; restore xsp***
    1547              ;                       mov dbl (*(#_save_xssp)), xssp                  ; restore xssp***
    1547              ;            B $4
    1547              
    1547              ;;                      mov xsp, dbl (*(#_save_xsp))                    ; save xsp
    1547              ;;                      mov xssp, dbl (*(#_save_xssp))                  ; save xssp
    1547              
    1547              ;                       aadd #-3, sp
    1547              ;$1
    1547 000077 ED31                          mov dbl (*(#_first_save_xsp)), xsp                      ; restore xsp
         000079 4F00 
         00007b 0000!
    1547 00007d ED31                          mov dbl (*(#_first_save_xssp)), xssp                    ; restore xssp
         00007f 5F00 
         000081 0000!
    1547              ;$4
    1547               ;;;              mov dbl(*(#_root_xsp)), xsp
    1547               ;;;                      mov dbl(*(#_root_xssp)), xssp
    1547              
    1547                                      .if 1
    1547              ;;                      mov xsp, xar7
    1547              ;;                      mov xssp, xar6
    1547 000083 EB31                          mov  xsp, dbl (*(#_first_save_xsp))                     ; save xsp
         000085 4500 
         000087 0000!
    1547 000089 EB31                          mov  xssp, dbl (*(#_first_save_xssp))
         00008b 5500 
         00008d 0000!
    1547 00008f EC31                          amov #0x000000, xar2
         000091 AE00 
         000093 0000 
    1547 000095 EC31                          amov #0x000000, xar1
         000097 9E00 
         000099 0000 
    1547 00009b EC31                          amov #0x000000, xar3
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   31

         00009d BE00 
         00009f 0000 
    1547 0000a1 EC31                          amov #0x000000, xar4
         0000a3 CE00 
         0000a5 0000 
    1547              
    1547 0000a7 ED31                          mov dbl (*(#_pxCurrentTCB)), xar5                               
         0000a9 DF00 
         0000ab 0000!
    1547                                                                                              ;; everything from here is re
    1547 0000ad EDA1                          mov dbl (*ar5), xar4                            ; xsp contains our TCB now
         0000af CF   
    1547 0000b0 EDAD                          mov dbl (*ar5(#2)), xar3                        ; xssp          
         0000b2 BF00 
         0000b4 02   
    1547              
    1547 0000b5 90CF                          mov xar4, xar7
    1547 0000b7 90BE                          mov xar3, xar6
    1547 0000b9 90F4                          mov xar7, xsp
    1547 0000bb 90E5                          mov xar6, xssp
    1547              
    1547 0000bd 7B00              add #0x0064, ar4
         0000bf 64CC 
    1547 0000c1 402B                          add #0x0002, ar3
    1547              
    1547 0000c3 AA81                          mov *ar4, ar2
    1547 0000c5 A961                          mov *ar3, ar1
    1547              ;                       mov ar4, *ar6                           ; stack pointers fixed up
    1547 0000c7 CAE1                          mov ar2, *ar7
    1547 0000c9 C9C1                          mov ar1, *ar6
    1547 0000cb EB31                          mov  xsp, dbl (*(#_first_save_xsp))                     ; save xsp
         0000cd 4500 
         0000cf 0000!
    1547 0000d1 EB31                          mov  xssp, dbl (*(#_first_save_xssp))
         0000d3 5500 
         0000d5 0000!
    1547                                      .endif;
    1547              ;                       amov #0x000000, xar7
    1547              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1547              
    1547              ;                       mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1547              ;                       mov dbl (*ar7(#2)), xssp
    1547                                      .if 1
    1547 0000d7 EC31              amov #0x000000, xar7
         0000d9 FE00 
         0000db 0000 
    1547 0000dd AF06                      mov mmap(ST1_55), ar7
         0000df 98   
    1547 0000e0 7DF7                          and #0xf7ff, ar7                        ; <here>#0800h
         0000e2 FFFF 
    1547 0000e4 CF02                          mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
    1547 0000e6 CF8D                          mov ar7, *ar4(#1)                       ; save in TCB
         0000e8 0001 
    1547 0000ea AF96                          mov mmap(ST2_55), ar7
         0000ec 98   
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   32

    1547 0000ed CF04                          mov ar7, *sp(#2)
    1547 0000ef CF8D                          mov ar7, *ar4(#2)
         0000f1 0002 
    1547 0000f3 EC31              amov #0x000000, xar6
         0000f5 EE00 
         0000f7 0000 
    1547 0000f9 EC31                          amov #0x000000, xar7
         0000fb FE00 
         0000fd 0000 
    1547              
    1547 0000ff 449F                          mov ssp, ar7
    1547 000101 AE04                          mov mmap(ST0_55), ar6
         000103 98   
    1547 000104 CEED                          mov ar6, *ar7(#2)
         000106 0002 
    1547 000108 CE6D                          mov ar6, *ar3(#2)
         00010a 0002 
    1547                                      
    1547 00010c AE31                          mov *(#_DBSTAT_SAVE), ar6               ; have to restore this
         00010e 0000 
         000110 00!  
    1547 000111 CEED                          mov ar6, *ar7(#1)
         000113 0001 
    1547 000115 CE6D                          mov ar6, *ar3(#1)
         000117 0001 
    1547              
    1547                                      .endif
    1547              ;                       mov #0, ssp     
    1547              ;                       mov xar7, dbl (*(#_save_xar7))                  ; save xar7 
    1547              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1547                                      ; 32-bit mode - will act on SP and SSP:
    1547              ;                       'fix-up' current SP and SSP - is this dangerous????
    1547              ;                       aadd #-3, sp
    1547              ;;                      mov *ar7, *sp
    1547              ;                       mov dbl (*ar7), ar6
    1547              ;                       mov ar6, *sp                            ; xsp contains our TCB now
    1547              ;                       mov *ar7(#2), *ssp                      
    1547              ;                       POP mmap(ST3_55)
    1547              ;                       pshboth xar7                            ; should increment both
    1547                                      .if 0
    1547                                      mov mmap(ST1_55), ar7
    1547                                      and #0xf7ff, ar7                        ; <here>#0800h
    1547                                      mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
    1547                                      mov mmap(ST2_55), ar7
    1547                                      mov ar7, *sp(#2)
    1547              
    1547                                      mov ssp, ar7
    1547                                      mov mmap(ST0_55), ar6
    1547                                      mov ar6, *ar7(#2)
    1547                                      .endif
    1547              ;;                      mov mmap(ST0_55), ar6   ; needs to be DBSTAT
    1547              ;;                      mov ar6, *ar7(#1)
    1547              
    1547                                      .if 0
    1547                                      mov dbl (*(#_pxCurrentTCB)), xar7
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   33

    1547              
    1547                                      mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1547                                      mov dbl (*ar7(#2)), xssp        
    1547                                      .endif
    1547              
    1547                                      .if 0                                           ; first task - no pxcode update
    1547                                          mov dbl (*(_xCompareTCB)), xar6
    1547              ; need to restore our return address
    1547                                          mov xar7, ac0
    1547                                          mov xar6, ac1
    1547                                          CMPU AC1 != AC0, TC1 ; |1393|
    1547                                          BCC $7,TC1 ; |1393|
    1547                                          amov #0x000000, xar7
    1547                                          amov #0x000000, xar6
    1547                                          mov  *(#_save_new_pxcode), ar7
    1547                                          mov ar7, *sp(#0)
    1547                                          mov *(#_save_new_pxlcode) , ar7
    1547                                          mov ssp, ar6
    1547                                          mov ar7, *ar6(#0)
    1547              
    1547                                          mov dbl (*(#_save_xar6)), xar6
    1547                                          .endif
    1547 000119       $7_$1$:
    1547              
    1547              ;;                mov xsp, dbl (*(#_save_xsp))                  ; save xsp
    1547              ;;                          mov xssp, dbl (*(#_save_xssp))                      ; save xssp
    1547                                      .if configUSE_CONTEXT_RESTORE_DEBUG == 1
    1547                                      mov xar7, dbl (*(#_save_xar7))                  ; save xar7
    1547                                      mov xar6, dbl (*(#_save_xar6))
    1547              
    1547              ;; this is for debug
    1547                                      mov dbl(*ar7), xar6
    1547                                      mov dbl(*ar6), xar7
    1547                                      mov xar7, dbl (*(#_PC_REG_LOW_RESTORE))         ; save off the PC
    1547                                      mov xssp, xar7
    1547                                      mov dbl(*ar7), xar6
    1547                                      mov dbl(*ar6), xar7
    1547                                      mov xar7, dbl (*(#_PC_REG_HIGH_RESTORE))                ; save off the PC
    1547                                      mov xssp, xar7
    1547                                      add #-2, ar7
    1547                                      mov dbl(*ar7), xar6
    1547                                      mov xar6,  dbl (*(_DBSTAT_RESTORE))
    1547                                      mov dbl (*(#_save_xar6)), xar6
    1547                                      
    1547                                      mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
    1547                                      .endif
    1547              
    1547              ;                       mov mmap(ST0_55), *ssp(#1)
    1547              ;                       mov mmap(STO_55), *ssp(#2)
    1547              ;                       mov mmap(ST1_55), *sp(#1)
    1547              ;                       mov mmap(ST2_55), *sp(#2)               ; needs to be DBSTAT                    
    1547              ;                       mov *ar7, t0
    1547              ;                       mov t0, *sp(#0)                         ; xsp contains our TCB now
    1547              ;                       mov *ar7(#2), t0
    1547              ;                       mov t0, *ssp(#0)                        
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   34

    1547              
    1547              ;                       mov  (*ar7), sp                                 ; xsp contains our TCB now
    1547              ; what about xssp?
    1547              ;                       mov xar6, xsp
    1547              ;                       mov xssp, xar7
    1547              ;                       add #1, ar7
    1547              ;                       mov xar7, xsp
    1547              ;                       mov sp, t0
    1547              ;                       mov ssp, t1
    1547              ;                       mov dbl(*(#_pxCurrentTCB)), xsp
    1547              ;                       ar0 = *ar6
    1547              ;                       xssp = xar0
    1547              ;                       mov *xar6, xar0
    1547              ;                       mov xar0, xssp  ; stack now points to our TCB
    1547              ;;                      mov sp, *ar6
    1547              ;;                      mov sp, ar0
    1547              ;;                      mov sp, *_pxCurrentTCB
    1547              ;;                      clr ar0
    1547              ;;                      mov ar0, @xar6
    1547              ;;                      mov sp, AR0
    1547              ;;                      add sp, xar6
    1547              
    1547              ;;                      pshboth xar7
    1547              ;;                      pshboth xar6
    1547              ;;                      pshboth xar5
    1547              
    1547              ;;                      popboth xar5
    1547              ;;                      popboth xar6
    1547              ;;                      popboth xar7
    1547              
    1547              ;;;                     mov *sp(#1), ar7 
    1547              ;                       mov dbl(*sp(#1)), ar7
    1547              ;;;                     mov  ar7, mmap(ST1_55)
    1547                      .if 1
    1547 000119 EC31                          amov #0x000000, xar7
         00011b FE00 
         00011d 0000 
    1547 00011f EC31                          amov #0x000000, xar6
         000121 EE00 
         000123 0000 
    1547 000125 ED31                      mov dbl (*(#_pxCurrentTCB)), xar7
         000127 FF00 
         000129 0000!
    1547 00012b EDE1                          mov dbl (*ar7), xar6                            ; xsp normal position
         00012d EF   
    1547 00012e 7B00                          add #0x0064, ar6
         000130 64EE 
    1547 000132 90E4                          mov xar6, xsp                                           ; actual xsp
    1547 000134 EDED                          mov dbl (*ar7(#2)), xar6                        ; xssp
         000136 EF00 
         000138 02   
    1547 000139 402E                          add #0x0002, ar6
    1547 00013b 90E5                          mov xar6, xssp
    1547                  .endif
    1547                                      .if 0
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   35

    1547                                      mov *sp(#2), ar7
    1547                                      mov ar7, mmap(ST2_55)
    1547                                      mov ssp, ar7
    1547                                      mov *ar7(#2), ar6
    1547                                      mov ar6, mmap(ST0_55)
    1547                                      .endif
    1547              ;                       mov *ar7(#2), ar6
    1547              ;                       mov ar6, *ssp(#2)
    1547              ;                       mov *ssp(#2), ar7
    1547              ;                       mov ar6, mmap(ST0_55)   ; needs to be DBSTAT
    1547              
    1547 00013d EC31              amov #0x000000, xar7
         00013f FE00 
         000141 0000 
    1547 000143 EC31                          amov #0x000000, xar6
         000145 EE00 
         000147 0000 
    1547                                      .if 0
    1547                                      mov mmap(ST1_55), ar7
    1547                                      and #0xf7ff, ar7                        ; <here>#0800h
    1547                                      mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
    1547                                      mov ar7, *ar4(#1)                       ; save in TCB
    1547                          amov #0x000000, xar7
    1547                                      mov mmap(ST2_55), ar7
    1547                                      mov ar7, *sp(#2)
    1547                                      mov ar7, *ar4(#2)
    1547                          amov #0x000000, xar7
    1547                          amov #0x000000, xar6
    1547                                      mov ssp, ar7
    1547                                      mov mmap(ST0_55), ar6
    1547                                      mov ar6, *ar7(#2)
    1547                                      mov ar6, *ar3(#2)
    1547                                      mov *(#_DBSTAT_SAVE), ar6               ; have to restore this
    1547                                      mov ar6, *ar7(#1)
    1547              ;                       mov ar6, *ar3(#2)
    1547                                      .endif
    1547              ;                       mov *(#_LOOP_BITS), ar6         ; have to restore this
    1547              ;                       and #0xFF00, ar6
    1547              ;                       mov ar6, *ar7(#2)
    1547              
    1547 000149 EC31              amov #0x000000, xar7
         00014b FE00 
         00014d 0000 
    1547 00014f ED08                          mov dbl(*sp(#4)), xar7
         000151 FF   
    1547              ;                       mov *sp(#1), ar7
    1547 000152 EB31                          mov xar7, dbl(*(#_usCriticalNesting))   
         000154 F500 
         000156 0000!
    1547 000158 EC31              amov #0x000000, xar6
         00015a EE00 
         00015c 0000 
    1547 00015e ED0C                          mov dbl(*sp(#6)), xar6
         000160 EF   
    1547              ;                       mov *sp(#3), ar6
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   36

    1547              ;                       popboth xar6 ; portFLAGS_INT_ENABLED
    1547 000161 EB31                          mov xar6, dbl(*(#_portFLAGS_INT_ENABLED))       
         000163 E500 
         000165 0000!
    1547              
    1547              ;                       POP XT
    1547                              ;-- Comment these to save cycles ---
    1547 000167 ED10                          mov dbl(*sp(#8)), xar7
         000169 FF   
    1547 00016a AF0E                          mov *sp(#7), ar7
    1547              ;                       mov *sp(#5), ar7
    1547              ;                       mov dbl(*sp(#0)), hi(ar7)
    1547              ;                       mov (*sp(#0)), lo(ar7)
    1547 00016c ED14                          mov dbl(*sp(#10)), xar6
         00016e EF   
    1547 00016f AE12                          mov *sp(#9), ar6
    1547 000171 ED18                          mov dbl(*sp(#12)), xar5
         000173 DF   
    1547 000174 AD16                          mov *sp(#11), ar5
    1547              ;; pvPararmeters currently here - needs to be verified --- jcw
    1547 000176 ED1C                          mov dbl(*sp(#14)), xar4
         000178 CF   
    1547 000179 AC1A                          mov *sp(#13), ar4
    1547 00017b ED20                          mov dbl(*sp(#16)), xar3
         00017d BF   
    1547 00017e AB1E                          mov *sp(#15), ar3
    1547 000180 ED24                          mov dbl(*sp(#18)), xar2
         000182 AF   
    1547 000183 AA22                          mov *sp(#17), ar2
    1547 000185 ED28                          mov dbl(*sp(#20)), xar1
         000187 9F   
    1547 000188 A926                          mov *sp(#19), ar1
    1547 00018a ED2C                          mov dbl(*sp(#22)), xar0
         00018c 8F   
    1547 00018d A82A                          mov *sp(#21), ar0
    1547 00018f ED30              mov dbl(*sp(#24)), ac0
         000191 08   
    1547 000192 A02E              mov *sp(#23), ac0
    1547              
    1547 000194 A732                          mov *sp(#25), t3
    1547 000196 A634                          mov *sp(#26), t2
    1547 000198 A536                          mov *sp(#27), t1
    1547 00019a A438                          mov *sp(#28), t0
    1547              
    1547                              .if 0
    1547              
    1547                              mov  xsp, dbl (*(#_first_save_xsp))                     ; save xsp
    1547                              mov  xssp, dbl (*(#_first_save_xssp))
    1547              
    1547                                      amov #0x000000, xar7
    1547                                  mov dbl (*(#_Ssave_xsp)), xar7
    1547                                  mov xar7, dbl(*sp(#30))
    1547                          mov ar7, *sp(#29)
    1547                          amov #0x000000, xar7
    1547                                  mov dbl (*(#_Ssave_xssp)), xar7
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   37

    1547                                  mov xar7, dbl(*sp(#32))
    1547                          mov ar7, *sp(#31)
    1547              
    1547                          mov dbl (*(#_save_xar7)), xar7
    1547              
    1547                              .endif
    1547              
    1547              ;                       mov dbl(*sp(#21)), *xssp(#0)
    1547              ;                       mov *sp(#21), *ssp
    1547              ;                       mov *sp(#21), RETA
    1547              ; need to move 23-16 to XSSP contents
    1547              ;                       mov xar0, dbl (*(#_save_xar7))
    1547              ;                       mov ssp, ar0
    1547              ;                       mov #0, ssp 
    1547              ;                       mov xssp, xar0
    1547              ;                       mov dbl (*(#_save_xsp)), xar0                   ; save xsp
    1547              ;                       aadd #20, sp            ; this is ok - ssp also incremented
    1547                      ;               add #1, xssp            ; 32-bit return address pointer
    1547                      ;               amar *xssp+
    1547              ;                       mov sp, t0
    1547              ;                       add #1, t0
    1547              ;                       mov t0, ssp
    1547              ;                       incr ssp
    1547              ;                       asub #20, ar0
    1547              ;                       mov xar0, xssp
    1547              ;                       mov ar0, ssp
    1547              ;                       mov ar0, 
    1547              ;;                      mov *sp(#1), t0
    1547              ;;                      mov *sp(#3), t3         ; ST0
    1547              ;;                      mov *sp(#4), t2         ; DBSTAT
    1547              ;;                      mov t3, *ar0(#2)
    1547                      ;;              mov t2, *ar0(#1)
    1547              ;;                      mov t0, *ar0(#0)
    1547              
    1547              ;;                      mov *sp(#5), t0
    1547              ;;                      mov *sp(#6), t1
    1547              ;;                      mov *sp(#7), t2
    1547                      ;;              mov *sp(#8), t3
    1547              
    1547              ; restore ar0
    1547              ;                       mov dbl(*sp(#-2)), xar0
    1547              ;                       mov #-1, ar0
    1547              ;;                      mov dbl (*(#_save_xar7)), xar0
    1547              ;;
    1547              ;;                      mov sp, t0
    1547              ;;                      add #1, t0
    1547              ;;                      mov t0, ssp
    1547              
    1547              ;                       mov *sp(#3), *(#00004ch+#1)
    1547              
    1547              ;                       mov t3, *ssp(#1) 
    1547              ;                       mov t2, *ssp(#2)
    1547              
    1547              ;;                      mov *sp(#1), dbl(*(#_save_xsp)) 
    1547              ;;                      mov t3, *(ssp(#0))
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   38

    1547              ;                       mov t3, *ssp
    1547              ;                       mov *sp(#3), t3 ; 
    1547              ;                       mov t3, *ssp(#1)
    1547              ;;                      mov *sp(#21), PC        
    1547              
    1547              ;; ;;                   mov dbl (*(#_save_xsp)), xsp    ; restore xsp           
    1547              ;                       mov dbl(xsp), dbl(lcrpc)
    1547              ;                       popboth XAR7
    1547              ;                       add #1, sp
    1547              ;                       add #1, ssp
    1547              ;                       add #2, t0
    1547              ;                       add #2, t1
    1547              ;                       mov t0, sp
    1547              ;                       mov t1, ssp
    1547              ;                       popboth XAR6
    1547              ;                       add #2, t0
    1547              ;                       add #2, t1
    1547              ;                       mov t0, sp
    1547              ;                       mov t1, ssp
    1547              ;                       popboth XAR5
    1547              ;                       add #2, t0
    1547              ;                       add #2, t1
    1547              ;                       mov t0, sp
    1547              ;                       mov t1, ssp
    1547                              ;-----------------------------------
    1547              ;                       popboth XAR4
    1547              ;                       add #2, t0
    1547              ;                       add #2, t1
    1547              ;                       mov t0, sp
    1547              ;                       mov t1, ssp
    1547              ;                       popboth XAR3
    1547              ;                       add #2, t0
    1547              ;                       add #2, t1
    1547              ;                       mov t0, sp
    1547              ;                       mov t1, ssp
    1547              ;                       popboth XAR2
    1547              ;                       add #2, t0
    1547              ;                       add #2, t1
    1547              ;                       mov t0, sp
    1547              ;                       mov t1, ssp
    1547              ;                       popboth XAR1
    1547              ;                       add #2, t0
    1547              ;                       add #2, t1
    1547              ;                       mov t0, sp
    1547              ;                       mov t1, ssp
    1547              ;                       popboth XAR0
    1547              ;                       add #2, t0
    1547              ;                       add #2, t1
    1547              ;                       mov t0, sp
    1547              ;                       mov t1, ssp
    1547              ;                       EDIS
    1547              ;                       NASP    ; Un-align stack pointer
    1547              ;;                      pop mmap(ST3_55)
    1547              ;            CMP *(#_first_flag) == #1, TC1 ; |216|
    1547              ;            BCC $2,TC1 ; |216|
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   39

    1547                                      .if 0
    1547                                      mov xar7, dbl (*(#_save_xar7))
    1547                                      amov #0x000000, xar7
    1547                                      mov dbl (*(#_pxCurrentTCB)), xar7
    1547              
    1547                                      mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1547                                      mov dbl (*ar7(#2)), xssp
    1547              
    1547              
    1547              
    1547              
    1547                                      .endif
    1547              
    1547              ;;                      mov dbl (*(#_save_xsp)), xsp                    ; restore xsp***
    1547              ;;                      mov dbl (*(#_save_xssp)), xssp                  ; restore xssp***
    1547              
    1547                                      .if 0
    1547                                      mov dbl (*(_xCompareTCB)), xar6
    1547              ; need to restore our return address
    1547                                      mov xar7, ac0
    1547                          mov xar6, ac1
    1547                              CMPU AC1 != AC0, TC1 ; |1393|
    1547                          BCC $6,TC1 ; |1393|
    1547                          amov #0x000000, xar7
    1547                                      amov #0x000000, xar6
    1547                          mov  *(#_save_new_pxcode), ar7
    1547                                      mov ar7, *sp(#0)
    1547                          mov *(#_save_new_pxlcode) , ar7
    1547                          mov ssp, ar6
    1547                          mov ar7, *ar6(#0)
    1547              
    1547                          mov dbl (*(#_save_xar6)), xar6
    1547                                      .endif
    1547              
    1547              ;;                      mov dbl (*(#_save_xar7)), xar7
    1547               ;           .if configSTACK_PTR_DEBUG == 1
    1547              ;                       mov xsp, dbl(*(#_restore_xsp))
    1547              ;            mov xssp, dbl(*(#_restore_xssp))
    1547              ;            .endif
    1547              ;                       B $3
    1547              ;$2
    1547              ;            MOV #0, *(#_first_flag) ; |217|
    1547              ;                       mov dbl (*(#_first_save_xsp)), xsp                      ; restore xsp
    1547              ;                       mov dbl (*(#_first_save_xssp)), xssp
    1547              ;$3
    1547              ;;                      mov xsp, dbl (*(#_save_xsp))                    ; save xsp
    1547              ;;                      mov xssp, dbl (*(#_save_xssp))                  ; save xssp
    1547              
    1547              ;;                      aadd #-3, sp
    1547              ;;                      mov dbl (*(#_first_save_xsp)), xsp                      ; restore xsp
    1547              ;;                      mov dbl (*(#_first_save_xssp)), xssp                    ; restore xssp
    1547              ;$4
    1547              ;;            mov dbl(*(#_root_xsp)), xsp
    1547              ;;                      mov dbl(*(#_root_xssp)), xssp
    1547              
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   40

    1547 00019c ED31              mov  dbl (*(#_first_save_xsp)), xsp                         ; save xsp
         00019e 4F00 
         0001a0 0000!
    1547 0001a2 ED31                          mov  dbl (*(#_first_save_xssp)), xssp
         0001a4 5F00 
         0001a6 0000!
    1547              
    1547              ;                       aadd #-3, sp
    1547              ;                       aadd #1, sp
    1547 0001a8 46B2                          bclr INTM               ; enable interrupts
    1547 0001aa 20                            nop
    1547 0001ab 20                            nop
    1547 0001ac 20                            nop
    1547 0001ad 20                            nop
    1547 0001ae 20                            nop
    1547 0001af 20                            nop
    1547              ;                       aadd #1, sp
    1547 0001b0 4805                          RETI
    1547              ;                       mov #1860h, ssp
    1547 0001b2 20                            nop
    1547 0001b3 20                            nop
    1547              ;                       nop
    1548              
    1549              
    1550 0001b4       _vTickISR:              ; the timer ISR is aggregated for this processor architecture
    1551               ;               bclr IFR0.IF4          ; enable interrupts
    1552 0001b4 F406          AND #0xf91f, mmap(ST1_55)
         0001b6 F91F 
         0001b8 98   
    1553 0001b9 F506          OR #0x4100, mmap(ST1_55)
         0001bb 4100 
         0001bd 98   
    1554 0001be F496          AND #0xfa00, mmap(ST2_55)
         0001c0 FA00 
         0001c2 98   
    1555 0001c3 F596          OR #0x8000, mmap(ST2_55)
         0001c5 8000 
         0001c7 98   
    1556 0001c8 4EFF          aadd #-1, sp
    1557              ;;;        aadd #1, sp
    1558                          .if 0
    1559                                                  mov xar7, dbl (*(#_save_xar7))                  ; save xar7
    1560                                      mov xar6, dbl (*(#_save_xar6))                  ; save x
    1561              
    1562                                                              amov #0x000000, xar7
    1563                                                              amov #0x000000, xar6
    1564              
    1565              
    1566                                      mov *sp(#0), ar7                                            ;; sp+3
    1567                                      mov ar7, *(#_save_new_pxcode)
    1568                                      mov ssp, ar6
    1569                                      mov *ar6(#0), ar7                                                       ;; ssp+3
    1570                                      mov ar7, *(#_save_new_pxlcode)       ;  ==> now we have our new return address, and i
    1571                                      amov #0x000000, xar7
    1572                                      mov *ar6(#1), ar7                               ; this is two away now
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   41

    1573                                                              mov ar7, *(#_DBSTAT_SAVE)
    1574                                   ;   nop
    1575                                      mov dbl (*(#_pxCurrentTCB)), xar7
    1576                                      mov xar7, dbl(*(#_xCompareTCB))
    1577                                      .endif
    1578              
    1579                                                      .if 0
    1580              
    1581                                   PSH mmap(@ST3_55)
    1582                                   AND #30976,mmap(@ST1_55)
    1583                                   BSET ST2_ARMS
    1584                                   BSET ST1_CPL
    1585                                   BSET ST3_SMUL
    1586                                   BSET ST1_SXMD
    1587                                               BCLR ST3_SATA
    1588                                               BCLR ST3_SST
    1589                                   AND #64000,mmap(@ST2_55)
    1590                                   PSHBOTH XAR0
    1591                                   PSHBOTH XAR1
    1592                                   PSHBOTH XAR2
    1593                                   PSHBOTH XAR3
    1594                                   PSHBOTH XAR4
    1595                                   PSH T0,T1
    1596                                   PSH mmap(@AC0G)
    1597                                   PSHBOTH AC0
    1598                                   PSH mmap(@AC1G)
    1599                                   PSHBOTH AC1
    1600                                   PSH mmap(@AC2G)
    1601                                   PSHBOTH AC2
    1602                                   PSH mmap(@AC3G)
    1603                                   PSHBOTH AC3
    1604                                   PSH mmap(@BRS1)
    1605                                   PSH mmap(@BRC1)
    1606                                   PSH mmap(@TRN0)
    1607                                   PSH mmap(@RPTC)
    1608                                   PSH mmap(@BK03)
    1609                                   PSH mmap(@BRC0)
    1610                                   PSH mmap(@CDP)
    1611                                   PSH mmap(@DPH)
    1612                                   AMAR *(#0002eh),XAR1               ; cpu st3_55
    1613                                   RPT #10            ;       repeats next 10 times
    1614                                   PSH dbl(*AR1+)
    1615                                   PSH mmap(@CDPH)
    1616                                   PSHBOTH XAR5
    1617                                   MOV XSP,XAR5                       ; xsp
    1618                                   AND #65534,mmap(@SP)               ; SP alignment (?)
    1619                                                      .endif
    1620                                                                      ;;
    1621 0001ca E651                  MOV #0, *port(#6166) ; |119|
         0001cc 0018 
         0001ce 16   
    1622 0001cf F402                  AND #0x0010, mmap(@IFR0)
         0001d1 0010 
         0001d3 98   
    1623 0001d4 46B3                  bset INTM
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   42

    1624 0001d6 20                    nop
    1625 0001d7 20                    nop
    1626 0001d8 20                    nop
    1627 0001d9 20                    nop
    1628 0001da 20                    nop
    1629 0001db 20                    nop
    1630              
    1631              ;           MOV *port(#7188), AR1 ; |68|                ;; TIMER0 is only timer that is active
    1632              ;        BSET @#0, AR1 ; |68|
    1633              ;        BCC $1,AR1 == #0 ; |68|
    1634              ;        AND #0x0010, *(#1)
    1635              ;               bset INTM               ; disable interrupts
    1636                              .if configUSE_TICK_CTR == 1
    1637 0001dc F731                  add #1, *(#_tickIRQctr)
         0001de 0001 
         0001e0 0000 
         0001e2 00!  
    1638                              .endif
    1639              ;;              psh mmap(ST3_55)
    1640                  .if 1
    1641 0001e3 EB31                                      mov xar7, dbl (*(#_save_xar7))                  ; save xar7
         0001e5 F500 
         0001e7 0000!
    1642 0001e9 EB31                          mov xar6, dbl (*(#_save_xar6))                  ; save x
         0001eb E500 
         0001ed 0000!
    1643 0001ef EC31                                                  amov #0x000000, xar7
         0001f1 FE00 
         0001f3 0000 
    1644 0001f5 EC31                                                  amov #0x000000, xar6
         0001f7 EE00 
         0001f9 0000 
    1645              
    1646 0001fb AF02                          mov *sp(#1), ar7                                            ;; sp+3
    1647 0001fd CF31                          mov ar7, *(#_save_new_pxcode)
         0001ff 0000 
         000201 00!  
    1648 000202 449E                          mov ssp, ar6
    1649 000204 AFCD                          mov *ar6(#1), ar7                                                       ;; ssp+3
         000206 0001 
    1650 000208 CF31                          mov ar7, *(#_save_new_pxlcode)       ;  ==> now we have our new return address, and i
         00020a 0000 
         00020c 00!  
    1651 00020d EC31                          amov #0x000000, xar7
         00020f FE00 
         000211 0000 
    1652 000213 AFCD                          mov *ar6(#2), ar7                               ; this is two away now
         000215 0002 
    1653 000217 CF31                                                  mov ar7, *(#_DBSTAT_SAVE)               ;; this is just for r
         000219 0000 
         00021b 00!  
    1654                                   ;   nop
    1655 00021c ED31                          mov dbl (*(#_pxCurrentTCB)), xar7
         00021e FF00 
         000220 0000!
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   43

    1656 000222 EB31                          mov xar7, dbl(*(#_xCompareTCB))
         000224 F500 
         000226 0000!
    1657                                      .endif
    1658                      .if 0
    1659                      ;               mov xar7, dbl (*(#_save_xar7))                  ; save xar7
    1660                  ;        mov xar6, dbl (*(#_save_xar6))
    1661                                      amov #0x000000, xar7
    1662                                      amov #0x000000, xar6
    1663                                      mov ssp, ar7
    1664                                      mov *ar7(#2), ar6                               ; this is two away now
    1665                                      mov ar6, *(#_DBSTAT_SAVE)                       ; save DBSTAT
    1666                                      .endif
    1667                          ;;            mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
    1668                          ;;            mov dbl (*(#_save_xar6)), xar6                  ; restore xar6
    1669              ;;              mov xsp, dbl (*(#_save_xsp))
    1670              ;;              mov xssp, dbl (*(#_save_xssp))
    1671                                      .if configSTACK_PTR_DEBUG == 1
    1672                                      mov xsp, dbl(*(#_Ssave_xsp))
    1673                          mov xssp, dbl(*(#_Ssave_xssp))
    1674                          .endif
    1675              ;;;        aadd #1, sp
    1676 ****** MACRO         portSAVE_CONTEXT
    1676              ;                       ;CONTEXT_SAVE
    1676              ;                       ASP  ; Align Stack Pointer
    1676              ;                       CLRC       OVM,PAGE0
    1676              ;                       CLRC       AMODE
    1676              ;                       EALLOW
    1676 000228 4652                  bclr C54CM      ; temp - until we figure out what is setting this
    1676              ;;;             bset INTM               ; disable interrupts - already done
    1676              ;                       aadd #1, sp
    1676 00022a 20                            nop
    1676 00022b 20                            nop
    1676 00022c 20                            nop
    1676              
    1676              ;;                      mov xsp,  dbl (*(#_Ssave_xsp))                  ; save xsp
    1676              ;;                      mov xssp, dbl (*(#_Ssave_xssp))                 ; save xssp
    1676              ;;;                     mov dbl (*(#_save_xsp)), xsp                    ; restore xsp***
    1676              ;;;                     mov dbl (*(#_save_xssp)), xssp                  ; restore xssp***
    1676              
    1676              ;                       pshboth xar7
    1676              ;                       pshboth xar6
    1676              ;                       pshboth xar5
    1676              
    1676              ;;;;                    mov xar7, dbl (*(#_save_xar7))                  ; save xar7 (already saved)
    1676              ;                       .if configUSE_CONTEXT_DEBUG == 1
    1676              ;;;;                    mov xar6, dbl (*(#_save_xar6))                  ; saved in vTick ISR already
    1676              ;                       .endif
    1676 00022d 4E01                          aadd #1, sp
    1676              ;;                  mov xsp,  dbl (*(#_Ssave_xsp))                      ; save xsp
    1676              ;;                      mov xssp, dbl (*(#_Ssave_xssp))
    1676              
    1676 00022f E531                          mov sp,  *(#_Ssave_xsp)                 ; save xsp
         000231 7800 
         000233 0000!
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   44

    1676 000235 E531                          mov ssp, *(#_Ssave_xssp)
         000237 8800 
         000239 0000!
    1676              
    1676              ; +++===+++
    1676              
    1676                                      .if 1                                                           ; need to figure out 
    1676 00023b EB31                          mov xar1, dbl (*(#_save_xar1))
         00023d 9500 
         00023f 0000!
    1676 000241 EB31                          mov xar2, dbl (*(#_save_xar2))
         000243 A500 
         000245 0000!
    1676 000247 EB31                          mov xar3, dbl (*(#_save_xar3))
         000249 B500 
         00024b 0000!
    1676 00024d EB31                          mov xar4, dbl (*(#_save_xar4))
         00024f C500 
         000251 0000!
    1676 000253 EB31                          mov xar5, dbl (*(#_save_xar5))
         000255 D500 
         000257 0000!
    1676 000259 EC31                          amov #0x000000, xar5
         00025b DE00 
         00025d 0000 
    1676 00025f EC31                          amov #0x000000, xar6
         000261 EE00 
         000263 0000 
    1676 000265 904D                          mov xsp, xar5
    1676 000267 905E                          mov xssp, xar6
    1676              
    1676 000269 EC31                          amov #0x000000, xar2
         00026b AE00 
         00026d 0000 
    1676 00026f EC31                          amov #0x000000, xar1
         000271 9E00 
         000273 0000 
    1676 000275 EC31                          amov #0x000000, xar3
         000277 BE00 
         000279 0000 
    1676 00027b EC31                          amov #0x000000, xar4
         00027d CE00 
         00027f 0000 
    1676 000281 ED31                          mov dbl (*(#_pxCurrentTCB)), xar7
         000283 FF00 
         000285 0000!
    1676              
    1676 000287 EDE1                          mov dbl (*ar7), xar4                            ; xsp contains our TCB now
         000289 CF   
    1676 00028a EDED                          mov dbl (*ar7(#2)), xar3
         00028c BF00 
         00028e 02   
    1676 00028f 7B00                          add #0x0064, ar4
         000291 64CC 
    1676 000293 402B                          add #0x0002, ar3
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   45

    1676              
    1676 000295 AAAD                          mov *ar5(#0), ar2                               ; current xsp contents
         000297 0000 
    1676 000299 A9CD                          mov *ar6(#0), ar1                               ; current xssp contents
         00029b 0000 
    1676              ;                       mov ar4, *ar6                           ; stack pointers fixed up
    1676 00029d CA81                          mov ar2, *ar4                           ; saves our new PC - but, does this work in e
    1676 00029f C961                          mov ar1, *ar3
    1676              
    1676                                      .endif
    1676              ;;                      aadd #1, sp
    1676                                      .if 0
    1676                          amov #0x000000, xar7
    1676                                      mov dbl (*(#_pxCurrentTCB)), xar7
    1676                                      mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1676                                      mov dbl (*ar7(#2)), xssp
    1676                          amov #0x000000, xar7
    1676                                      amov #0x000000, xar6
    1676                          mov *(#_save_new_pxcode), ar7
    1676                          mov ar7, *sp(#0)
    1676                          amov #0x000000, xar7
    1676                          mov ssp, ar6
    1676                          mov *(#_save_new_pxlcode), ar7
    1676              ;            mov ar7, *ssp(#0)
    1676                          mov ar7, *ar6(#0)
    1676                              .endif
    1676              
    1676              ;                       mov ssp, ar7
    1676              ;                       mov *ar7(#1), ar6                               ; this is (one)two away now
    1676              ;                       mov ar6, *(#_DBSTAT_SAVE)                       ; save DBSTAT
    1676              ;                       .endif
    1676              ;                       mov xar7, dbl (*(#_save_xar7))                  ; save xar7
    1676              ;            mov xar6, dbl (*(#_save_xar6))                  ; save x
    1676                                      .if 0
    1676                                      amov #0x000000, xar7
    1676                                      amov #0x000000, xar6
    1676                          mov *sp(#0), ar7                                            ;; sp+3
    1676                          mov ar7, *(#_save_new_pxcode)
    1676                          mov ssp, ar6
    1676                          mov *ar6(#1), ar7                                                       ;; ssp+3
    1676                          mov ar7, *(#_save_new_pxlcode)       ;  ==> now we have our new return address, and if a task, it
    1676                                   ;   nop
    1676                          mov dbl (*(#_pxCurrentTCB)), xar7
    1676                          mov xar7, dbl(*(#_xCompareTCB))
    1676                          .endif
    1676              ; +++===+++
    1676              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1676              ;
    1676              
    1676              
    1676              ; +++===+++
    1676                                      .if 0
    1676              ;                       mov dbl (*(_xCompareTCB)), xar6                 ; need to save our return address
    1676              ;                       mov xar7, ac0
    1676              ;               mov xar6, ac1
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   46

    1676              ;                       CMPU AC1 != AC0, TC1
    1676              ;                               BCC $5,TC1
    1676                                      amov #0x000000, xar7
    1676                                          amov #0x000000, xar6
    1676                                          mov  *(#_save_new_pxcode), ar7
    1676                                          mov ar7, *sp(#0)
    1676                              mov *(#_save_new_pxlcode) , ar7
    1676                              mov ssp, ar6
    1676                              mov ar7, *ar6(#0)
    1676                              mov dbl (*(#_save_xar6)), xar6
    1676                                         .endif
    1676              ; +++===+++
    1676 0002a1       $5_$2$:
    1676                                              
    1676              ; +++===+++
    1676              ;; what about xssp here?
    1676              ;;                              mov xsp, dbl (*(#_save_xsp))                    ; save xsp
    1676              ;;                          mov xssp, dbl (*(#_save_xssp))                      ; save xssp
    1676                                 .if configUSE_CONTEXT_DEBUG == 1
    1676              ;; save current PC (and possible loop bits values)
    1676              ;; for debug - to see if this is being corrupted
    1676                                      mov dbl(*ar7), xar6
    1676                                      mov dbl(*ar6), xar7
    1676                                      mov xar7, dbl (*(#_PC_REG_LOW_SAVE))            ; save off the PC
    1676                                      mov xssp, xar7
    1676                                      mov dbl(*ar7), xar6
    1676                                      mov dbl(*ar6), xar7
    1676                                      mov xar7, dbl (*(#_PC_REG_HIGH_SAVE))           ; save off the PC
    1676                                      mov xssp, xar7
    1676                                      add #-2, ar7
    1676                                      mov dbl(*ar7), xar6
    1676                                      mov xar6,  dbl (*(_DBSTAT_SAVE))
    1676                          mov dbl (*(#_save_xar6)), xar6
    1676              
    1676              ;            mov (*ar7), (*(#_PC_REG_LOW_SAVE))
    1676              ;            mov dbl(*xssp),(*(#_PC_REG_HIGH_SAVE))
    1676              ;                       mov (*ssp(#-2)), (*(#_DBSTAT_SAVE))
    1676                                      .endif
    1676              ; +++===+++
    1676                                      ; save context in our stack(s) frame
    1676              
    1676              ;;;;                    mov dbl (*(#_pxCurrentTCB)), xar7
    1676              ;;;                     mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1676              ;;;                     mov dbl (*ar7(#2)), xssp
    1676              ; +++===+++
    1676              ;                   mov dbl (*(#_pxCurrentTCB)), xar7
    1676                                  ; add #0x0064, ar7
    1676              ;                       mov dbl (*ar7), xsp                                     ; xsp contains our TCB now
    1676              ;                       mov dbl (*ar7(#2)), xssp
    1676              ;           add #0x0064, ar4
    1676              ;                       add #0x0064, ar3
    1676              ;                       mov dbl (*ar5), xar4                            ; xsp contains our TCB now
    1676              ;                       mov dbl (*ar5(#2)), xar3                        ; xssp
    1676              ;                       add #0x0064, ar4
    1676              ;                       add #0x0064, ar3
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   47

    1676 0002a1 EC31                  amov #0x000000, xar7
         0002a3 FE00 
         0002a5 0000 
    1676 0002a7 EC31                          amov #0x000000, xar6
         0002a9 EE00 
         0002ab 0000 
    1676 0002ad ED31                      mov dbl (*(#_pxCurrentTCB)), xar7
         0002af FF00 
         0002b1 0000!
    1676 0002b3 EDE1                          mov dbl (*ar7), xar6                            ; xsp normal position
         0002b5 EF   
    1676 0002b6 7B00                          add #0x0064, ar6
         0002b8 64EE 
    1676 0002ba 90E4                          mov xar6, xsp                                           ; actual xsp
    1676 0002bc EC31                          amov #0x000000, xar6
         0002be EE00 
         0002c0 0000 
    1676 0002c2 EDED                          mov dbl (*ar7(#2)), xar6                        ; xssp
         0002c4 EF00 
         0002c6 02   
    1676 0002c7 402E                          add #0x0002, ar6
    1676 0002c9 90E5                          mov xar6, xssp
    1676              
    1676 0002cb ED31              mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
         0002cd FF00 
         0002cf 0000!
    1676 0002d1 ED31              mov dbl (*(#_save_xar6)), xar6
         0002d3 EF00 
         0002d5 0000!
    1676 0002d7 ED31              mov dbl (*(#_save_xar1)), xar1                  ; restore xar7
         0002d9 9F00 
         0002db 0000!
    1676 0002dd ED31              mov dbl (*(#_save_xar2)), xar2
         0002df AF00 
         0002e1 0000!
    1676 0002e3 ED31              mov dbl (*(#_save_xar3)), xar3                  ; restore xar7
         0002e5 BF00 
         0002e7 0000!
    1676 0002e9 ED31              mov dbl (*(#_save_xar4)), xar4
         0002eb CF00 
         0002ed 0000!
    1676 0002ef ED31             mov dbl (*(#_save_xar5)), xar5
         0002f1 DF00 
         0002f3 0000!
    1676                                        ; restore xar6
    1676              ;;; begin context save:
    1676              
    1676 0002f5 EB10                          mov xar7, dbl(*sp(#8))                          ; save xar7
         0002f7 F5   
    1676 0002f8 CF0E                          mov ar7, *sp(#7)
    1676              
    1676 0002fa EB14                          mov xar6, dbl(*sp(#10))
         0002fc E5   
    1676 0002fd CE12                          mov ar6, *sp(#9)
    1676              
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   48

    1676 0002ff EB18                          mov xar5, dbl(*sp(#12))
         000301 D5   
    1676 000302 CD16                          mov ar5, *sp(#11)
    1676              
    1676 000304 EB1C                          mov xar4, dbl(*sp(#14))
         000306 C5   
    1676 000307 CC1A                          mov ar4, *sp(#13)
    1676              
    1676 000309 EB20                          mov xar3, dbl(*sp(#16))
         00030b B5   
    1676 00030c CB1E                          mov ar3, *sp(#15)
    1676              
    1676 00030e EB24                          mov xar2, dbl(*sp(#18))
         000310 A5   
    1676 000311 CA22                          mov ar2, *sp(#17)
    1676              
    1676 000313 EB28                          mov xar1, dbl(*sp(#20))
         000315 95   
    1676 000316 C926                          mov ar1, *sp(#19)
    1676              
    1676 000318 EB2C                          mov xar0, dbl(*sp(#22))
         00031a 85   
    1676 00031b C82A                          mov ar0, *sp(#21)
    1676              
    1676 00031d EB30              mov  ac0, dbl(*sp(#24))
         00031f 08   
    1676 000320 C02E              mov ac0, *sp(#23)
    1676              
    1676 000322 C732                          mov t3, *sp(#25)
    1676 000324 C634                          mov t2, *sp(#26)
    1676 000326 C536                          mov t1, *sp(#27)
    1676 000328 C438                          mov t0, *sp(#28)
    1676              
    1676              ;;                      mov xsp,  dbl (*(#_Ssave_xsp))                  ; save xsp
    1676              ;;                      mov xssp, dbl (*(#_Ssave_xssp))
    1676                                      .if 1
    1676 00032a EC31                          amov #0x000000, xar7                                    ; save where we are in our IR
         00032c FE00 
         00032e 0000 
    1676              ;                   mov dbl (*(#_Ssave_xsp)), xar7
    1676 000330 AF31                       mov *(#_Ssave_xsp), ar7
         000332 0000 
         000334 00!  
    1676              ;                   mov xar7, dbl(*sp(#29))
    1676 000335 CF3C              mov ar7, *sp(#30)
    1676 000337 EC31              amov #0x000000, xar7
         000339 FE00 
         00033b 0000 
    1676              ;                   mov dbl (*(#_Ssave_xssp)), xar7
    1676 00033d AF31                      mov *(#_Ssave_xssp), ar7
         00033f 0000 
         000341 00!  
    1676              ;                   mov xar7, dbl(*sp(#31))
    1676 000342 CF40              mov ar7, *sp(#32)
    1676                                      .endif
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   49

    1676              
    1676 000344 ED31              mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
         000346 FF00 
         000348 0000!
    1676              
    1676              ; +++===+++
    1676              ;;                      mov mmap(ST0_55), t0
    1676              ; - this is ok - we are not pushing - it's a relative stack frame
    1676              ;                       mov t0, *sp(#25)
    1676              ;;                      mov t0, *sp(#23)
    1676              ;;                      mov mmap(ST1_55), t1
    1676              ;                       mov t1, *sp(#26)                ; stomping on own mem
    1676              ;;                      mov t1, *sp(#21)                ; stomping on own mem
    1676              ;;                      mov mmap(ST2_55), t2
    1676              ;;                      mov t2, *sp(#22)
    1676              ;                       mov t2, *sp(#27)
    1676              ;;                      mov mmap(ST2_55), t3
    1676              ;                       mov t3, *sp(#28)
    1676              ;;                      mov t3, *sp(#24)
    1676              
    1676              ;                       PSH dbl(AR0) ; 32-bit
    1676              ;                       PSH dbl(AR1) 
    1676              ;                       PSH dbl(AR2) ; 32-bit
    1676              ;                       PUSH XAR3 ; 32-bit
    1676              ;                       PUSH XAR4 ; 32-bit
    1676                              ;-- Comment these to save cycles --------
    1676              ;                       PUSH XAR5 ; 32-bit
    1676              ;                       PUSH XAR6 ; 32-bit
    1676              ;                       PUSH XAR7 ; 32-bit
    1676                              ;----------------------------------------
    1676              
    1676              ;                       PUSH XT   ; 32-bit
    1676              
    1676              ;                       movl xar6, @_portFLAGS_INT_ENABLED
    1676              ;                       push xar6 ; portFLAGS_INT_ENABLED
    1676              ; +++===+++
    1676              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1676              ;                       mov dbl (*ar7), xsp                                     ; xsp contains our TCB now
    1676              ;                       mov dbl (*ar7(#2)), xssp
    1676              
    1676 00034a ED31                          mov dbl (*(#_portFLAGS_INT_ENABLED)), xar6
         00034c EF00 
         00034e 0000!
    1676 000350 EB0C                          mov xar6, dbl(*sp(#6))
         000352 E5   
    1676              
    1676              ;                       movl xar7, @_usCriticalNesting
    1676              ;                       push xar7
    1676 000353 ED31                          mov dbl (*(#_usCriticalNesting)), xar7
         000355 FF00 
         000357 0000!
    1676 000359 EB08                          mov xar7, dbl(*sp(#4))
         00035b F5   
    1676              
    1676 00035c EC31                          amov #0x000000, xar7
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   50

         00035e FE00 
         000360 0000 
    1676 000362 EC31                          amov #0x000000, xar6
         000364 EE00 
         000366 0000 
    1676              
    1676 000368 AF06                          mov mmap(ST1_55), ar7
         00036a 98   
    1676 00036b CF02                          mov ar7, *sp(#1)
    1676 00036d AF96                          mov  mmap(ST2_55), ar7
         00036f 98   
    1676 000370 CF04                          mov ar7, *sp(#2)
    1676              
    1676 000372 449F                          mov ssp, ar7
    1676              ;                       mov *(#_LOOP_BITS), ar6                 ; save LOOP_BITS (CFCT)
    1676              ;                       and #0xFF00, ar6
    1676              ;                       mov ar6, *ar7(#1)
    1676              
    1676 000374 AE04                          mov mmap(ST0_55), ar6
         000376 98   
    1676 000377 CEED                          mov ar6, *ar7(#2)
         000379 0002 
    1676                                      
    1676 00037b AE31                          mov *(#_DBSTAT_SAVE), ar6               ; save DBSTAT
         00037d 0000 
         00037f 00!  
    1676 000380 CEED                          mov ar6, *ar7(#1)
         000382 0001 
    1676              ; +++===+++
    1676              ;                       mov dbl (*(#_save_xsp)), xsp                    ; restore xsp*
    1676              ;                       mov dbl (*(#_save_xssp)), xssp          
    1676              ;;;                     mov  dbl (*(_DBSTAT_SAVE)), *xar7(#2)   ; needs to be DBSTAT - don't overwrite DBSTAT
    1676              ;;;                     mov ar6, *ar7(#2)
    1676              ;                       mov ar7, mmap(ST0_55)
    1676              ;                       mov *ssp(#2), ar7
    1676              ; fix up
    1676              ;                       aadd #20, sp
    1676              ;                       mov sp, t0
    1676              ;                       sub #1, t0
    1676              ;                       mov t0, ssp
    1676              
    1676                                      ; move contents of SP into address of current TCB
    1676              ;                       mov xsp, dbl (*(#_pxCurrentTCB))                ; xsp contains our TCB now
    1676              
    1676              ;                       mov xar7, dbl (*(#_save_xar7))                  ; save xar7 
    1676              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1676              ;                       mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1676              ;                       mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1676              ;                       mov dbl (*ar7+), xssp
    1676              
    1676              ;                       mov sp, t0              ; we've already saved t0
    1676              ;                       add #1, t0
    1676              ;                       mov t0, ssp
    1676              ; ??
    1676              ;                       mov xsp, dbl (*(#_pxCurrentTCB))
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   51

    1676              
    1676              ;                       movl xar6, @_pxCurrentTCB ; XAR6 contains current TCB addr
    1676              ;                       mov al, @sp
    1676              ;                       movl  *xar6, acc        
    1676              ;;                      mov  ar0, @sp
    1676              ;;                      mov  @ar6, alxd
    1676              ;;                      mov  ar0, @sp
    1676              ;;                      movl 0(xar6), sp
    1676              ;                       EDIS
    1676              ;                       NASP
    1676              ;; ;;                   mov dbl (*(#_save_xsp)), xsp    ; restore xsp           
    1676              ;                       NOP
    1676              ;                       .if configSTACK_PTR_DEBUG == 1
    1676              ;                       mov xsp, dbl(*(#_Ssave_xsp))
    1676              ;            mov xssp, dbl(*(#_Ssave_xssp))
    1676              ;            .endif
    1676                              .if 0
    1676                                      mov  xar7, dbl (*(#_save_xar7))                 ; restore xar7
    1676                          mov  xar6, dbl (*(#_save_xar6))
    1676              
    1676                              amov #0x000000, xar7
    1676                                      amov #0x000000, xar6
    1676                                  mov dbl (*(#_pxCurrentTCB)), xar7
    1676                                      mov dbl (*ar7), xar6                            ; xsp normal position
    1676                                      add #0x0064, ar6
    1676                                      mov xar6, xsp                                           ; actual xsp
    1676                                      mov dbl (*ar7(#2)), xar6                        ; xssp
    1676                                      add #0x0002, ar6
    1676                                      mov xar6, xssp
    1676              
    1676                          mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
    1676                          mov dbl (*(#_save_xar6)), xar6
    1676                        .endif
    1676              
    1676              ;;;;                    mov dbl (*(#_save_xsp)), xsp                    ; restore xsp*
    1676              ;;;;                    mov dbl (*(#_save_xssp)), xssp
    1676              
    1676              ;                       mov dbl (*(#_Ssave_xsp)), xsp                   ; restore xsp*
    1676              ;                       mov dbl (*(#_Ssave_xssp)), xssp                 ; restore xssp
    1676 000384 DC31              mov *(#_Ssave_xsp), sp                      ; restore xsp*
         000386 7200 
         000388 0000!
    1676 00038a DC31                          mov *(#_Ssave_xssp), ssp
         00038c 8200 
         00038e 0000!
    1676 000390 20                            nop
    1676 000391 4EFF                          aadd #-1, sp
    1676 000393 20                            nop
    1676              
    1676 000394 20                            nop
    1676                                                                                      ; ?
    1677              ;        aadd #1, sp
    1678              
    1679 000395 EB31                    mov xsp, dbl(*(#_tick_xsp))
         000397 4500 
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   52

         000399 0000!
    1680 00039b EB31                                mov xssp, dbl(*(#_tick_xssp))
         00039d 5500 
         00039f 0000!
    1681              
    1682 0003a1 ED31                    mov dbl(*(#_root_xsp)), xsp
         0003a3 4F00 
         0003a5 0000!
    1683 0003a7 ED31                                mov dbl(*(#_root_xssp)), xssp
         0003a9 5F00 
         0003ab 0000!
    1684              
    1685 0003ad 6C00          call     #_xTaskIncrementTick
         0003af 0000!
    1686              
    1687 0003b1 EB31                     mov xsp, dbl(*(#_root_xsp))
         0003b3 4500 
         0003b5 0000!
    1688 0003b7 EB31                                 mov xssp, dbl(*(#_root_xssp))
         0003b9 5500 
         0003bb 0000!
    1689              
    1690 0003bd ED31                                 mov dbl(*(#_tick_xsp)), xsp
         0003bf 4F00 
         0003c1 0000!
    1691 0003c3 ED31                                 mov dbl(*(#_tick_xssp)), xssp
         0003c5 5F00 
         0003c7 0000!
    1692              
    1693              ;        aadd #-1, sp
    1694                      .if configUSE_PREEMPTION == 1
    1695              ;        mov xsp, dbl (*(#_save_xsp))                   ; save xsp
    1696              ;           mov xssp, dbl (*(#_save_xssp))                      ; save xssp
    1697              ;        aadd #1, sp
    1698              
    1699 0003c9 EB31                    mov xsp, dbl(*(#_tick_xsp))
         0003cb 4500 
         0003cd 0000!
    1700 0003cf EB31                                mov xssp, dbl(*(#_tick_xssp))
         0003d1 5500 
         0003d3 0000!
    1701              
    1702 0003d5 ED31                    mov dbl(*(#_root_xsp)), xsp
         0003d7 4F00 
         0003d9 0000!
    1703 0003db ED31                                mov dbl(*(#_root_xssp)), xssp
         0003dd 5F00 
         0003df 0000!
    1704              
    1705 0003e1 6C00          call    #_vTaskSwitchContext
         0003e3 0000!
    1706              
    1707 0003e5 EB31                     mov xsp, dbl(*(#_root_xsp))
         0003e7 4500 
         0003e9 0000!
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   53

    1708 0003eb EB31                                 mov xssp, dbl(*(#_root_xssp))
         0003ed 5500 
         0003ef 0000!
    1709              
    1710 0003f1 ED31                                 mov dbl(*(#_tick_xsp)), xsp
         0003f3 4F00 
         0003f5 0000!
    1711 0003f7 ED31                                 mov dbl(*(#_tick_xssp)), xssp
         0003f9 5F00 
         0003fb 0000!
    1712              
    1713              
    1714              ;        aadd #-1, sp
    1715              
    1716                                      .if 1
    1717 0003fd EB31                          mov xar7, dbl (*(#_save_xar7))                  ; save xar7
         0003ff F500 
         000401 0000!
    1718 000403 EB31              mov xar6, dbl (*(#_save_xar6))
         000405 E500 
         000407 0000!
    1719 000409 EB31              mov ac0, dbl (*(#_save_ac0))                  ; save xar7
         00040b 0800 
         00040d 0000!
    1720 00040f EB31              mov ac1, dbl (*(#_save_ac1))
         000411 1800 
         000413 0000!
    1721 000415 EB31              mov xar1, dbl(*(#_save_xar1))
         000417 9500 
         000419 0000!
    1722 00041b EC31              amov #0x000000, xar7
         00041d FE00 
         00041f 0000 
    1723 000421 EC31                          amov #0x000000, xar6
         000423 EE00 
         000425 0000 
    1724 000427 ED31                          mov dbl (*(_xCompareTCB)), xar6
         000429 EF00 
         00042b 0000!
    1725 00042d ED31                      mov dbl (*(#_pxCurrentTCB)), xar7
         00042f FF00 
         000431 0000!
    1726                          ; need to restore our return address
    1727 000433 3C00              mov #0x000000, ac0
    1728 000435 3C01                          mov #0x000000, ac1
    1729 000437 90F0                          mov xar7, ac0
    1730 000439 90E1              mov xar6, ac1
    1731 00043b 1210                  CMPU AC1 == AC0, TC1 ; |1393|
         00043d 04   
    1732 00043e 6464              BCC $A,TC1 ; |1393|
    1733 000440 20                nop                 ; breakpoint here - context switch has occurred
    1734                          .if configUSE_TICK_CTR == 1
    1735 000441 F731                      add #1, *(#_context_switch_counter)
         000443 0001 
         000445 0000 
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   54

         000447 00!  
    1736                                  .endif
    1737                                  .if 0
    1738                                  amov #0x000000, xar7
    1739                                  amov #0x000000, xar1
    1740                                  mov *(#_save_new_pxcode), ar7
    1741                                  mov *ar6(#0), ar1
    1742                                  add #0x0064, ar1
    1743                                  mov ar7, *ar1
    1744                                  mov *(#_save_new_pxlcode), ar7
    1745                                  amov #0x000000, xar1
    1746                                  mov *ar6(#2), ar1
    1747                                  add #0x0002, ar1
    1748                                  mov ar7, *ar1
    1749                                  .endif
    1750                                  ; amov #0x000000, xar7
    1751                                      ;    amov #0x000000, xar6
    1752                          ;  mov  *(#_save_new_pxcode), ar7
    1753                                      ;    mov ar7, *sp(#0)
    1754                          ;                mov *(#_save_new_pxlcode) , ar7
    1755                          ;                mov ssp, ar6
    1756                          ;                mov ar7, *ar6(#0)
    1757              
    1758                          ;                mov dbl (*(#_save_xar6)), xar6
    1759                                      ;                       .endif
    1760              ; +++===+++
    1761 000448       $A:
    1762 000448 ED31              mov dbl (*(#_save_ac0)), ac0                  ; save xar7
         00044a 0800 
         00044c 0000!
    1763 00044e ED31              mov dbl (*(#_save_ac1)), ac1
         000450 1800 
         000452 0000!
    1764 000454 ED31              mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
         000456 FF00 
         000458 0000!
    1765 00045a ED31              mov dbl (*(#_save_xar6)), xar6
         00045c EF00 
         00045e 0000!
    1766 000460 ED31              mov dbl (*(#_save_xar1)), xar1
         000462 9F00 
         000464 0000!
    1767              ;;;            aadd #-4, sp
    1768                       .endif
    1769                      .endif
    1770              ;$1:
    1771              ;               bclr INTM
    1772 000466 E651                  mov #1, *port(#6166) ; |127|
         000468 0118 
         00046a 16   
    1773              ;               MOV #0, *port(#6294) ; |92|
    1774 00046b F551                  or #0x0001, *port(#7188) ; |130|
         00046d 0001 
         00046f 1C14 
    1775               ;       OR #0x0007, *port(#7188) ; |100|
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   55

    1776 000471 4E01              aadd #1, sp ;;;
    1777                                              .if 0
    1778                                 POPBOTH XAR5
    1779                                 POP mmap(@CDPH)
    1780                                AMAR *(#00042h),XAR1
    1781                                RPT #10
    1782                                POP dbl(*AR1-)
    1783                                POP mmap(@DPH)
    1784                                POP mmap(@CDP)
    1785                                POP mmap(@BRC0)
    1786                               POP mmap(@BK03)
    1787                              POP mmap(@RPTC)
    1788                              POP mmap(@TRN0)
    1789                             POP mmap(@BRC1)
    1790                               POP mmap(@BRS1)
    1791                                POPBOTH AC3
    1792                               POP mmap(@AC3G)
    1793                               POPBOTH AC2
    1794                              POP mmap(@AC2G)
    1795                             POPBOTH AC1
    1796                               POP mmap(@AC1G)
    1797                                POPBOTH AC0
    1798                               POP mmap(@AC0G)
    1799                               POP T0,T1
    1800                                POPBOTH XAR4
    1801                                POPBOTH XAR3
    1802                               POPBOTH XAR2
    1803                              POPBOTH XAR1
    1804                              POPBOTH XAR0
    1805                               POP mmap(@ST3_55)
    1806                                  NOP
    1807                                   NOP
    1808                                  NOP
    1809                                   NOP
    1810                                   NOP
    1811                                    NOP
    1812                                              .endif
    1813              
    1814              
    1815                              .if configSTACK_PTR_DEBUG == 1
    1816                                      mov xsp, dbl(*(#_restore_xsp))
    1817                          mov xssp, dbl(*(#_restore_xssp))
    1818                         .endif
    1819 ****** MACRO         portRESTORE_CONTEXT
    1819                                      .C54CM_off
    1819              ;                       .CPL_off
    1819                                      .ARMS_off
    1819                                      .align 4
    1819              
    1819              ; Restore context & return - here we need to know what context we're in
    1819                                      ;CONTEXT_RESTORE
    1819              ;                       ASP
    1819              ;                       EALLOW
    1819              ;                       nop
    1819              ;                       nop
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   56

    1819              ;                       nop
    1819              ;                       nop
    1819 000474 4652                  bclr C54CM
    1819 000476 20                    nop
    1819 000477 20                    nop
    1819 000478 20                    nop
    1819 000479 20                    nop
    1819 00047a 20                    nop
    1819 00047b 20                    nop
    1819              ;               xssp = dbl(*(#_pxCurrentTCB))
    1819              ;               xsp  = dbl(*(#_pxCurrentTCB))
    1819 00047c EB31                          mov xar7, dbl (*(#_save_xar7))  
         00047e F500 
         000480 0000!
    1819 000482 EB31                          mov xar6, dbl (*(#_save_xar6))
         000484 E500 
         000486 0000!
    1819              
    1819              ;;;;                     aadd #-3, sp                           ;;;;
    1819              ;            aadd #-3, xsp
    1819              ;            CMP *(#_first_flag) == #1, TC1 ; |216|
    1819              ;            BCC $1,TC1 ; |216|
    1819              ;;                      mov dbl (*(#_save_xsp)), xsp                    ; restore xsp***
    1819              ;;                      mov dbl (*(#_save_xssp)), xssp                  ; restore xssp***
    1819              ;            B $4
    1819              ;;              aadd #-1, sp
    1819 000488 EB31                          mov xsp, dbl (*(#_restore_xsp))                 ; save xsp
         00048a 4500 
         00048c 0000!
    1819 00048e EB31                          mov xssp, dbl (*(#_restore_xssp))                       ; save xssp
         000490 5500 
         000492 0000!
    1819               ;                      aadd #3, xsp
    1819              ;;;             aadd #-3, sp
    1819              
    1819              ;;;;            mov dbl(*(#_root_xsp)), xsp
    1819              ;;;;                    mov dbl(*(#_root_xssp)), xssp
    1819              ;;;                     aadd #3, sp
    1819              
    1819              ;$1
    1819              ;                       mov dbl (*(#_first_save_xsp)), xsp                      ; restore xsp
    1819              ;                       mov dbl (*(#_first_save_xssp)), xssp                    ; restore xssp
    1819              ;$4
    1819                                      .if 1
    1819              ;;                      aadd #-1, sp
    1819              
    1819                                      .if 0
    1819                                      amov #0x000000, xar7                                    ; save where we are in our IR
    1819                                  mov dbl (*(#_Ssave_xsp)), xar7
    1819              ;                   mov xar7, dbl(*sp(#29))
    1819              
    1819                          amov #0x000000, xar7
    1819                                  mov dbl (*(#_Ssave_xssp)), xar7
    1819              ;                   mov xar7, dbl(*sp(#31))
    1819                          mov ar7, *sp(#32)
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   57

    1819                                      .endif
    1819              
    1819              
    1819              ;;                      mov xsp, xar7
    1819              ;;                      mov xssp, xar6
    1819              
    1819 000494 EC31                          amov #0x000000, xar2
         000496 AE00 
         000498 0000 
    1819 00049a EC31                          amov #0x000000, xar1
         00049c 9E00 
         00049e 0000 
    1819              
    1819 0004a0 ED31                          mov dbl (*(#_pxCurrentTCB)), xar5
         0004a2 DF00 
         0004a4 0000!
    1819                                                                                               ;; points to our variables n
    1819 0004a6 EDA1                          mov dbl (*ar5), xar4                            ; xsp contains our TCB now
         0004a8 CF   
    1819 0004a9 EDAD                          mov dbl (*ar5(#2)), xar3
         0004ab BF00 
         0004ad 02   
    1819              
    1819              ;;                      mov xar4, xar7
    1819              ;;                      mov xar3, xar6
    1819              ;;                      mov xar7, xsp
    1819              ;;                      mov xar6, xssp
    1819              
    1819 0004ae 7B00                          add #0x0064, ar4
         0004b0 64CC 
    1819 0004b2 402B                          add #0x0002, ar3
    1819                                      
    1819 0004b4 90C4                          mov xar4, xsp
    1819 0004b6 90B5                          mov xar3, xssp
    1819              
    1819 0004b8 EC31                          amov #0x000000, xar7
         0004ba FE00 
         0004bc 0000 
    1819 0004be EC31                          amov #0x000000, xar6
         0004c0 EE00 
         0004c2 0000 
    1819 0004c4 AF3C                  mov *sp(#30), ar7                       ; saved IRQ xsp
    1819 0004c6 AE40                  mov *sp(#32), ar6                       ; saved IRQ xssp
    1819              
    1819 0004c8 90F4                          mov xar7, xsp
    1819 0004ca 90E5                          mov xar6, xssp
    1819              
    1819 0004cc AA81                          mov *ar4, ar2
    1819 0004ce A961                          mov *ar3, ar1                           ; maybe not on a yield here
    1819              ;                       mov ar4, *ar6                           ; stack pointers fixed up
    1819 0004d0 CAE1                          mov ar2, *ar7
    1819 0004d2 C9C1                          mov ar1, *ar6
    1819              
    1819 0004d4 EB31                          mov xsp, dbl (*(#_restore_xsp))                 ; save xsp
         0004d6 4500 
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   58

         0004d8 0000!
    1819 0004da EB31                          mov xssp, dbl (*(#_restore_xssp))
         0004dc 5500 
         0004de 0000!
    1819              
    1819 0004e0 AF06                          mov mmap(ST1_55), ar7
         0004e2 98   
    1819 0004e3 7DF7                          and #0xf7ff, ar7                        ; <here>#0800h
         0004e5 FFFF 
    1819 0004e7 CF02                          mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
    1819 0004e9 CF8D                          mov ar7, *ar4(#1)                       ; save in TCB
         0004eb 0001 
    1819 0004ed AF96                          mov mmap(ST2_55), ar7
         0004ef 98   
    1819 0004f0 CF04                          mov ar7, *sp(#2)
    1819 0004f2 CF8D                          mov ar7, *ar4(#2)
         0004f4 0002 
    1819              
    1819 0004f6 449F                          mov ssp, ar7
    1819 0004f8 AE04                          mov mmap(ST0_55), ar6
         0004fa 98   
    1819 0004fb CEED                          mov ar6, *ar7(#2)
         0004fd 0002 
    1819 0004ff CE6D                          mov ar6, *ar3(#2)
         000501 0002 
    1819 000503 AE31                          mov *(#_DBSTAT_SAVE), ar6               ; have to restore this
         000505 0000 
         000507 00!  
    1819              ;;                      mov ar6, *ar7(#1)
    1819 000508 CE6D                          mov ar6, *ar3(#1)
         00050a 0001 
    1819                                      .endif
    1819              
    1819              ;                       mov #0, ssp     
    1819              ;                       mov xar7, dbl (*(#_save_xar7))                  ; save xar7 
    1819              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1819                                      ; 32-bit mode - will act on SP and SSP:
    1819              ;                       'fix-up' current SP and SSP - is this dangerous????
    1819              ;                       aadd #-3, sp
    1819              ;;                      mov *ar7, *sp
    1819              ;                       mov dbl (*ar7), ar6
    1819              ;                       mov ar6, *sp                            ; xsp contains our TCB now
    1819              ;                       mov *ar7(#2), *ssp                      
    1819              ;                       POP mmap(ST3_55)
    1819              ;                       pshboth xar7                            ; should increment both
    1819                                      .if 0
    1819                                      mov mmap(ST1_55), ar7
    1819                                      and #0xf7ff, ar7                        ; <here>#0800h
    1819                                      mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
    1819                                      mov mmap(ST2_55), ar7
    1819                                      mov ar7, *sp(#2)
    1819              
    1819                                      mov ssp, ar7
    1819                                      mov mmap(ST0_55), ar6
    1819                                      mov ar6, *ar7(#2)
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   59

    1819              ;;                      mov mmap(ST0_55), ar6   ; needs to be DBSTAT
    1819              ;;                      mov ar6, *ar7(#1)
    1819                                      .endif
    1819              ; +++===+++
    1819                                      .if 0
    1819                                      mov dbl (*(#_pxCurrentTCB)), xar7
    1819                                      mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1819                                      mov dbl (*ar7(#2)), xssp        
    1819                                      .endif
    1819              ; +++===+++
    1819                                      .if 0
    1819                                      mov dbl (*(_xCompareTCB)), xar6
    1819              ; need to restore our return address
    1819                                      mov xar7, ac0
    1819                                          mov xar6, ac1
    1819                                          CMPU AC1 != AC0, TC1 ; |1393|
    1819                                          BCC $6,TC1 ; |1393|
    1819                                          amov #0x000000, xar7
    1819                                          amov #0x000000, xar6
    1819                                          mov  *(#_save_new_pxcode), ar7
    1819                                          mov ar7, *sp(#0)
    1819                                          mov *(#_save_new_pxlcode) , ar7
    1819                                          mov ssp, ar6
    1819                                          mov ar7, *ar6(#0)
    1819              
    1819                                          mov dbl (*(#_save_xar6)), xar6
    1819                                                              .endif
    1819              ; +++===+++
    1819 00050c       $6_$3$:
    1819              ;;                mov xsp, dbl (*(#_save_xsp))                  ; save xsp
    1819              ;;                          mov xssp, dbl (*(#_save_xssp))                      ; save xssp
    1819                                      .if configUSE_CONTEXT_RESTORE_DEBUG == 1
    1819                                      mov xar7, dbl (*(#_save_xar7))                  ; save xar7
    1819                                      mov xar6, dbl (*(#_save_xar6))
    1819              
    1819              ;; this is for debug
    1819                                      mov dbl(*ar7), xar6
    1819                                      mov dbl(*ar6), xar7
    1819                                      mov xar7, dbl (*(#_PC_REG_LOW_RESTORE))         ; save off the PC
    1819                                      mov xssp, xar7
    1819                                      mov dbl(*ar7), xar6
    1819                                      mov dbl(*ar6), xar7
    1819                                      mov xar7, dbl (*(#_PC_REG_HIGH_RESTORE))                ; save off the PC
    1819                                      mov xssp, xar7
    1819                                      add #-2, ar7
    1819                                      mov dbl(*ar7), xar6
    1819                                      mov xar6,  dbl (*(_DBSTAT_RESTORE))
    1819                                      mov dbl (*(#_save_xar6)), xar6
    1819                                      
    1819                                      mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
    1819                                      .endif
    1819              ; +++===+++
    1819              ;                       mov mmap(ST0_55), *ssp(#1)
    1819              ;                       mov mmap(STO_55), *ssp(#2)
    1819              ;                       mov mmap(ST1_55), *sp(#1)
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   60

    1819              ;                       mov mmap(ST2_55), *sp(#2)               ; needs to be DBSTAT                    
    1819              ;                       mov *ar7, t0
    1819              ;                       mov t0, *sp(#0)                         ; xsp contains our TCB now
    1819              ;                       mov *ar7(#2), t0
    1819              ;                       mov t0, *ssp(#0)                        
    1819              
    1819              ;                       mov  (*ar7), sp                                 ; xsp contains our TCB now
    1819              ; what about xssp?
    1819              ;                       mov xar6, xsp
    1819              ;                       mov xssp, xar7
    1819              ;                       add #1, ar7
    1819              ;                       mov xar7, xsp
    1819              ;                       mov sp, t0
    1819              ;                       mov ssp, t1
    1819              ;                       mov dbl(*(#_pxCurrentTCB)), xsp
    1819              ;                       ar0 = *ar6
    1819              ;                       xssp = xar0
    1819              ;                       mov *xar6, xar0
    1819              ;                       mov xar0, xssp  ; stack now points to our TCB
    1819              ;;                      mov sp, *ar6
    1819              ;;                      mov sp, ar0
    1819              ;;                      mov sp, *_pxCurrentTCB
    1819              ;;                      clr ar0
    1819              ;;                      mov ar0, @xar6
    1819              ;;                      mov sp, AR0
    1819              ;;                      add sp, xar6
    1819              
    1819              ;;                      pshboth xar7
    1819              ;;                      pshboth xar6
    1819              ;;                      pshboth xar5
    1819              
    1819              ;;                      popboth xar5
    1819              ;;                      popboth xar6
    1819              ;;                      popboth xar7
    1819              
    1819              ;;;                     mov *sp(#1), ar7 
    1819              ;                       mov dbl(*sp(#1)), ar7
    1819              ;;;                     mov  ar7, mmap(ST1_55)
    1819              ; +++===+++
    1819              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1819              ;                       add #0x0064, ar7
    1819              ;                       mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1819              ;                       mov *ar7(#2)
    1819              ;                       mov dbl (*ar7(#2)), xssp
    1819              ; ===+++===
    1819                 .if 1
    1819 00050c EC31                  amov #0x000000, xar7
         00050e FE00 
         000510 0000 
    1819 000512 EC31                          amov #0x000000, xar6
         000514 EE00 
         000516 0000 
    1819 000518 ED31                      mov dbl (*(#_pxCurrentTCB)), xar7
         00051a FF00 
         00051c 0000!
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   61

    1819 00051e EDE1                          mov dbl (*ar7), xar6                            ; xsp normal position
         000520 EF   
    1819 000521 7B00                          add #0x0064, ar6
         000523 64EE 
    1819 000525 90E4                          mov xar6, xsp                                           ; actual xsp
    1819 000527 EDED                          mov dbl (*ar7(#2)), xar6                        ; xssp
         000529 EF00 
         00052b 02   
    1819 00052c 402E                          add #0x0002, ar6
    1819 00052e 90E5                          mov xar6, xssp
    1819                 .endif
    1819              ; ===+++===
    1819              ;                       add #0x0064, xssp
    1819              ; +++===+++
    1819                                      .if 0
    1819                                      mov *sp(#2), ar7
    1819                                      mov ar7, mmap(ST2_55)
    1819                                      mov ssp, ar7
    1819                                      mov *ar7(#2), ar6
    1819                                      mov ar6, mmap(ST0_55)
    1819                                      .endif
    1819              ;                       mov *ar7(#2), ar6
    1819              ;                       mov ar6, *ssp(#2)
    1819              ;                       mov *ssp(#2), ar7
    1819              ;                       mov ar6, mmap(ST0_55)   ; needs to be DBSTAT
    1819              ;
    1819              ; restore context
    1819              
    1819 000530 EC31                          amov #0x000000, xar2
         000532 AE00 
         000534 0000 
    1819 000536 EC31                          amov #0x000000, xar1
         000538 9E00 
         00053a 0000 
    1819              
    1819                                      .if 0
    1819                                      mov mmap(ST1_55), ar7
    1819                                      and #0xf7ff, ar7                        ; <here>#0800h
    1819                                      mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
    1819                                      mov ar7, mmap(ST1_55)
    1819              ;                       mov ar7, *ar4(#1)                       ; save in TCB
    1819                                      mov mmap(ST2_55), ar7
    1819                                      mov ar7, *sp(#2)
    1819              ;                       mov ar7, *ar4(#2)
    1819              
    1819                                      mov ssp, ar7
    1819                                      mov mmap(ST0_55), ar6
    1819                                      mov ar6, *ar7(#2)
    1819              ;                       mov ar6, *ar3(#2)
    1819                                      mov *(#_DBSTAT_SAVE), ar6               ; have to restore this
    1819                                      mov ar6, *ar7(#1)
    1819              ;                       mov ar6, *ar3(#2)
    1819                                      .endif
    1819              ;;                      mov *(#_LOOP_BITS), ar6         ; have to restore this
    1819              ;;                      and #0xFF00, ar6
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   62

    1819              ;;                      mov ar6, *ar7(#1)
    1819              
    1819 00053c ED08                          mov dbl(*sp(#4)), xar7
         00053e FF   
    1819              ;                       mov *sp(#1), ar7
    1819 00053f EB31                          mov xar7, dbl(*(#_usCriticalNesting))   
         000541 F500 
         000543 0000!
    1819              
    1819 000545 ED0C                          mov dbl(*sp(#6)), xar6
         000547 EF   
    1819              ;                       mov *sp(#3), ar6
    1819              ;                       popboth xar6 ; portFLAGS_INT_ENABLED
    1819 000548 EB31                          mov xar6, dbl(*(#_portFLAGS_INT_ENABLED))       
         00054a E500 
         00054c 0000!
    1819              ;                       POP XT
    1819                              ;-- Comment these to save cycles ---
    1819 00054e ED10                          mov dbl(*sp(#8)), xar7
         000550 FF   
    1819 000551 AF0E                          mov *sp(#7), ar7
    1819              ;                       mov *sp(#5), ar7
    1819              ;                       mov dbl(*sp(#0)), hi(ar7)
    1819              ;                       mov (*sp(#0)), lo(ar7)
    1819 000553 ED14                          mov dbl(*sp(#10)), xar6
         000555 EF   
    1819 000556 AE12                          mov *sp(#9), ar6
    1819 000558 ED18                          mov dbl(*sp(#12)), xar5
         00055a DF   
    1819 00055b AD16                          mov *sp(#11), ar5
    1819              ;; pvPararmeters currently here - needs to be verified --- jcw
    1819 00055d ED1C                          mov dbl(*sp(#14)), xar4
         00055f CF   
    1819 000560 AC1A                          mov *sp(#13), ar4
    1819 000562 ED20                          mov dbl(*sp(#16)), xar3
         000564 BF   
    1819 000565 AB1E                          mov *sp(#15), ar3
    1819 000567 ED24                          mov dbl(*sp(#18)), xar2
         000569 AF   
    1819 00056a AA22                          mov *sp(#17), ar2
    1819 00056c ED28                          mov dbl(*sp(#20)), xar1
         00056e 9F   
    1819 00056f A926                          mov *sp(#19), ar1
    1819 000571 ED2C                          mov dbl(*sp(#22)), xar0
         000573 8F   
    1819 000574 A82A                          mov *sp(#21), ar0
    1819 000576 ED30                      mov dbl(*sp(#24)), ac0
         000578 08   
    1819 000579 A02E              mov *sp(#23), ac0
    1819              
    1819 00057b A732                          mov *sp(#25), t3
    1819 00057d A634                          mov *sp(#26), t2
    1819 00057f A536                          mov *sp(#27), t1
    1819 000581 A438                          mov *sp(#28), t0
    1819              
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   63

    1819              ;                       mov dbl(*sp(#21)), *xssp(#0)
    1819              ;                       mov *sp(#21), *ssp
    1819              ;                       mov *sp(#21), RETA
    1819              ; need to move 23-16 to XSSP contents
    1819              ;                       mov xar0, dbl (*(#_save_xar7))
    1819              ;                       mov ssp, ar0
    1819              ;                       mov #0, ssp 
    1819              ;                       mov xssp, xar0
    1819              ;                       mov dbl (*(#_save_xsp)), xar0                   ; save xsp
    1819              ;                       aadd #20, sp            ; this is ok - ssp also incremented
    1819                      ;               add #1, xssp            ; 32-bit return address pointer
    1819                      ;               amar *xssp+
    1819              ;                       mov sp, t0
    1819              ;                       add #1, t0
    1819              ;                       mov t0, ssp
    1819              ;                       incr ssp
    1819              ;                       asub #20, ar0
    1819              ;                       mov xar0, xssp
    1819              ;                       mov ar0, ssp
    1819              ;                       mov ar0, 
    1819              ;;                      mov *sp(#1), t0
    1819              ;;                      mov *sp(#3), t3         ; ST0
    1819              ;;                      mov *sp(#4), t2         ; DBSTAT
    1819              ;;                      mov t3, *ar0(#2)
    1819                      ;;              mov t2, *ar0(#1)
    1819              ;;                      mov t0, *ar0(#0)
    1819              
    1819              ;;                      mov *sp(#5), t0
    1819              ;;                      mov *sp(#6), t1
    1819              ;;                      mov *sp(#7), t2
    1819                      ;;              mov *sp(#8), t3
    1819              
    1819              ; restore ar0
    1819              ;                       mov dbl(*sp(#-2)), xar0
    1819              ;                       mov #-1, ar0
    1819              ;;                      mov dbl (*(#_save_xar7)), xar0
    1819              ;;
    1819              ;;                      mov sp, t0
    1819              ;;                      add #1, t0
    1819              ;;                      mov t0, ssp
    1819              
    1819              ;                       mov *sp(#3), *(#00004ch+#1)
    1819              
    1819              ;                       mov t3, *ssp(#1) 
    1819              ;                       mov t2, *ssp(#2)
    1819              
    1819              ;;                      mov *sp(#1), dbl(*(#_save_xsp)) 
    1819              ;;                      mov t3, *(ssp(#0))
    1819              ;                       mov t3, *ssp
    1819              ;                       mov *sp(#3), t3 ; 
    1819              ;                       mov t3, *ssp(#1)
    1819              ;;                      mov *sp(#21), PC        
    1819              
    1819              ;; ;;                   mov dbl (*(#_save_xsp)), xsp    ; restore xsp           
    1819              ;                       mov dbl(xsp), dbl(lcrpc)
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   64

    1819              ;                       popboth XAR7
    1819              ;                       add #1, sp
    1819              ;                       add #1, ssp
    1819              ;                       add #2, t0
    1819              ;                       add #2, t1
    1819              ;                       mov t0, sp
    1819              ;                       mov t1, ssp
    1819              ;                       popboth XAR6
    1819              ;                       add #2, t0
    1819              ;                       add #2, t1
    1819              ;                       mov t0, sp
    1819              ;                       mov t1, ssp
    1819              ;                       popboth XAR5
    1819              ;                       add #2, t0
    1819              ;                       add #2, t1
    1819              ;                       mov t0, sp
    1819              ;                       mov t1, ssp
    1819                              ;-----------------------------------
    1819              ;                       popboth XAR4
    1819              ;                       add #2, t0
    1819              ;                       add #2, t1
    1819              ;                       mov t0, sp
    1819              ;                       mov t1, ssp
    1819              ;                       popboth XAR3
    1819              ;                       add #2, t0
    1819              ;                       add #2, t1
    1819              ;                       mov t0, sp
    1819              ;                       mov t1, ssp
    1819              ;                       popboth XAR2
    1819              ;                       add #2, t0
    1819              ;                       add #2, t1
    1819              ;                       mov t0, sp
    1819              ;                       mov t1, ssp
    1819              ;                       popboth XAR1
    1819              ;                       add #2, t0
    1819              ;                       add #2, t1
    1819              ;                       mov t0, sp
    1819              ;                       mov t1, ssp
    1819              ;                       popboth XAR0
    1819              ;                       add #2, t0
    1819              ;                       add #2, t1
    1819              ;                       mov t0, sp
    1819              ;                       mov t1, ssp
    1819              ;                       EDIS
    1819              ;                       NASP    ; Un-align stack pointer
    1819              ;;                      pop mmap(ST3_55)
    1819              ;            CMP *(#_first_flag) == #1, TC1 ; |216|
    1819              ;            BCC $2,TC1 ; |216|
    1819                                      .if 0
    1819                                      mov dbl (*(#_pxCurrentTCB)), xar7
    1819              
    1819                                      mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1819                                      mov dbl (*ar7(#2)), xssp                
    1819                                      .endif
    1819              
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   65

    1819              ;;;              mov dbl(*(#_restore_xsp)), xsp
    1819 000583 ED31               mov dbl(*(#_restore_xssp)), xssp
         000585 5F00 
         000587 0000!
    1819 000589 ED31               mov dbl(*(#_restore_xsp)), xsp
         00058b 4F00 
         00058d 0000!
    1819              
    1819              ;;             aadd #-3, sp
    1819              
    1819              ;;;;                    mov dbl(*(#_root_xssp)), xssp
    1819              ;;;                     aadd #3, sp
    1819              ;;;;;;                  mov dbl (*(#_save_xsp)), xsp                    ; restore xsp***
    1819              ;;;;;;                  mov dbl (*(#_save_xssp)), xssp                  ; restore xssp***
    1819              
    1819              
    1819                                      .if 0
    1819                                      mov dbl (*(_xCompareTCB)), xar6
    1819              ; need to restore our return address
    1819                                      mov xar7, ac0
    1819                          mov xar6, ac1
    1819                              CMPU AC1 != AC0, TC1 ; |1393|
    1819                          BCC $6,TC1 ; |1393|
    1819                          amov #0x000000, xar7
    1819                                      amov #0x000000, xar6
    1819                          mov  *(#_save_new_pxcode), ar7
    1819                                      mov ar7, *sp(#0)
    1819                          mov *(#_save_new_pxlcode) , ar7
    1819                          mov ssp, ar6
    1819                          mov ar7, *ar6(#0)
    1819              
    1819                          mov dbl (*(#_save_xar6)), xar6
    1819                                      .endif
    1819              
    1819              ;;                      mov dbl (*(#_save_xar7)), xar7
    1819              
    1819              ;               .if configSTACK_PTR_DEBUG == 1
    1819              ;;                      mov dbl(*(#_restore_xsp)), xsp
    1819              ;;            mov dbl(*(#_restore_xssp)), xssp
    1819              ;;            .endif
    1819              
    1819              ;                       B $3
    1819              ;$2
    1819              ;           MOV #0, *(#_first_flag) ; |217|
    1819              ;               mov dbl (*(#_first_save_xsp)), xsp                      ; restore xsp
    1819              ;                       mov dbl (*(#_first_save_xssp)), xssp
    1819              ;$3
    1819                                      .if 0
    1819                              amov #0x000000, xar7
    1819                                      amov #0x000000, xar6
    1819                                  mov dbl (*(#_pxCurrentTCB)), xar7
    1819                                      mov dbl (*ar7), xar6                            ; xsp normal position
    1819                                      add #0x0064, ar6
    1819                                      mov xar6, xsp                                           ; actual xsp
    1819                                      mov dbl (*ar7(#2)), xar6                        ; xssp
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   66

    1819                                      add #0x0002, ar6
    1819                                      mov xar6, xssp
    1819                                      .endif
    1819              
    1819              ;;;;                    aadd #-1, sp                    ; on yield, need to do this
    1819 00058f 46B2                          bclr INTM               ; enable interrupts
    1819 000591 20                            nop
    1819 000592 20                            nop
    1819 000593 20                            nop
    1819 000594 20                            nop
    1819 000595 20                            nop
    1819 000596 20                            nop
    1819              
    1819              ;                       aadd #1, sp
    1819 000597 4805                          RETI
    1819              ;                       mov #1860h, ssp
    1819 000599 20                            nop
    1819 00059a 20                            nop
    1819              ;                       nop
    1820              
    1821              ; /*-----------------------------------------------------------*/
    1822              
    1823              
    1824              ;/*
    1825              ; * Manual context switch called by the portYIELD() macro.
    1826              ; */
    1827              
    1828              ; We are using the slow return model:
    1829              
    1830              ; System Stack (SSP)                    Data Stack (SP)
    1831              ; SSP = x - 3:  (Loop Bits):PC(23-16)   SP = y - 3: PC(15-0)  <<= Last pushed - first to POP
    1832              ; SSP = x - 2:  DBSTAT                  SP = y - 2: ST1_55
    1833              ; SSP = x - 1:  ST0_55                  SP = y - 1: ST2_55
    1834              ; SSP = x:      Previously saved data   SP = y:     Previously saved data
    1835              
    1836              
    1837 00059b       _vPortYield:                                    ;; note - most testing done with preemptive kernel - so this 
    1838              
    1839 00059b 4EFF                  aadd #-1, sp
    1840              ;;              aadd #1, sp
    1841 00059d E651                  MOV #0, *port(#6166) ; |119|
         00059f 0018 
         0005a1 16   
    1842 0005a2 F402              AND #0x0010, mmap(@IFR0)
         0005a4 0010 
         0005a6 98   
    1843 0005a7 46B3                  bset INTM
    1844              ;                /* Mimic an interrupt by pushing the SR. */
    1845              
    1846              ;               /* SR is 16-bits in 430X architecture */
    1847              
    1848              ;;                pushx.w    SR
    1849              
    1850              ;                /* Now the SR is stacked we can disable interrupts. */
    1851              
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   67

    1852              ;                dint
    1853              
    1854              ;                 bset INTM             ; disable interrupts
    1855              
    1856              ;;                bicx.w #0xF000,0(r1)
    1857              ;;                swpbx.w +4(r1)
    1858              ;;                rlax.w +4(r1)
    1859              ;;                rlax.w +4(r1)
    1860              ;;                rlax.w +4(r1)
    1861              ;;                rlax.w +4(r1)
    1862              ;;                addx.w +4(r1),0(r1)
    1863              ;;                movx.w +2(r1),+4(r1)
    1864              ;;                movx.w 0(r1),+2(r1)
    1865              ;;                incdx.a r1
    1866              
    1867              ;                /* Save the context of the current task. */
    1868              ;;        psh mmap(ST3_55)
    1869                  .if 1
    1870 0005a9 EB31                                      mov xar7, dbl (*(#_save_xar7))                  ; save xar7
         0005ab F500 
         0005ad 0000!
    1871 0005af EB31                          mov xar6, dbl (*(#_save_xar6))                  ; save x
         0005b1 E500 
         0005b3 0000!
    1872 0005b5 EC31                                                  amov #0x000000, xar7
         0005b7 FE00 
         0005b9 0000 
    1873 0005bb EC31                                                  amov #0x000000, xar6
         0005bd EE00 
         0005bf 0000 
    1874              
    1875 0005c1 AF00                          mov *sp(#0), ar7                                            ;; sp+3
    1876 0005c3 CF31                          mov ar7, *(#_save_new_pxcode)
         0005c5 0000 
         0005c7 00!  
    1877 0005c8 449E                          mov ssp, ar6
    1878 0005ca AFCD                          mov *ar6(#0), ar7                                                       ;; ssp+3
         0005cc 0000 
    1879 0005ce CF31                          mov ar7, *(#_save_new_pxlcode)       ;  ==> now we have our new return address, and i
         0005d0 0000 
         0005d2 00!  
    1880 0005d3 EC31                          amov #0x000000, xar7
         0005d5 FE00 
         0005d7 0000 
    1881 0005d9 AFCD                          mov *ar6(#1), ar7                               ; this is two away now
         0005db 0001 
    1882 0005dd CF31                                                  mov ar7, *(#_DBSTAT_SAVE)               ;; this is just for r
         0005df 0000 
         0005e1 00!  
    1883                                   ;   nop
    1884 0005e2 ED31                          mov dbl (*(#_pxCurrentTCB)), xar7
         0005e4 FF00 
         0005e6 0000!
    1885 0005e8 EB31                          mov xar7, dbl(*(#_xCompareTCB))
         0005ea F500 
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   68

         0005ec 0000!
    1886                                      .endif
    1887              
    1888              
    1889 ****** MACRO         portSAVE_CONTEXT
    1889              ;                       ;CONTEXT_SAVE
    1889              ;                       ASP  ; Align Stack Pointer
    1889              ;                       CLRC       OVM,PAGE0
    1889              ;                       CLRC       AMODE
    1889              ;                       EALLOW
    1889 0005ee 4652                  bclr C54CM      ; temp - until we figure out what is setting this
    1889              ;;;             bset INTM               ; disable interrupts - already done
    1889              ;                       aadd #1, sp
    1889 0005f0 20                            nop
    1889 0005f1 20                            nop
    1889 0005f2 20                            nop
    1889              
    1889              ;;                      mov xsp,  dbl (*(#_Ssave_xsp))                  ; save xsp
    1889              ;;                      mov xssp, dbl (*(#_Ssave_xssp))                 ; save xssp
    1889              ;;;                     mov dbl (*(#_save_xsp)), xsp                    ; restore xsp***
    1889              ;;;                     mov dbl (*(#_save_xssp)), xssp                  ; restore xssp***
    1889              
    1889              ;                       pshboth xar7
    1889              ;                       pshboth xar6
    1889              ;                       pshboth xar5
    1889              
    1889              ;;;;                    mov xar7, dbl (*(#_save_xar7))                  ; save xar7 (already saved)
    1889              ;                       .if configUSE_CONTEXT_DEBUG == 1
    1889              ;;;;                    mov xar6, dbl (*(#_save_xar6))                  ; saved in vTick ISR already
    1889              ;                       .endif
    1889 0005f3 4E01                          aadd #1, sp
    1889              ;;                  mov xsp,  dbl (*(#_Ssave_xsp))                      ; save xsp
    1889              ;;                      mov xssp, dbl (*(#_Ssave_xssp))
    1889              
    1889 0005f5 E531                          mov sp,  *(#_Ssave_xsp)                 ; save xsp
         0005f7 7800 
         0005f9 0000!
    1889 0005fb E531                          mov ssp, *(#_Ssave_xssp)
         0005fd 8800 
         0005ff 0000!
    1889              
    1889              ; +++===+++
    1889              
    1889                                      .if 1                                                           ; need to figure out 
    1889 000601 EB31                          mov xar1, dbl (*(#_save_xar1))
         000603 9500 
         000605 0000!
    1889 000607 EB31                          mov xar2, dbl (*(#_save_xar2))
         000609 A500 
         00060b 0000!
    1889 00060d EB31                          mov xar3, dbl (*(#_save_xar3))
         00060f B500 
         000611 0000!
    1889 000613 EB31                          mov xar4, dbl (*(#_save_xar4))
         000615 C500 
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   69

         000617 0000!
    1889 000619 EB31                          mov xar5, dbl (*(#_save_xar5))
         00061b D500 
         00061d 0000!
    1889 00061f EC31                          amov #0x000000, xar5
         000621 DE00 
         000623 0000 
    1889 000625 EC31                          amov #0x000000, xar6
         000627 EE00 
         000629 0000 
    1889 00062b 904D                          mov xsp, xar5
    1889 00062d 905E                          mov xssp, xar6
    1889              
    1889 00062f EC31                          amov #0x000000, xar2
         000631 AE00 
         000633 0000 
    1889 000635 EC31                          amov #0x000000, xar1
         000637 9E00 
         000639 0000 
    1889 00063b EC31                          amov #0x000000, xar3
         00063d BE00 
         00063f 0000 
    1889 000641 EC31                          amov #0x000000, xar4
         000643 CE00 
         000645 0000 
    1889 000647 ED31                          mov dbl (*(#_pxCurrentTCB)), xar7
         000649 FF00 
         00064b 0000!
    1889              
    1889 00064d EDE1                          mov dbl (*ar7), xar4                            ; xsp contains our TCB now
         00064f CF   
    1889 000650 EDED                          mov dbl (*ar7(#2)), xar3
         000652 BF00 
         000654 02   
    1889 000655 7B00                          add #0x0064, ar4
         000657 64CC 
    1889 000659 402B                          add #0x0002, ar3
    1889              
    1889 00065b AAAD                          mov *ar5(#0), ar2                               ; current xsp contents
         00065d 0000 
    1889 00065f A9CD                          mov *ar6(#0), ar1                               ; current xssp contents
         000661 0000 
    1889              ;                       mov ar4, *ar6                           ; stack pointers fixed up
    1889 000663 CA81                          mov ar2, *ar4                           ; saves our new PC - but, does this work in e
    1889 000665 C961                          mov ar1, *ar3
    1889              
    1889                                      .endif
    1889              ;;                      aadd #1, sp
    1889                                      .if 0
    1889                          amov #0x000000, xar7
    1889                                      mov dbl (*(#_pxCurrentTCB)), xar7
    1889                                      mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1889                                      mov dbl (*ar7(#2)), xssp
    1889                          amov #0x000000, xar7
    1889                                      amov #0x000000, xar6
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   70

    1889                          mov *(#_save_new_pxcode), ar7
    1889                          mov ar7, *sp(#0)
    1889                          amov #0x000000, xar7
    1889                          mov ssp, ar6
    1889                          mov *(#_save_new_pxlcode), ar7
    1889              ;            mov ar7, *ssp(#0)
    1889                          mov ar7, *ar6(#0)
    1889                              .endif
    1889              
    1889              ;                       mov ssp, ar7
    1889              ;                       mov *ar7(#1), ar6                               ; this is (one)two away now
    1889              ;                       mov ar6, *(#_DBSTAT_SAVE)                       ; save DBSTAT
    1889              ;                       .endif
    1889              ;                       mov xar7, dbl (*(#_save_xar7))                  ; save xar7
    1889              ;            mov xar6, dbl (*(#_save_xar6))                  ; save x
    1889                                      .if 0
    1889                                      amov #0x000000, xar7
    1889                                      amov #0x000000, xar6
    1889                          mov *sp(#0), ar7                                            ;; sp+3
    1889                          mov ar7, *(#_save_new_pxcode)
    1889                          mov ssp, ar6
    1889                          mov *ar6(#1), ar7                                                       ;; ssp+3
    1889                          mov ar7, *(#_save_new_pxlcode)       ;  ==> now we have our new return address, and if a task, it
    1889                                   ;   nop
    1889                          mov dbl (*(#_pxCurrentTCB)), xar7
    1889                          mov xar7, dbl(*(#_xCompareTCB))
    1889                          .endif
    1889              ; +++===+++
    1889              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1889              ;
    1889              
    1889              
    1889              ; +++===+++
    1889                                      .if 0
    1889              ;                       mov dbl (*(_xCompareTCB)), xar6                 ; need to save our return address
    1889              ;                       mov xar7, ac0
    1889              ;               mov xar6, ac1
    1889              ;                       CMPU AC1 != AC0, TC1
    1889              ;                               BCC $5,TC1
    1889                                      amov #0x000000, xar7
    1889                                          amov #0x000000, xar6
    1889                                          mov  *(#_save_new_pxcode), ar7
    1889                                          mov ar7, *sp(#0)
    1889                              mov *(#_save_new_pxlcode) , ar7
    1889                              mov ssp, ar6
    1889                              mov ar7, *ar6(#0)
    1889                              mov dbl (*(#_save_xar6)), xar6
    1889                                         .endif
    1889              ; +++===+++
    1889 000667       $5_$4$:
    1889                                              
    1889              ; +++===+++
    1889              ;; what about xssp here?
    1889              ;;                              mov xsp, dbl (*(#_save_xsp))                    ; save xsp
    1889              ;;                          mov xssp, dbl (*(#_save_xssp))                      ; save xssp
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   71

    1889                                 .if configUSE_CONTEXT_DEBUG == 1
    1889              ;; save current PC (and possible loop bits values)
    1889              ;; for debug - to see if this is being corrupted
    1889                                      mov dbl(*ar7), xar6
    1889                                      mov dbl(*ar6), xar7
    1889                                      mov xar7, dbl (*(#_PC_REG_LOW_SAVE))            ; save off the PC
    1889                                      mov xssp, xar7
    1889                                      mov dbl(*ar7), xar6
    1889                                      mov dbl(*ar6), xar7
    1889                                      mov xar7, dbl (*(#_PC_REG_HIGH_SAVE))           ; save off the PC
    1889                                      mov xssp, xar7
    1889                                      add #-2, ar7
    1889                                      mov dbl(*ar7), xar6
    1889                                      mov xar6,  dbl (*(_DBSTAT_SAVE))
    1889                          mov dbl (*(#_save_xar6)), xar6
    1889              
    1889              ;            mov (*ar7), (*(#_PC_REG_LOW_SAVE))
    1889              ;            mov dbl(*xssp),(*(#_PC_REG_HIGH_SAVE))
    1889              ;                       mov (*ssp(#-2)), (*(#_DBSTAT_SAVE))
    1889                                      .endif
    1889              ; +++===+++
    1889                                      ; save context in our stack(s) frame
    1889              
    1889              ;;;;                    mov dbl (*(#_pxCurrentTCB)), xar7
    1889              ;;;                     mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1889              ;;;                     mov dbl (*ar7(#2)), xssp
    1889              ; +++===+++
    1889              ;                   mov dbl (*(#_pxCurrentTCB)), xar7
    1889                                  ; add #0x0064, ar7
    1889              ;                       mov dbl (*ar7), xsp                                     ; xsp contains our TCB now
    1889              ;                       mov dbl (*ar7(#2)), xssp
    1889              ;           add #0x0064, ar4
    1889              ;                       add #0x0064, ar3
    1889              ;                       mov dbl (*ar5), xar4                            ; xsp contains our TCB now
    1889              ;                       mov dbl (*ar5(#2)), xar3                        ; xssp
    1889              ;                       add #0x0064, ar4
    1889              ;                       add #0x0064, ar3
    1889 000667 EC31                  amov #0x000000, xar7
         000669 FE00 
         00066b 0000 
    1889 00066d EC31                          amov #0x000000, xar6
         00066f EE00 
         000671 0000 
    1889 000673 ED31                      mov dbl (*(#_pxCurrentTCB)), xar7
         000675 FF00 
         000677 0000!
    1889 000679 EDE1                          mov dbl (*ar7), xar6                            ; xsp normal position
         00067b EF   
    1889 00067c 7B00                          add #0x0064, ar6
         00067e 64EE 
    1889 000680 90E4                          mov xar6, xsp                                           ; actual xsp
    1889 000682 EC31                          amov #0x000000, xar6
         000684 EE00 
         000686 0000 
    1889 000688 EDED                          mov dbl (*ar7(#2)), xar6                        ; xssp
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   72

         00068a EF00 
         00068c 02   
    1889 00068d 402E                          add #0x0002, ar6
    1889 00068f 90E5                          mov xar6, xssp
    1889              
    1889 000691 ED31              mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
         000693 FF00 
         000695 0000!
    1889 000697 ED31              mov dbl (*(#_save_xar6)), xar6
         000699 EF00 
         00069b 0000!
    1889 00069d ED31              mov dbl (*(#_save_xar1)), xar1                  ; restore xar7
         00069f 9F00 
         0006a1 0000!
    1889 0006a3 ED31              mov dbl (*(#_save_xar2)), xar2
         0006a5 AF00 
         0006a7 0000!
    1889 0006a9 ED31              mov dbl (*(#_save_xar3)), xar3                  ; restore xar7
         0006ab BF00 
         0006ad 0000!
    1889 0006af ED31              mov dbl (*(#_save_xar4)), xar4
         0006b1 CF00 
         0006b3 0000!
    1889 0006b5 ED31             mov dbl (*(#_save_xar5)), xar5
         0006b7 DF00 
         0006b9 0000!
    1889                                        ; restore xar6
    1889              ;;; begin context save:
    1889              
    1889 0006bb EB10                          mov xar7, dbl(*sp(#8))                          ; save xar7
         0006bd F5   
    1889 0006be CF0E                          mov ar7, *sp(#7)
    1889              
    1889 0006c0 EB14                          mov xar6, dbl(*sp(#10))
         0006c2 E5   
    1889 0006c3 CE12                          mov ar6, *sp(#9)
    1889              
    1889 0006c5 EB18                          mov xar5, dbl(*sp(#12))
         0006c7 D5   
    1889 0006c8 CD16                          mov ar5, *sp(#11)
    1889              
    1889 0006ca EB1C                          mov xar4, dbl(*sp(#14))
         0006cc C5   
    1889 0006cd CC1A                          mov ar4, *sp(#13)
    1889              
    1889 0006cf EB20                          mov xar3, dbl(*sp(#16))
         0006d1 B5   
    1889 0006d2 CB1E                          mov ar3, *sp(#15)
    1889              
    1889 0006d4 EB24                          mov xar2, dbl(*sp(#18))
         0006d6 A5   
    1889 0006d7 CA22                          mov ar2, *sp(#17)
    1889              
    1889 0006d9 EB28                          mov xar1, dbl(*sp(#20))
         0006db 95   
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   73

    1889 0006dc C926                          mov ar1, *sp(#19)
    1889              
    1889 0006de EB2C                          mov xar0, dbl(*sp(#22))
         0006e0 85   
    1889 0006e1 C82A                          mov ar0, *sp(#21)
    1889              
    1889 0006e3 EB30              mov  ac0, dbl(*sp(#24))
         0006e5 08   
    1889 0006e6 C02E              mov ac0, *sp(#23)
    1889              
    1889 0006e8 C732                          mov t3, *sp(#25)
    1889 0006ea C634                          mov t2, *sp(#26)
    1889 0006ec C536                          mov t1, *sp(#27)
    1889 0006ee C438                          mov t0, *sp(#28)
    1889              
    1889              ;;                      mov xsp,  dbl (*(#_Ssave_xsp))                  ; save xsp
    1889              ;;                      mov xssp, dbl (*(#_Ssave_xssp))
    1889                                      .if 1
    1889 0006f0 EC31                          amov #0x000000, xar7                                    ; save where we are in our IR
         0006f2 FE00 
         0006f4 0000 
    1889              ;                   mov dbl (*(#_Ssave_xsp)), xar7
    1889 0006f6 AF31                       mov *(#_Ssave_xsp), ar7
         0006f8 0000 
         0006fa 00!  
    1889              ;                   mov xar7, dbl(*sp(#29))
    1889 0006fb CF3C              mov ar7, *sp(#30)
    1889 0006fd EC31              amov #0x000000, xar7
         0006ff FE00 
         000701 0000 
    1889              ;                   mov dbl (*(#_Ssave_xssp)), xar7
    1889 000703 AF31                      mov *(#_Ssave_xssp), ar7
         000705 0000 
         000707 00!  
    1889              ;                   mov xar7, dbl(*sp(#31))
    1889 000708 CF40              mov ar7, *sp(#32)
    1889                                      .endif
    1889              
    1889 00070a ED31              mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
         00070c FF00 
         00070e 0000!
    1889              
    1889              ; +++===+++
    1889              ;;                      mov mmap(ST0_55), t0
    1889              ; - this is ok - we are not pushing - it's a relative stack frame
    1889              ;                       mov t0, *sp(#25)
    1889              ;;                      mov t0, *sp(#23)
    1889              ;;                      mov mmap(ST1_55), t1
    1889              ;                       mov t1, *sp(#26)                ; stomping on own mem
    1889              ;;                      mov t1, *sp(#21)                ; stomping on own mem
    1889              ;;                      mov mmap(ST2_55), t2
    1889              ;;                      mov t2, *sp(#22)
    1889              ;                       mov t2, *sp(#27)
    1889              ;;                      mov mmap(ST2_55), t3
    1889              ;                       mov t3, *sp(#28)
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   74

    1889              ;;                      mov t3, *sp(#24)
    1889              
    1889              ;                       PSH dbl(AR0) ; 32-bit
    1889              ;                       PSH dbl(AR1) 
    1889              ;                       PSH dbl(AR2) ; 32-bit
    1889              ;                       PUSH XAR3 ; 32-bit
    1889              ;                       PUSH XAR4 ; 32-bit
    1889                              ;-- Comment these to save cycles --------
    1889              ;                       PUSH XAR5 ; 32-bit
    1889              ;                       PUSH XAR6 ; 32-bit
    1889              ;                       PUSH XAR7 ; 32-bit
    1889                              ;----------------------------------------
    1889              
    1889              ;                       PUSH XT   ; 32-bit
    1889              
    1889              ;                       movl xar6, @_portFLAGS_INT_ENABLED
    1889              ;                       push xar6 ; portFLAGS_INT_ENABLED
    1889              ; +++===+++
    1889              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1889              ;                       mov dbl (*ar7), xsp                                     ; xsp contains our TCB now
    1889              ;                       mov dbl (*ar7(#2)), xssp
    1889              
    1889 000710 ED31                          mov dbl (*(#_portFLAGS_INT_ENABLED)), xar6
         000712 EF00 
         000714 0000!
    1889 000716 EB0C                          mov xar6, dbl(*sp(#6))
         000718 E5   
    1889              
    1889              ;                       movl xar7, @_usCriticalNesting
    1889              ;                       push xar7
    1889 000719 ED31                          mov dbl (*(#_usCriticalNesting)), xar7
         00071b FF00 
         00071d 0000!
    1889 00071f EB08                          mov xar7, dbl(*sp(#4))
         000721 F5   
    1889              
    1889 000722 EC31                          amov #0x000000, xar7
         000724 FE00 
         000726 0000 
    1889 000728 EC31                          amov #0x000000, xar6
         00072a EE00 
         00072c 0000 
    1889              
    1889 00072e AF06                          mov mmap(ST1_55), ar7
         000730 98   
    1889 000731 CF02                          mov ar7, *sp(#1)
    1889 000733 AF96                          mov  mmap(ST2_55), ar7
         000735 98   
    1889 000736 CF04                          mov ar7, *sp(#2)
    1889              
    1889 000738 449F                          mov ssp, ar7
    1889              ;                       mov *(#_LOOP_BITS), ar6                 ; save LOOP_BITS (CFCT)
    1889              ;                       and #0xFF00, ar6
    1889              ;                       mov ar6, *ar7(#1)
    1889              
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   75

    1889 00073a AE04                          mov mmap(ST0_55), ar6
         00073c 98   
    1889 00073d CEED                          mov ar6, *ar7(#2)
         00073f 0002 
    1889                                      
    1889 000741 AE31                          mov *(#_DBSTAT_SAVE), ar6               ; save DBSTAT
         000743 0000 
         000745 00!  
    1889 000746 CEED                          mov ar6, *ar7(#1)
         000748 0001 
    1889              ; +++===+++
    1889              ;                       mov dbl (*(#_save_xsp)), xsp                    ; restore xsp*
    1889              ;                       mov dbl (*(#_save_xssp)), xssp          
    1889              ;;;                     mov  dbl (*(_DBSTAT_SAVE)), *xar7(#2)   ; needs to be DBSTAT - don't overwrite DBSTAT
    1889              ;;;                     mov ar6, *ar7(#2)
    1889              ;                       mov ar7, mmap(ST0_55)
    1889              ;                       mov *ssp(#2), ar7
    1889              ; fix up
    1889              ;                       aadd #20, sp
    1889              ;                       mov sp, t0
    1889              ;                       sub #1, t0
    1889              ;                       mov t0, ssp
    1889              
    1889                                      ; move contents of SP into address of current TCB
    1889              ;                       mov xsp, dbl (*(#_pxCurrentTCB))                ; xsp contains our TCB now
    1889              
    1889              ;                       mov xar7, dbl (*(#_save_xar7))                  ; save xar7 
    1889              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1889              ;                       mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1889              ;                       mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1889              ;                       mov dbl (*ar7+), xssp
    1889              
    1889              ;                       mov sp, t0              ; we've already saved t0
    1889              ;                       add #1, t0
    1889              ;                       mov t0, ssp
    1889              ; ??
    1889              ;                       mov xsp, dbl (*(#_pxCurrentTCB))
    1889              
    1889              ;                       movl xar6, @_pxCurrentTCB ; XAR6 contains current TCB addr
    1889              ;                       mov al, @sp
    1889              ;                       movl  *xar6, acc        
    1889              ;;                      mov  ar0, @sp
    1889              ;;                      mov  @ar6, alxd
    1889              ;;                      mov  ar0, @sp
    1889              ;;                      movl 0(xar6), sp
    1889              ;                       EDIS
    1889              ;                       NASP
    1889              ;; ;;                   mov dbl (*(#_save_xsp)), xsp    ; restore xsp           
    1889              ;                       NOP
    1889              ;                       .if configSTACK_PTR_DEBUG == 1
    1889              ;                       mov xsp, dbl(*(#_Ssave_xsp))
    1889              ;            mov xssp, dbl(*(#_Ssave_xssp))
    1889              ;            .endif
    1889                              .if 0
    1889                                      mov  xar7, dbl (*(#_save_xar7))                 ; restore xar7
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   76

    1889                          mov  xar6, dbl (*(#_save_xar6))
    1889              
    1889                              amov #0x000000, xar7
    1889                                      amov #0x000000, xar6
    1889                                  mov dbl (*(#_pxCurrentTCB)), xar7
    1889                                      mov dbl (*ar7), xar6                            ; xsp normal position
    1889                                      add #0x0064, ar6
    1889                                      mov xar6, xsp                                           ; actual xsp
    1889                                      mov dbl (*ar7(#2)), xar6                        ; xssp
    1889                                      add #0x0002, ar6
    1889                                      mov xar6, xssp
    1889              
    1889                          mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
    1889                          mov dbl (*(#_save_xar6)), xar6
    1889                        .endif
    1889              
    1889              ;;;;                    mov dbl (*(#_save_xsp)), xsp                    ; restore xsp*
    1889              ;;;;                    mov dbl (*(#_save_xssp)), xssp
    1889              
    1889              ;                       mov dbl (*(#_Ssave_xsp)), xsp                   ; restore xsp*
    1889              ;                       mov dbl (*(#_Ssave_xssp)), xssp                 ; restore xssp
    1889 00074a DC31              mov *(#_Ssave_xsp), sp                      ; restore xsp*
         00074c 7200 
         00074e 0000!
    1889 000750 DC31                          mov *(#_Ssave_xssp), ssp
         000752 8200 
         000754 0000!
    1889 000756 20                            nop
    1889 000757 4EFF                          aadd #-1, sp
    1889 000759 20                            nop
    1889              
    1889 00075a 20                            nop
    1889                                                                                      ; ?
    1890              
    1891              ;        /* Switch to the highest priority task that is ready to run. */
    1892 00075b EB31                                    mov xsp, dbl(*(#_yield_xsp))
         00075d 4500 
         00075f 0000!
    1893 000761 EB31                                mov xssp, dbl(*(#_yield_xssp))
         000763 5500 
         000765 0000!
    1894              
    1895 000767 ED31                    mov dbl(*(#_root_xsp)), xsp
         000769 4F00 
         00076b 0000!
    1896 00076d ED31                                mov dbl(*(#_root_xssp)), xssp
         00076f 5F00 
         000771 0000!
    1897              
    1898 000773 6C00          call    #_vTaskSwitchContext
         000775 0000!
    1899              
    1900 000777 EB31                    mov xsp, dbl(*(#_root_xsp))
         000779 4500 
         00077b 0000!
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   77

    1901 00077d EB31                                mov xssp, dbl(*(#_root_xssp))
         00077f 5500 
         000781 0000!
    1902              
    1903 000783 ED31                                mov dbl(*(#_yield_xsp)), xsp
         000785 4F00 
         000787 0000!
    1904 000789 ED31                                mov dbl(*(#_yield_xssp)), xssp
         00078b 5F00 
         00078d 0000!
    1905              
    1906              
    1907                                      .if 1
    1908 00078f EB31                          mov xar7, dbl (*(#_save_xar7))                  ; save xar7
         000791 F500 
         000793 0000!
    1909 000795 EB31              mov xar6, dbl (*(#_save_xar6))
         000797 E500 
         000799 0000!
    1910 00079b EB31              mov ac0, dbl (*(#_save_ac0))                  ; save xar7
         00079d 0800 
         00079f 0000!
    1911 0007a1 EB31              mov ac1, dbl (*(#_save_ac1))
         0007a3 1800 
         0007a5 0000!
    1912 0007a7 EB31              mov xar1, dbl(*(#_save_xar1))
         0007a9 9500 
         0007ab 0000!
    1913 0007ad EC31              amov #0x000000, xar7
         0007af FE00 
         0007b1 0000 
    1914 0007b3 EC31                          amov #0x000000, xar6
         0007b5 EE00 
         0007b7 0000 
    1915 0007b9 ED31                          mov dbl (*(_xCompareTCB)), xar6
         0007bb EF00 
         0007bd 0000!
    1916 0007bf ED31                      mov dbl (*(#_pxCurrentTCB)), xar7
         0007c1 FF00 
         0007c3 0000!
    1917                          ; need to restore our return address
    1918 0007c5 3C00              mov #0x000000, ac0
    1919 0007c7 3C01                          mov #0x000000, ac1
    1920 0007c9 90F0                          mov xar7, ac0
    1921 0007cb 90E1              mov xar6, ac1
    1922 0007cd 1210                  CMPU AC1 == AC0, TC1 ; |1393|
         0007cf 04   
    1923 0007d0 6464              BCC $B,TC1 ; |1393|
    1924 0007d2 20                nop                 ; breakpoint here - context switch has occurred
    1925                          .if configUSE_TICK_CTR == 1
    1926 0007d3 F731                      add #1, *(#_context_switch_counter)
         0007d5 0001 
         0007d7 0000 
         0007d9 00!  
    1927                                  .endif
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   78

    1928                                  .if 0
    1929                                  amov #0x000000, xar7
    1930                                  amov #0x000000, xar1
    1931                                  mov *(#_save_new_pxcode), ar7
    1932                                  mov *ar6(#0), ar1
    1933                                  add #0x0064, ar1
    1934                                  mov ar7, *ar1
    1935                                  mov *(#_save_new_pxlcode), ar7
    1936                                  amov #0x000000, xar1
    1937                                  mov *ar6(#2), ar1
    1938                                  add #0x0002, ar1
    1939                                  mov ar7, *ar1
    1940                                  .endif
    1941                                  ; amov #0x000000, xar7
    1942                                      ;    amov #0x000000, xar6
    1943                          ;  mov  *(#_save_new_pxcode), ar7
    1944                                      ;    mov ar7, *sp(#0)
    1945                          ;                mov *(#_save_new_pxlcode) , ar7
    1946                          ;                mov ssp, ar6
    1947                          ;                mov ar7, *ar6(#0)
    1948              
    1949                          ;                mov dbl (*(#_save_xar6)), xar6
    1950                                      ;                       .endif
    1951              ; +++===+++
    1952 0007da       $B:
    1953 0007da ED31              mov dbl (*(#_save_ac0)), ac0                  ; save xar7
         0007dc 0800 
         0007de 0000!
    1954 0007e0 ED31              mov dbl (*(#_save_ac1)), ac1
         0007e2 1800 
         0007e4 0000!
    1955 0007e6 ED31              mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
         0007e8 FF00 
         0007ea 0000!
    1956 0007ec ED31              mov dbl (*(#_save_xar6)), xar6
         0007ee EF00 
         0007f0 0000!
    1957 0007f2 ED31              mov dbl (*(#_save_xar1)), xar1
         0007f4 9F00 
         0007f6 0000!
    1958                       .endif
    1959              ;        .endif
    1960              
    1961 0007f8 E651          mov #1, *port(#6166) ; |127|
         0007fa 0118 
         0007fc 16   
    1962 0007fd F551                  or #0x0001, *port(#7188) ; |130|
         0007ff 0001 
         000801 1C14 
    1963 000803 4E01                  aadd #1, sp
    1964 ****** MACRO         portRESTORE_CONTEXT
    1964                                      .C54CM_off
    1964              ;                       .CPL_off
    1964                                      .ARMS_off
    1964                                      .align 4
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   79

    1964              
    1964              ; Restore context & return - here we need to know what context we're in
    1964                                      ;CONTEXT_RESTORE
    1964              ;                       ASP
    1964              ;                       EALLOW
    1964              ;                       nop
    1964              ;                       nop
    1964              ;                       nop
    1964              ;                       nop
    1964 000808 4652                  bclr C54CM
    1964 00080a 20                    nop
    1964 00080b 20                    nop
    1964 00080c 20                    nop
    1964 00080d 20                    nop
    1964 00080e 20                    nop
    1964 00080f 20                    nop
    1964              ;               xssp = dbl(*(#_pxCurrentTCB))
    1964              ;               xsp  = dbl(*(#_pxCurrentTCB))
    1964 000810 EB31                          mov xar7, dbl (*(#_save_xar7))  
         000812 F500 
         000814 0000!
    1964 000816 EB31                          mov xar6, dbl (*(#_save_xar6))
         000818 E500 
         00081a 0000!
    1964              
    1964              ;;;;                     aadd #-3, sp                           ;;;;
    1964              ;            aadd #-3, xsp
    1964              ;            CMP *(#_first_flag) == #1, TC1 ; |216|
    1964              ;            BCC $1,TC1 ; |216|
    1964              ;;                      mov dbl (*(#_save_xsp)), xsp                    ; restore xsp***
    1964              ;;                      mov dbl (*(#_save_xssp)), xssp                  ; restore xssp***
    1964              ;            B $4
    1964              ;;              aadd #-1, sp
    1964 00081c EB31                          mov xsp, dbl (*(#_restore_xsp))                 ; save xsp
         00081e 4500 
         000820 0000!
    1964 000822 EB31                          mov xssp, dbl (*(#_restore_xssp))                       ; save xssp
         000824 5500 
         000826 0000!
    1964               ;                      aadd #3, xsp
    1964              ;;;             aadd #-3, sp
    1964              
    1964              ;;;;            mov dbl(*(#_root_xsp)), xsp
    1964              ;;;;                    mov dbl(*(#_root_xssp)), xssp
    1964              ;;;                     aadd #3, sp
    1964              
    1964              ;$1
    1964              ;                       mov dbl (*(#_first_save_xsp)), xsp                      ; restore xsp
    1964              ;                       mov dbl (*(#_first_save_xssp)), xssp                    ; restore xssp
    1964              ;$4
    1964                                      .if 1
    1964              ;;                      aadd #-1, sp
    1964              
    1964                                      .if 0
    1964                                      amov #0x000000, xar7                                    ; save where we are in our IR
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   80

    1964                                  mov dbl (*(#_Ssave_xsp)), xar7
    1964              ;                   mov xar7, dbl(*sp(#29))
    1964              
    1964                          amov #0x000000, xar7
    1964                                  mov dbl (*(#_Ssave_xssp)), xar7
    1964              ;                   mov xar7, dbl(*sp(#31))
    1964                          mov ar7, *sp(#32)
    1964                                      .endif
    1964              
    1964              
    1964              ;;                      mov xsp, xar7
    1964              ;;                      mov xssp, xar6
    1964              
    1964 000828 EC31                          amov #0x000000, xar2
         00082a AE00 
         00082c 0000 
    1964 00082e EC31                          amov #0x000000, xar1
         000830 9E00 
         000832 0000 
    1964              
    1964 000834 ED31                          mov dbl (*(#_pxCurrentTCB)), xar5
         000836 DF00 
         000838 0000!
    1964                                                                                               ;; points to our variables n
    1964 00083a EDA1                          mov dbl (*ar5), xar4                            ; xsp contains our TCB now
         00083c CF   
    1964 00083d EDAD                          mov dbl (*ar5(#2)), xar3
         00083f BF00 
         000841 02   
    1964              
    1964              ;;                      mov xar4, xar7
    1964              ;;                      mov xar3, xar6
    1964              ;;                      mov xar7, xsp
    1964              ;;                      mov xar6, xssp
    1964              
    1964 000842 7B00                          add #0x0064, ar4
         000844 64CC 
    1964 000846 402B                          add #0x0002, ar3
    1964                                      
    1964 000848 90C4                          mov xar4, xsp
    1964 00084a 90B5                          mov xar3, xssp
    1964              
    1964 00084c EC31                          amov #0x000000, xar7
         00084e FE00 
         000850 0000 
    1964 000852 EC31                          amov #0x000000, xar6
         000854 EE00 
         000856 0000 
    1964 000858 AF3C                  mov *sp(#30), ar7                       ; saved IRQ xsp
    1964 00085a AE40                  mov *sp(#32), ar6                       ; saved IRQ xssp
    1964              
    1964 00085c 90F4                          mov xar7, xsp
    1964 00085e 90E5                          mov xar6, xssp
    1964              
    1964 000860 AA81                          mov *ar4, ar2
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   81

    1964 000862 A961                          mov *ar3, ar1                           ; maybe not on a yield here
    1964              ;                       mov ar4, *ar6                           ; stack pointers fixed up
    1964 000864 CAE1                          mov ar2, *ar7
    1964 000866 C9C1                          mov ar1, *ar6
    1964              
    1964 000868 EB31                          mov xsp, dbl (*(#_restore_xsp))                 ; save xsp
         00086a 4500 
         00086c 0000!
    1964 00086e EB31                          mov xssp, dbl (*(#_restore_xssp))
         000870 5500 
         000872 0000!
    1964              
    1964 000874 AF06                          mov mmap(ST1_55), ar7
         000876 98   
    1964 000877 7DF7                          and #0xf7ff, ar7                        ; <here>#0800h
         000879 FFFF 
    1964 00087b CF02                          mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
    1964 00087d CF8D                          mov ar7, *ar4(#1)                       ; save in TCB
         00087f 0001 
    1964 000881 AF96                          mov mmap(ST2_55), ar7
         000883 98   
    1964 000884 CF04                          mov ar7, *sp(#2)
    1964 000886 CF8D                          mov ar7, *ar4(#2)
         000888 0002 
    1964              
    1964 00088a 449F                          mov ssp, ar7
    1964 00088c AE04                          mov mmap(ST0_55), ar6
         00088e 98   
    1964 00088f CEED                          mov ar6, *ar7(#2)
         000891 0002 
    1964 000893 CE6D                          mov ar6, *ar3(#2)
         000895 0002 
    1964 000897 AE31                          mov *(#_DBSTAT_SAVE), ar6               ; have to restore this
         000899 0000 
         00089b 00!  
    1964              ;;                      mov ar6, *ar7(#1)
    1964 00089c CE6D                          mov ar6, *ar3(#1)
         00089e 0001 
    1964                                      .endif
    1964              
    1964              ;                       mov #0, ssp     
    1964              ;                       mov xar7, dbl (*(#_save_xar7))                  ; save xar7 
    1964              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1964                                      ; 32-bit mode - will act on SP and SSP:
    1964              ;                       'fix-up' current SP and SSP - is this dangerous????
    1964              ;                       aadd #-3, sp
    1964              ;;                      mov *ar7, *sp
    1964              ;                       mov dbl (*ar7), ar6
    1964              ;                       mov ar6, *sp                            ; xsp contains our TCB now
    1964              ;                       mov *ar7(#2), *ssp                      
    1964              ;                       POP mmap(ST3_55)
    1964              ;                       pshboth xar7                            ; should increment both
    1964                                      .if 0
    1964                                      mov mmap(ST1_55), ar7
    1964                                      and #0xf7ff, ar7                        ; <here>#0800h
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   82

    1964                                      mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
    1964                                      mov mmap(ST2_55), ar7
    1964                                      mov ar7, *sp(#2)
    1964              
    1964                                      mov ssp, ar7
    1964                                      mov mmap(ST0_55), ar6
    1964                                      mov ar6, *ar7(#2)
    1964              ;;                      mov mmap(ST0_55), ar6   ; needs to be DBSTAT
    1964              ;;                      mov ar6, *ar7(#1)
    1964                                      .endif
    1964              ; +++===+++
    1964                                      .if 0
    1964                                      mov dbl (*(#_pxCurrentTCB)), xar7
    1964                                      mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1964                                      mov dbl (*ar7(#2)), xssp        
    1964                                      .endif
    1964              ; +++===+++
    1964                                      .if 0
    1964                                      mov dbl (*(_xCompareTCB)), xar6
    1964              ; need to restore our return address
    1964                                      mov xar7, ac0
    1964                                          mov xar6, ac1
    1964                                          CMPU AC1 != AC0, TC1 ; |1393|
    1964                                          BCC $6,TC1 ; |1393|
    1964                                          amov #0x000000, xar7
    1964                                          amov #0x000000, xar6
    1964                                          mov  *(#_save_new_pxcode), ar7
    1964                                          mov ar7, *sp(#0)
    1964                                          mov *(#_save_new_pxlcode) , ar7
    1964                                          mov ssp, ar6
    1964                                          mov ar7, *ar6(#0)
    1964              
    1964                                          mov dbl (*(#_save_xar6)), xar6
    1964                                                              .endif
    1964              ; +++===+++
    1964 0008a0       $6_$5$:
    1964              ;;                mov xsp, dbl (*(#_save_xsp))                  ; save xsp
    1964              ;;                          mov xssp, dbl (*(#_save_xssp))                      ; save xssp
    1964                                      .if configUSE_CONTEXT_RESTORE_DEBUG == 1
    1964                                      mov xar7, dbl (*(#_save_xar7))                  ; save xar7
    1964                                      mov xar6, dbl (*(#_save_xar6))
    1964              
    1964              ;; this is for debug
    1964                                      mov dbl(*ar7), xar6
    1964                                      mov dbl(*ar6), xar7
    1964                                      mov xar7, dbl (*(#_PC_REG_LOW_RESTORE))         ; save off the PC
    1964                                      mov xssp, xar7
    1964                                      mov dbl(*ar7), xar6
    1964                                      mov dbl(*ar6), xar7
    1964                                      mov xar7, dbl (*(#_PC_REG_HIGH_RESTORE))                ; save off the PC
    1964                                      mov xssp, xar7
    1964                                      add #-2, ar7
    1964                                      mov dbl(*ar7), xar6
    1964                                      mov xar6,  dbl (*(_DBSTAT_RESTORE))
    1964                                      mov dbl (*(#_save_xar6)), xar6
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   83

    1964                                      
    1964                                      mov dbl (*(#_save_xar7)), xar7                  ; restore xar7
    1964                                      .endif
    1964              ; +++===+++
    1964              ;                       mov mmap(ST0_55), *ssp(#1)
    1964              ;                       mov mmap(STO_55), *ssp(#2)
    1964              ;                       mov mmap(ST1_55), *sp(#1)
    1964              ;                       mov mmap(ST2_55), *sp(#2)               ; needs to be DBSTAT                    
    1964              ;                       mov *ar7, t0
    1964              ;                       mov t0, *sp(#0)                         ; xsp contains our TCB now
    1964              ;                       mov *ar7(#2), t0
    1964              ;                       mov t0, *ssp(#0)                        
    1964              
    1964              ;                       mov  (*ar7), sp                                 ; xsp contains our TCB now
    1964              ; what about xssp?
    1964              ;                       mov xar6, xsp
    1964              ;                       mov xssp, xar7
    1964              ;                       add #1, ar7
    1964              ;                       mov xar7, xsp
    1964              ;                       mov sp, t0
    1964              ;                       mov ssp, t1
    1964              ;                       mov dbl(*(#_pxCurrentTCB)), xsp
    1964              ;                       ar0 = *ar6
    1964              ;                       xssp = xar0
    1964              ;                       mov *xar6, xar0
    1964              ;                       mov xar0, xssp  ; stack now points to our TCB
    1964              ;;                      mov sp, *ar6
    1964              ;;                      mov sp, ar0
    1964              ;;                      mov sp, *_pxCurrentTCB
    1964              ;;                      clr ar0
    1964              ;;                      mov ar0, @xar6
    1964              ;;                      mov sp, AR0
    1964              ;;                      add sp, xar6
    1964              
    1964              ;;                      pshboth xar7
    1964              ;;                      pshboth xar6
    1964              ;;                      pshboth xar5
    1964              
    1964              ;;                      popboth xar5
    1964              ;;                      popboth xar6
    1964              ;;                      popboth xar7
    1964              
    1964              ;;;                     mov *sp(#1), ar7 
    1964              ;                       mov dbl(*sp(#1)), ar7
    1964              ;;;                     mov  ar7, mmap(ST1_55)
    1964              ; +++===+++
    1964              ;                       mov dbl (*(#_pxCurrentTCB)), xar7
    1964              ;                       add #0x0064, ar7
    1964              ;                       mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1964              ;                       mov *ar7(#2)
    1964              ;                       mov dbl (*ar7(#2)), xssp
    1964              ; ===+++===
    1964                 .if 1
    1964 0008a0 EC31                  amov #0x000000, xar7
         0008a2 FE00 
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   84

         0008a4 0000 
    1964 0008a6 EC31                          amov #0x000000, xar6
         0008a8 EE00 
         0008aa 0000 
    1964 0008ac ED31                      mov dbl (*(#_pxCurrentTCB)), xar7
         0008ae FF00 
         0008b0 0000!
    1964 0008b2 EDE1                          mov dbl (*ar7), xar6                            ; xsp normal position
         0008b4 EF   
    1964 0008b5 7B00                          add #0x0064, ar6
         0008b7 64EE 
    1964 0008b9 90E4                          mov xar6, xsp                                           ; actual xsp
    1964 0008bb EDED                          mov dbl (*ar7(#2)), xar6                        ; xssp
         0008bd EF00 
         0008bf 02   
    1964 0008c0 402E                          add #0x0002, ar6
    1964 0008c2 90E5                          mov xar6, xssp
    1964                 .endif
    1964              ; ===+++===
    1964              ;                       add #0x0064, xssp
    1964              ; +++===+++
    1964                                      .if 0
    1964                                      mov *sp(#2), ar7
    1964                                      mov ar7, mmap(ST2_55)
    1964                                      mov ssp, ar7
    1964                                      mov *ar7(#2), ar6
    1964                                      mov ar6, mmap(ST0_55)
    1964                                      .endif
    1964              ;                       mov *ar7(#2), ar6
    1964              ;                       mov ar6, *ssp(#2)
    1964              ;                       mov *ssp(#2), ar7
    1964              ;                       mov ar6, mmap(ST0_55)   ; needs to be DBSTAT
    1964              ;
    1964              ; restore context
    1964              
    1964 0008c4 EC31                          amov #0x000000, xar2
         0008c6 AE00 
         0008c8 0000 
    1964 0008ca EC31                          amov #0x000000, xar1
         0008cc 9E00 
         0008ce 0000 
    1964              
    1964                                      .if 0
    1964                                      mov mmap(ST1_55), ar7
    1964                                      and #0xf7ff, ar7                        ; <here>#0800h
    1964                                      mov ar7, *sp(#1)                        ; need to make sure IRQ bit is enabled here
    1964                                      mov ar7, mmap(ST1_55)
    1964              ;                       mov ar7, *ar4(#1)                       ; save in TCB
    1964                                      mov mmap(ST2_55), ar7
    1964                                      mov ar7, *sp(#2)
    1964              ;                       mov ar7, *ar4(#2)
    1964              
    1964                                      mov ssp, ar7
    1964                                      mov mmap(ST0_55), ar6
    1964                                      mov ar6, *ar7(#2)
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   85

    1964              ;                       mov ar6, *ar3(#2)
    1964                                      mov *(#_DBSTAT_SAVE), ar6               ; have to restore this
    1964                                      mov ar6, *ar7(#1)
    1964              ;                       mov ar6, *ar3(#2)
    1964                                      .endif
    1964              ;;                      mov *(#_LOOP_BITS), ar6         ; have to restore this
    1964              ;;                      and #0xFF00, ar6
    1964              ;;                      mov ar6, *ar7(#1)
    1964              
    1964 0008d0 ED08                          mov dbl(*sp(#4)), xar7
         0008d2 FF   
    1964              ;                       mov *sp(#1), ar7
    1964 0008d3 EB31                          mov xar7, dbl(*(#_usCriticalNesting))   
         0008d5 F500 
         0008d7 0000!
    1964              
    1964 0008d9 ED0C                          mov dbl(*sp(#6)), xar6
         0008db EF   
    1964              ;                       mov *sp(#3), ar6
    1964              ;                       popboth xar6 ; portFLAGS_INT_ENABLED
    1964 0008dc EB31                          mov xar6, dbl(*(#_portFLAGS_INT_ENABLED))       
         0008de E500 
         0008e0 0000!
    1964              ;                       POP XT
    1964                              ;-- Comment these to save cycles ---
    1964 0008e2 ED10                          mov dbl(*sp(#8)), xar7
         0008e4 FF   
    1964 0008e5 AF0E                          mov *sp(#7), ar7
    1964              ;                       mov *sp(#5), ar7
    1964              ;                       mov dbl(*sp(#0)), hi(ar7)
    1964              ;                       mov (*sp(#0)), lo(ar7)
    1964 0008e7 ED14                          mov dbl(*sp(#10)), xar6
         0008e9 EF   
    1964 0008ea AE12                          mov *sp(#9), ar6
    1964 0008ec ED18                          mov dbl(*sp(#12)), xar5
         0008ee DF   
    1964 0008ef AD16                          mov *sp(#11), ar5
    1964              ;; pvPararmeters currently here - needs to be verified --- jcw
    1964 0008f1 ED1C                          mov dbl(*sp(#14)), xar4
         0008f3 CF   
    1964 0008f4 AC1A                          mov *sp(#13), ar4
    1964 0008f6 ED20                          mov dbl(*sp(#16)), xar3
         0008f8 BF   
    1964 0008f9 AB1E                          mov *sp(#15), ar3
    1964 0008fb ED24                          mov dbl(*sp(#18)), xar2
         0008fd AF   
    1964 0008fe AA22                          mov *sp(#17), ar2
    1964 000900 ED28                          mov dbl(*sp(#20)), xar1
         000902 9F   
    1964 000903 A926                          mov *sp(#19), ar1
    1964 000905 ED2C                          mov dbl(*sp(#22)), xar0
         000907 8F   
    1964 000908 A82A                          mov *sp(#21), ar0
    1964 00090a ED30                      mov dbl(*sp(#24)), ac0
         00090c 08   
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   86

    1964 00090d A02E              mov *sp(#23), ac0
    1964              
    1964 00090f A732                          mov *sp(#25), t3
    1964 000911 A634                          mov *sp(#26), t2
    1964 000913 A536                          mov *sp(#27), t1
    1964 000915 A438                          mov *sp(#28), t0
    1964              
    1964              ;                       mov dbl(*sp(#21)), *xssp(#0)
    1964              ;                       mov *sp(#21), *ssp
    1964              ;                       mov *sp(#21), RETA
    1964              ; need to move 23-16 to XSSP contents
    1964              ;                       mov xar0, dbl (*(#_save_xar7))
    1964              ;                       mov ssp, ar0
    1964              ;                       mov #0, ssp 
    1964              ;                       mov xssp, xar0
    1964              ;                       mov dbl (*(#_save_xsp)), xar0                   ; save xsp
    1964              ;                       aadd #20, sp            ; this is ok - ssp also incremented
    1964                      ;               add #1, xssp            ; 32-bit return address pointer
    1964                      ;               amar *xssp+
    1964              ;                       mov sp, t0
    1964              ;                       add #1, t0
    1964              ;                       mov t0, ssp
    1964              ;                       incr ssp
    1964              ;                       asub #20, ar0
    1964              ;                       mov xar0, xssp
    1964              ;                       mov ar0, ssp
    1964              ;                       mov ar0, 
    1964              ;;                      mov *sp(#1), t0
    1964              ;;                      mov *sp(#3), t3         ; ST0
    1964              ;;                      mov *sp(#4), t2         ; DBSTAT
    1964              ;;                      mov t3, *ar0(#2)
    1964                      ;;              mov t2, *ar0(#1)
    1964              ;;                      mov t0, *ar0(#0)
    1964              
    1964              ;;                      mov *sp(#5), t0
    1964              ;;                      mov *sp(#6), t1
    1964              ;;                      mov *sp(#7), t2
    1964                      ;;              mov *sp(#8), t3
    1964              
    1964              ; restore ar0
    1964              ;                       mov dbl(*sp(#-2)), xar0
    1964              ;                       mov #-1, ar0
    1964              ;;                      mov dbl (*(#_save_xar7)), xar0
    1964              ;;
    1964              ;;                      mov sp, t0
    1964              ;;                      add #1, t0
    1964              ;;                      mov t0, ssp
    1964              
    1964              ;                       mov *sp(#3), *(#00004ch+#1)
    1964              
    1964              ;                       mov t3, *ssp(#1) 
    1964              ;                       mov t2, *ssp(#2)
    1964              
    1964              ;;                      mov *sp(#1), dbl(*(#_save_xsp)) 
    1964              ;;                      mov t3, *(ssp(#0))
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   87

    1964              ;                       mov t3, *ssp
    1964              ;                       mov *sp(#3), t3 ; 
    1964              ;                       mov t3, *ssp(#1)
    1964              ;;                      mov *sp(#21), PC        
    1964              
    1964              ;; ;;                   mov dbl (*(#_save_xsp)), xsp    ; restore xsp           
    1964              ;                       mov dbl(xsp), dbl(lcrpc)
    1964              ;                       popboth XAR7
    1964              ;                       add #1, sp
    1964              ;                       add #1, ssp
    1964              ;                       add #2, t0
    1964              ;                       add #2, t1
    1964              ;                       mov t0, sp
    1964              ;                       mov t1, ssp
    1964              ;                       popboth XAR6
    1964              ;                       add #2, t0
    1964              ;                       add #2, t1
    1964              ;                       mov t0, sp
    1964              ;                       mov t1, ssp
    1964              ;                       popboth XAR5
    1964              ;                       add #2, t0
    1964              ;                       add #2, t1
    1964              ;                       mov t0, sp
    1964              ;                       mov t1, ssp
    1964                              ;-----------------------------------
    1964              ;                       popboth XAR4
    1964              ;                       add #2, t0
    1964              ;                       add #2, t1
    1964              ;                       mov t0, sp
    1964              ;                       mov t1, ssp
    1964              ;                       popboth XAR3
    1964              ;                       add #2, t0
    1964              ;                       add #2, t1
    1964              ;                       mov t0, sp
    1964              ;                       mov t1, ssp
    1964              ;                       popboth XAR2
    1964              ;                       add #2, t0
    1964              ;                       add #2, t1
    1964              ;                       mov t0, sp
    1964              ;                       mov t1, ssp
    1964              ;                       popboth XAR1
    1964              ;                       add #2, t0
    1964              ;                       add #2, t1
    1964              ;                       mov t0, sp
    1964              ;                       mov t1, ssp
    1964              ;                       popboth XAR0
    1964              ;                       add #2, t0
    1964              ;                       add #2, t1
    1964              ;                       mov t0, sp
    1964              ;                       mov t1, ssp
    1964              ;                       EDIS
    1964              ;                       NASP    ; Un-align stack pointer
    1964              ;;                      pop mmap(ST3_55)
    1964              ;            CMP *(#_first_flag) == #1, TC1 ; |216|
    1964              ;            BCC $2,TC1 ; |216|
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   88

    1964                                      .if 0
    1964                                      mov dbl (*(#_pxCurrentTCB)), xar7
    1964              
    1964                                      mov dbl (*ar7), xsp                             ; xsp contains our TCB now
    1964                                      mov dbl (*ar7(#2)), xssp                
    1964                                      .endif
    1964              
    1964              ;;;              mov dbl(*(#_restore_xsp)), xsp
    1964 000917 ED31               mov dbl(*(#_restore_xssp)), xssp
         000919 5F00 
         00091b 0000!
    1964 00091d ED31               mov dbl(*(#_restore_xsp)), xsp
         00091f 4F00 
         000921 0000!
    1964              
    1964              ;;             aadd #-3, sp
    1964              
    1964              ;;;;                    mov dbl(*(#_root_xssp)), xssp
    1964              ;;;                     aadd #3, sp
    1964              ;;;;;;                  mov dbl (*(#_save_xsp)), xsp                    ; restore xsp***
    1964              ;;;;;;                  mov dbl (*(#_save_xssp)), xssp                  ; restore xssp***
    1964              
    1964              
    1964                                      .if 0
    1964                                      mov dbl (*(_xCompareTCB)), xar6
    1964              ; need to restore our return address
    1964                                      mov xar7, ac0
    1964                          mov xar6, ac1
    1964                              CMPU AC1 != AC0, TC1 ; |1393|
    1964                          BCC $6,TC1 ; |1393|
    1964                          amov #0x000000, xar7
    1964                                      amov #0x000000, xar6
    1964                          mov  *(#_save_new_pxcode), ar7
    1964                                      mov ar7, *sp(#0)
    1964                          mov *(#_save_new_pxlcode) , ar7
    1964                          mov ssp, ar6
    1964                          mov ar7, *ar6(#0)
    1964              
    1964                          mov dbl (*(#_save_xar6)), xar6
    1964                                      .endif
    1964              
    1964              ;;                      mov dbl (*(#_save_xar7)), xar7
    1964              
    1964              ;               .if configSTACK_PTR_DEBUG == 1
    1964              ;;                      mov dbl(*(#_restore_xsp)), xsp
    1964              ;;            mov dbl(*(#_restore_xssp)), xssp
    1964              ;;            .endif
    1964              
    1964              ;                       B $3
    1964              ;$2
    1964              ;           MOV #0, *(#_first_flag) ; |217|
    1964              ;               mov dbl (*(#_first_save_xsp)), xsp                      ; restore xsp
    1964              ;                       mov dbl (*(#_first_save_xssp)), xssp
    1964              ;$3
    1964                                      .if 0
TMS320C55x Assembler PC v4.4.1 Sun Oct 07 09:43:43 2018

Tools Copyright (c) 1996-2012 Texas Instruments Incorporated
..\FreeRTOS\Source\portable\CCS\c55x\portASM.asm                     PAGE   89

    1964                              amov #0x000000, xar7
    1964                                      amov #0x000000, xar6
    1964                                  mov dbl (*(#_pxCurrentTCB)), xar7
    1964                                      mov dbl (*ar7), xar6                            ; xsp normal position
    1964                                      add #0x0064, ar6
    1964                                      mov xar6, xsp                                           ; actual xsp
    1964                                      mov dbl (*ar7(#2)), xar6                        ; xssp
    1964                                      add #0x0002, ar6
    1964                                      mov xar6, xssp
    1964                                      .endif
    1964              
    1964              ;;;;                    aadd #-1, sp                    ; on yield, need to do this
    1964 000923 46B2                          bclr INTM               ; enable interrupts
    1964 000925 20                            nop
    1964 000926 20                            nop
    1964 000927 20                            nop
    1964 000928 20                            nop
    1964 000929 20                            nop
    1964 00092a 20                            nop
    1964              
    1964              ;                       aadd #1, sp
    1964 00092b 4805                          RETI
    1964              ;                       mov #1860h, ssp
    1964 00092d 20                            nop
    1964 00092e 20                            nop
    1964              ;                       nop
    1965              
    1966              ;;;
    1967              
    1968              ;                /* Place the tick ISR in the correct vector. */
    1969              
    1970              ;;;                .sect ".int49"                       ; TIMER1_A0_VECTOR
    1971              ;;                .sect ".int14"                        ; CPUTIMER2
    1972              ;                 .sect ".text"                 ; CPUTIMER2
    1973              ;;;;             .sect ".INT14_ISR"
    1974              ;               .global _INT14_ISR
    1975              ;;;; _INT14_ISR:
    1976              ;;;;                .short   _vTickISR
    1977              ;;;;            LCR #_vTickISR
    1978                                      .end

No Assembly Errors, No Assembly Warnings
